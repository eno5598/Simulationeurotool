<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>EnoWeb Lotto – Eurojackpot + 6aus49 (Standalone Merge)</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{ --cy:#00fff0; --mag:#ff00ea; --ink:#eaf7ff; --bg:#060712; }
  body{background:radial-gradient(900px 700px at -10% -10%, rgba(0,255,240,.12), transparent 60%), radial-gradient(900px 700px at 110% -10%, rgba(255,0,234,.12), transparent 60%), var(--bg); color:var(--ink); font-family:Inter, ui-sans-serif, system-ui;}
  .title{background:linear-gradient(90deg,var(--cy),var(--mag)); -webkit-background-clip:text; color:transparent; font-weight:900}
  .glass{background:rgba(15,18,40,.78); backdrop-filter: blur(14px); border:1px solid rgba(0,255,255,.18); border-radius:14px; padding:14px; box-shadow: 0 12px 40px rgba(0,0,0,.45);}
  .nav-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px; min-width:84px;height:72px;padding:8px 10px;border-radius:16px;background:linear-gradient(180deg,rgba(18,24,50,.9),rgba(14,18,36,.9)); border:1px solid rgba(255,255,255,.08); box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 8px 22px rgba(0,0,0,.4);}
  .nav-btn.active{outline:2px solid rgba(255,255,255,.15); box-shadow:0 0 20px rgba(0,255,240,.35), inset 0 0 0 1px rgba(0,255,255,.1);}
  .badge{background:rgba(255,255,255,.06); border:1px solid rgba(140,170,255,.22); border-radius:999px; padding:.15rem .6rem; font-size:.74rem;}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:44px;padding:0 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);font-weight:700}
  .btn--green{background:#15803d;color:#fff;}
  .btn--amber{background:#b45309;color:#fff;}
  .btn--gray{background:#374151;color:#fff;}
  .btn:hover{filter:brightness(1.1)}
  .file-label{cursor:pointer; padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg,rgba(18,24,50,.9),rgba(14,18,36,.9)); display:inline-flex; gap:8px; align-items:center;}
  .file-input{display:none}
  .chip{display:inline-flex;align-items:center;justify-content:center;min-width:32px;height:32px;border-radius:10px;margin:4px;font-weight:800;font-size:.9rem;color:#bdfcff;background:linear-gradient(180deg,#0e1530,#15204a);border:1px solid rgba(0,255,255,.25);}
  .chip.extra{color:#ffe6ff;background:linear-gradient(180deg,#1c1433,#1c2b53);border-color:rgba(255,0,234,.3)}
  .chip.sel{background:linear-gradient(180deg,rgba(0,255,240,.25),rgba(0,255,240,.05)); box-shadow:0 0 16px rgba(0,255,240,.35), inset 0 0 0 1px rgba(0,255,255,.45); }
  canvas{max-width:100%}
</style>
</head>
<body class="p-4">
  <div class="flex items-center justify-between mb-3 flex-wrap gap-2">
    <h1 class="title text-3xl md:text-4xl">EnoWeb Lotto (Merged)</h1>
    <div class="flex items-center gap-2">
      <span class="badge">Spiel</span>
      <select id="gameSelect" class="bg-gray-900 p-2 rounded">
        <option value="eurojackpot" selected>Eurojackpot</option>
        <option value="lotto6aus49">6 aus 49 (Bayern)</option>
      </select>
    </div>
  </div>

  <div class="flex justify-center flex-wrap gap-3 mb-6">
    <button type="button" onclick="tab('archiv', this)" class="nav-btn active" id="btn-archiv"><div>📂</div><span>Archiv</span></button>
    <button type="button" onclick="tab('map', this)" class="nav-btn" id="btn-map"><div>🗺️</div><span>Map</span></button>
    <button type="button" onclick="tab('gen', this)" class="nav-btn" id="btn-gen"><div>⚡</div><span>Generieren</span></button>
    <button type="button" onclick="tab('ana', this)" class="nav-btn" id="btn-ana"><div>📊</div><span>Analyse</span></button>
  </div>

  <!-- ARCHIV -->
  <div id="v-archiv" class="glass">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-bold mb-2">📂 Archiv</h2>
      <div class="badge" id="freshLabel">–</div>
    </div>
    <div id="errBox" class="hidden bg-red-900/40 border border-red-400 text-red-200 rounded px-2 py-1 mb-2 text-sm"></div>
    <p id="statusText" class="text-sm mb-2">Noch kein Archiv geladen.</p>

    <div class="glass mb-3">
      <div class="font-semibold mb-2">Automatisches Laden</div>
      <div class="flex flex-col md:flex-row gap-2">
        <input id="archiveUrl" class="bg-gray-900 p-2 rounded flex-1">
        <button type="button" id="loadLatestBtn" class="btn btn--green">📥 Neueste laden</button>
        <button type="button" id="forceDlBtn" class="btn btn--amber">⬇️ ZIP speichern</button>
        <a id="directDl" class="btn btn--gray" target="_blank" rel="noopener">🔗 Direktlink</a>
        <button type="button" id="loadSample" class="btn btn--gray">🧪 Beispiel laden</button>
      </div>
      <p class="text-xs text-gray-300 mt-2">Original-Archiv-Links (Bayern): EJ = archiv_eurojackpot.zip, 6aus49 = archiv_lotto.zip</p>
    </div>

    <div class="glass mb-3">
      <div class="font-semibold mb-2">Manuell laden</div>
      <label class="file-label">
        📄 Datei auswählen
        <input type="file" id="zipInput" class="file-input" accept=".zip,.txt,.csv">
      </label>
      <span id="fileName" class="ml-2 text-sm opacity-80">Keine Datei ausgewählt</span>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-center">
      <div><div class="text-sm text-gray-300">Ziehungen</div><div id="kpiCount" class="font-bold">–</div></div>
      <div><div class="text-sm text-gray-300">Von</div><div id="kpiFrom" class="font-bold">–</div></div>
      <div><div class="text-sm text-gray-300">Bis</div><div id="kpiTo" class="font-bold">–</div></div>
      <div><div class="text-sm text-gray-300">Aktualität</div><div id="kpiFresh" class="font-bold">–</div></div>
    </div>
  </div>

  <!-- MAP -->
  <div id="v-map" class="glass hidden">
    <div class="flex items-center justify-between mb-1">
      <h2 class="text-xl font-bold">🗺 Map</h2>
      <div class="badge">Live-Auswahl</div>
    </div>
    <div class="mb-1 flex items-center justify-between">
      <div class="badge" id="mapBadgeMain">Hauptzahlen</div><div id="progress" class="badge">Bereit</div>
    </div>
    <div id="mapMain" class="flex flex-wrap"></div>
    <div class="mt-3 badge" id="mapBadgeExtra">Eurozahlen</div>
    <div id="mapExtra" class="flex flex-wrap"></div>
  </div>

  <!-- GENERIEREN -->
  <div id="v-gen" class="glass hidden">
    <h2 class="text-xl font-bold mb-2">⚡ Generieren</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
      <div>
        <label class="text-sm text-gray-300">Modus</label>
        <select id="modus" class="bg-gray-900 p-2 rounded w-full">
          <option value="last100">Letzte 100</option>
          <option value="never">Nie gezogene</option>
          <option value="hot">Hot Paare & Triples</option>
        </select>
      </div>
      <div>
        <label class="text-sm text-gray-300">Anzahl Kombinationen</label>
        <input type="number" id="kombis" value="5" min="1" max="25" class="bg-gray-900 p-2 rounded w-full">
      </div>
      <div class="grid grid-cols-3 gap-2">
        <button type="button" id="generateBtn" class="btn btn--green">⚡ Generieren</button>
        <button type="button" id="clearGeneratedBtn" class="btn btn--gray">🗑️ Alle löschen</button>
      </div>
    </div>
    <pre id="liveOutput" class="font-mono bg-black/70 p-3 mt-3 rounded h-44 overflow-auto text-green-300"></pre>
  </div>

  <!-- ANALYSE -->
  <div id="v-ana" class="glass hidden">
    <h2 class="text-xl font-bold mb-2">📊 Analyse</h2>
    <canvas id="chartMain" class="w-full h-60 mb-4"></canvas>
    <canvas id="chartExtra" class="w-full h-56"></canvas>
  </div>

<script>
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const sleep = ms => new Promise(r=>setTimeout(r,ms));
function tab(name, btn){
  ['archiv','map','gen','ana'].forEach(n=>$('#v-'+n).classList.add('hidden'));
  $('#v-'+name).classList.remove('hidden');
  $$('.nav-btn').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}

let currentGame = 'eurojackpot';
const urls = {
  eurojackpot: "https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_eurojackpot.zip",
  lotto6aus49: "https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_lotto.zip"
};
const gameConfig = {
  eurojackpot: { mainCount:5, mainMax:50, extraCount:2, extraMin:1, extraMax:12, extraName:'Eurozahlen', archKey:'ej_archive_v1' },
  lotto6aus49: { mainCount:6, mainMax:49, extraCount:1, extraMin:0, extraMax:9,  extraName:'Superzahl',  archKey:'lz_archive_v1' }
};

let draws=[], freqMain=[], freqExtra=[], lastSeenM=[], lastSeenE=[];
let chartMain, chartExtra;

function showError(msg){
  const b=$('#errBox'); b.textContent=msg; b.classList.remove('hidden');
  console.error(msg);
}
function clearError(){ $('#errBox').classList.add('hidden'); }

function applyGameUI(){
  const cfg = gameConfig[currentGame];
  $('#archiveUrl').value = urls[currentGame];
  $('#directDl').href = urls[currentGame];
  $('#mapBadgeMain').textContent = `Hauptzahlen 1–${cfg.mainMax}`;
  $('#mapBadgeExtra').textContent = `${cfg.extraName} ${cfg.extraMin}–${cfg.extraMax}`;
  $('#freshLabel').textContent = currentGame==='eurojackpot' ? 'EJ' : '6aus49';
  renderMap();
  setKPIs();
}
applyGameUI();

$('#gameSelect').addEventListener('change', (e)=>{
  currentGame = e.target.value;
  draws=[]; freqMain=[]; freqExtra=[]; lastSeenM=[]; lastSeenE=[];
  if(chartMain) chartMain.destroy(); if(chartExtra) chartExtra.destroy();
  clearError();
  applyGameUI();
});

function renderMap(){
  const cfg = gameConfig[currentGame];
  const m=$('#mapMain'); m.innerHTML='';
  for(let i=1;i<=cfg.mainMax;i++){ const d=document.createElement('div'); d.className='chip'; d.textContent=i; d.dataset.n=i; m.appendChild(d); }
  const e=$('#mapExtra'); e.innerHTML='';
  for(let i=cfg.extraMin;i<=cfg.extraMax;i++){ const d=document.createElement('div'); d.className='chip extra'; d.textContent=i; d.dataset.n=i; e.appendChild(d); }
  $('#progress').textContent='Bereit';
}

function setKPIs(){
  if(!draws.length){
    $('#kpiCount').textContent='–'; $('#kpiFrom').textContent='–'; $('#kpiTo').textContent='–'; $('#kpiFresh').textContent='–';
    return;
  }
  $('#kpiCount').textContent=draws.length;
  $('#kpiFrom').textContent=draws[0].date;
  $('#kpiTo').textContent=draws.at(-1).date;
  const last=new Date(draws.at(-1).date);
  const days=Math.max(0, Math.round((Date.now()-last.getTime())/86400000));
  $('#kpiFresh').textContent = days<=14? 'aktuell' : (days<=60? `ok (${days} Tage alt)` : `veraltet (${days} Tage)`);
}

async function ensureJSZip(){ return !!window.JSZip; }
async function fetchWithProxies(url){
  const trials=[url,'https://cors.isomorphic-git.org/'+url,'https://api.allorigins.win/raw?url='+encodeURIComponent(url),'https://thingproxy.freeboard.io/fetch/'+url,'https://corsproxy.io/?'+encodeURIComponent(url)];
  let last=null;
  for(const u of trials){
    try{
      const res=await fetch(u,{cache:'no-store'}); if(!res.ok) throw new Error('HTTP '+res.status);
      const ct=res.headers.get('content-type')||'';
      if(ct.includes('zip') || u.endsWith('.zip')){
        if(!(await ensureJSZip())) throw new Error('JSZip fehlt.');
        const blob=await res.blob(); const zip=await JSZip.loadAsync(blob); const entries=Object.values(zip.files);
        const wanted = entries.filter(f=>/\.(txt|csv)$/i.test(f.name));
        if(!wanted.length) throw new Error('ZIP ohne TXT/CSV');
        let combined=''; for(const f of wanted){ combined += '\n' + await f.async('string'); }
        return combined;
      } else { return await res.text(); }
    }catch(e){ last=e; }
  }
  throw last||new Error('Download fehlgeschlagen');
}

function parseArchiveText(raw){
  const cfg = gameConfig[currentGame];
  try{
    const lines=raw.replace(/\r\n?/g,'\n').split('\n').map(l=>l.trim()).filter(Boolean);
    const cleaned = lines.filter(l => (l.match(/\d+/g)||[]).length >= (cfg.mainCount + cfg.extraCount));
    function iso(y,m,d){ const dt=new Date(+y, +m-1, +d); return isNaN(dt)? null : dt.toISOString().slice(0,10); }
    const regDMY=/^(\d{1,2})[.\-\/](\d{1,2})[.\-\/](\d{2,4})$/, regYMD=/^(\d{4})[.\-\/](\d{1,2})[.\-\/](\d{1,2})$/;
    function parseLine(line){
      const t=line.split(/;|,|\t|\s+/).filter(Boolean); let date=null,rest=[];
      if(t.length&&regDMY.test(t[0])){const m=t[0].match(regDMY); date=iso(m[3],m[2],m[1]); rest=t.slice(1);}
      else if(t.length&&regYMD.test(t[0])){const m=t[0].match(regYMD); date=iso(m[1],m[2],m[3]); rest=t.slice(1);}
      else{rest=t.slice(0);}
      const nums=rest.map(Number).filter(n=>!Number.isNaN(n));
      const main = nums.filter(n=> n>=1 && n<=cfg.mainMax).slice(0,cfg.mainCount).sort((a,b)=>a-b);
      const extra = nums.filter(n=> n>=cfg.extraMin && n<=cfg.extraMax).slice(0,cfg.extraCount).sort((a,b)=>a-b);
      if(!date || main.length!==cfg.mainCount || (cfg.extraCount && extra.length!==cfg.extraCount)) return null;
      return {date,main,extra};
    }
    draws=[]; freqMain=Array(cfg.mainMax+1).fill(0); freqExtra=Array(cfg.extraMax+1).fill(0);
    lastSeenM=Array(cfg.mainMax+1).fill(null); lastSeenE=Array(cfg.extraMax+1).fill(null);
    cleaned.forEach(l=>{ const r=parseLine(l); if(r) draws.push(r); });
    if(!draws.length) throw new Error('Keine gültigen Ziehungen erkannt.');
    draws.sort((a,b)=>a.date.localeCompare(b.date));
    draws.forEach((d,idx)=>{ d.main.forEach(n=>{freqMain[n]++; lastSeenM[n]=idx;}); d.extra.forEach(n=>{freqExtra[n]++; lastSeenE[n]=idx;}); });
    localStorage.setItem(gameConfig[currentGame].archKey, raw);
    $('#statusText').textContent='Archiv geladen ✔';
    setKPIs(); renderCharts();
    clearError();
  }catch(e){ $('#statusText').textContent='Fehler beim Parsen'; showError(e.message); }
}

document.getElementById('loadLatestBtn').addEventListener('click', async ()=>{
  const url=$('#archiveUrl').value.trim();
  $('#statusText').textContent='Lade neuestes Archiv…';
  clearError();
  try{ const text=await fetchWithProxies(url); parseArchiveText(text); }
  catch(e){ $('#statusText').textContent='Download fehlgeschlagen'; showError(e?.message||String(e)); }
});
document.getElementById('forceDlBtn').addEventListener('click', async ()=>{
  const url=$('#archiveUrl').value.trim();
  try{ const res=await fetch(url); const blob=await res.blob(); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=url.split('/').pop()||'archiv.zip'; a.click(); URL.revokeObjectURL(a.href); }catch(e){ showError('Direkt-Download nicht möglich: '+(e?.message||e)); }
});
document.getElementById('zipInput').addEventListener('change', async (e)=>{
  const file=e.target.files?.[0]; if(!file) return; $('#fileName').textContent=file.name;
  clearError();
  try{
    let text='';
    if(file.name.toLowerCase().endsWith('.zip')){
      if(!(await ensureJSZip())){ showError('JSZip nicht verfügbar.'); return; }
      const zip=await JSZip.loadAsync(file); const entries=Object.values(zip.files);
      let entry=entries.find(f=>/\.(txt|csv)$/i.test(f.name));
      if(!entry) throw new Error('ZIP ohne TXT/CSV.');
      text=await entry.async('string');
    }else{ text=await file.text(); }
    parseArchiveText(text);
  }catch(err){ showError(err.message||String(err)); }
});

document.getElementById('loadSample').addEventListener('click', ()=>{
  const sampleEJ = `
  2024-09-06; 4; 11; 24; 35; 48; 3; 7
  2024-09-13; 8; 16; 17; 36; 49; 4; 9
  2024-09-20; 2; 10; 19; 22; 28; 1; 6
  2024-09-27; 7; 12; 25; 31; 44; 2; 8
  2024-10-04; 5; 15; 18; 29; 47; 3; 12
  2024-10-11; 6; 9; 13; 26; 33; 5; 10
  2024-10-18; 1; 14; 23; 32; 40; 7; 11
  2024-10-25; 3; 20; 27; 34; 41; 2; 9
  2024-11-01; 16; 21; 30; 38; 45; 1; 5
  2024-11-08; 11; 19; 22; 28; 50; 4; 6
  `;
  const sampleLZ = `
  06.09.2024; 4; 11; 24; 35; 48; 49; 7
  13.09.2024; 8; 16; 17; 36; 42; 44; 0
  20.09.2024; 2; 10; 19; 22; 28; 33; 3
  27.09.2024; 7; 12; 25; 31; 41; 45; 5
  04.10.2024; 5; 15; 18; 29; 37; 47; 9
  11.10.2024; 6; 9; 13; 26; 33; 39; 2
  18.10.2024; 1; 14; 23; 32; 40; 46; 4
  25.10.2024; 3; 20; 27; 34; 41; 43; 1
  01.11.2024; 16; 21; 30; 38; 45; 49; 6
  08.11.2024; 11; 19; 22; 28; 35; 44; 8
  `;
  parseArchiveText(currentGame==='eurojackpot' ? sampleEJ : sampleLZ);
  $('#statusText').textContent='Beispieldaten geladen ✔';
});

function renderCharts(){
  if(!draws.length) return;
  if(chartMain) chartMain.destroy(); if(chartExtra) chartExtra.destroy();
  const cfg = gameConfig[currentGame];
  const mainLabels = [...Array(cfg.mainMax).keys()].map(i=>i+1);
  const extraLabels = [...Array(cfg.extraMax - cfg.extraMin + 1).keys()].map(i=>i+cfg.extraMin);
  chartMain=new Chart($('#chartMain'),{type:'bar',data:{labels:mainLabels,datasets:[{data:[...freqMain].slice(1), borderWidth:0}]},options:{plugins:{legend:{display:false}}}});
  const exData = cfg.extraMin===0 ? [...freqExtra] : [...freqExtra].slice(cfg.extraMin);
  chartExtra=new Chart($('#chartExtra'),{type:'bar',data:{labels:extraLabels,datasets:[{data:exData, borderWidth:0}]},options:{plugins:{legend:{display:false}}}});
}

/* Generator (simple) */
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
function pickFromRange(from,to,avoid,count,weightFn){
  const bag=[]; for(let n=from;n<=to;n++){ if(!avoid.includes(n)){ const w=Math.max(1, weightFn?weightFn(n):1); for(let k=0;k<w;k++) bag.push(n);} }
  shuffle(bag);
  const res=[]; for(const v of bag){ if(!res.includes(v)){ res.push(v); if(res.length===count) break; } }
  return res;
}
function autoExtra(){
  const cfg = gameConfig[currentGame];
  const start = cfg.extraMin; const fe=[...freqExtra]; const maxE=Math.max(...fe.slice(start))||1;
  const lastIdx=draws.length-1;
  const w = (e)=>{
    const f = fe[e]/maxE;
    const gap = lastSeenE[e]!=null ? (lastIdx-lastSeenE[e]) : lastIdx+1;
    const gapN = Math.min(1, gap/(lastIdx+1));
    return 1 + Math.round(3*(0.55*f + 0.45*gapN));
  };
  const need = cfg.extraCount;
  const e = pickFromRange(start,cfg.extraMax,[],need,w).sort((a,b)=>a-b);
  return e;
}
function generateOne(){
  const cfg = gameConfig[currentGame];
  if(!draws.length){
    return {main: pickFromRange(1,cfg.mainMax,[],cfg.mainCount).sort((a,b)=>a-b), extra: pickFromRange(cfg.extraMin,cfg.extraMax,[],cfg.extraCount).sort((a,b)=>a-b)};
  }
  const mode = $('#modus').value;
  if(mode==='last100'){
    const r=draws.slice(-100); const fm=Array(cfg.mainMax+1).fill(1); r.forEach(d=>d.main.forEach(n=>fm[n]++));
    const maxM=Math.max(...fm.slice(1)); const w=n=>Math.ceil(3*fm[n]/maxM);
    const main = pickFromRange(1,cfg.mainMax,[],cfg.mainCount,w).sort((a,b)=>a-b);
    return {main, extra:autoExtra()};
  }
  if(mode==='never'){
    const fm=[...freqMain]; const w=n=> fm[n]===0?5:(fm[n]<=5?3:1);
    const main = pickFromRange(1,cfg.mainMax,[],cfg.mainCount,w).sort((a,b)=>a-b);
    return {main, extra:autoExtra()};
  }
  if(mode==='hot'){
    const recent = draws.slice(-200);
    const pairMap=new Map(), tripleMap=new Map();
    function inc(map,key){ map.set(key,(map.get(key)||0)+1); }
    for(const d of recent){
      const m=[...d.main].sort((a,b)=>a-b);
      for(let i=0;i<m.length;i++) for(let j=i+1;j<m.length;j++){ inc(pairMap, `${m[i]}-${m[j]}`); }
      for(let i=0;i<m.length;i++) for(let j=i+1;j<m.length;j++) for(let k=j+1;k<m.length;k++){ inc(tripleMap, `${m[i]}-${m[j]}-${m[k]}`); }
    }
    const topPairs=[...pairMap.entries()].sort((a,b)=>b[1]-a[1]).slice(0,30).map(e=>e[0].split('-').map(Number));
    const topTrip=[...tripleMap.entries()].sort((a,b)=>b[1]-a[1]).slice(0,20).map(e=>e[0].split('-').map(Number));
    let main=[];
    if(Math.random()<0.5 && topTrip.length){ main = [...topTrip[Math.floor(Math.random()*topTrip.length)]]; }
    else if(topPairs.length){ main = [...topPairs[Math.floor(Math.random()*topPairs.length)]]; }
    const r2=draws.slice(-100); const fm=Array(cfg.mainMax+1).fill(1); r2.forEach(d=>d.main.forEach(n=>fm[n]++));
    const maxM=Math.max(...fm.slice(1)); const w=n=>Math.ceil(2*fm[n]/maxM);
    while(main.length<cfg.mainCount){ const add = pickFromRange(1,cfg.mainMax,main,1,w); if(add.length) main.push(add[0]); else break; }
    main.sort((a,b)=>a-b);
    return {main, extra:autoExtra()};
  }
  return {main: pickFromRange(1,cfg.mainMax,[],cfg.mainCount).sort((a,b)=>a-b), extra: autoExtra()};
}
document.getElementById('generateBtn').addEventListener('click', ()=>{
  if(!draws.length){ alert('Bitte zuerst ein Archiv laden.'); return; }
  const out=$('#liveOutput'); out.textContent='';
  const k=Math.max(1, Math.min(25, +$('#kombis').value||5));
  for(let i=1;i<=k;i++){
    const tip = generateOne();
    out.textContent += `#${i}: ${tip.main.join(' ')}  |  [${tip.extra.join(' ')}]
`;
  }
});
document.getElementById('clearGeneratedBtn').addEventListener('click', ()=>{ $('#liveOutput').textContent=''; });

window.addEventListener('load', ()=>{
  applyGameUI();
  $('#archiveUrl').value = urls[currentGame];
  $('#directDl').href = urls[currentGame];
});
</script>
</body>
</html>
