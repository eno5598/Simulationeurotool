<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EnoWeb ‚Ä¢ Merged: Eurojackpot + 6aus49 (Archiv system preserved)</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
  :root{ --cy:#00fff0; --mag:#ff00ea; --ink:#eaf7ff; --bg:#060712; }
  body{background:radial-gradient(900px 700px at -10% -10%, rgba(0,255,240,.12), transparent 60%), radial-gradient(900px 700px at 110% -10%, rgba(255,0,234,.12), transparent 60%), var(--bg); color:var(--ink); font-family:Inter, ui-sans-serif, system-ui;}
  .title{background:linear-gradient(90deg,var(--cy),var(--mag)); -webkit-background-clip:text; color:transparent; font-weight:900}
  .glass{background:rgba(15,18,40,.78); backdrop-filter: blur(14px); border:1px solid rgba(0,255,255,.18); border-radius:14px; padding:14px; box-shadow: 0 12px 40px rgba(0,0,0,.45);}
  .hidden{display:none}
  iframe{width:100%; height:calc(100vh - 180px); border:0; border-radius:14px; background:#0b1022}
</style>
</head>
<body class="p-5">
  <div class="flex items-center justify-between mb-3 flex-wrap gap-3">
    <h1 class="title text-3xl md:text-4xl">EnoWeb Lotto ‚Ä¢ Merged</h1>
    <div class="flex items-center gap-2">
      <span class="bg-white/10 rounded px-2 py-1 text-sm">Spiel</span>
      <select id="game" class="bg-gray-900 p-2 rounded">
        <option value="ej">Eurojackpot</option>
        <option value="lz">6 aus 49 (Bayern)</option>
      </select>
    </div>
  </div>

  <div class="glass mb-3">
    <p class="text-sm opacity-90">Diese Datei baut deine <b>beiden Original‚ÄëTools</b> zusammen ‚Äì ohne deren Archivsysteme zu ver√§ndern. Du kannst wie gewohnt in jedem Tool das Archiv laden. Der Wechsel unten schaltet nur die Ansicht.</p>
  </div>

  <div id="wrap-ej" class="glass mb-3">
    <div class="text-xs opacity-75 mb-1">Eurojackpot Tool</div>
    <iframe id="ej" title="Eurojackpot"></iframe>
  </div>
  <div id="wrap-lz" class="glass mb-3 hidden">
    <div class="text-xs opacity-75 mb-1">Lotto 6aus49 Tool</div>
    <iframe id="lz" title="6aus49"></iframe>
  </div>

<script>
function blobURL(html){ const b=new Blob([html],{type:'text/html'}); return URL.createObjectURL(b); }
const eurojackpotHTML = `<!DOCTYPE html>
<html lang="de"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Eurojackpot Tool by EnoWeb ‚Ä¢ merged</title>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>body{background:#0b1022;color:#eaf7ff;font-family:Inter, ui-sans-serif, system-ui;padding:16px}.glass{background:rgba(15,18,40,.78);border:1px solid rgba(0,255,255,.18);border-radius:14px;padding:14px}.btn{display:inline-flex;align-items:center;gap:.5rem;height:40px;padding:0 12px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#15803d;color:#fff}.file{display:none}</style>
</head><body>
  <h2 class="text-xl font-bold mb-3">Eurojackpot Archiv</h2>
  <div class="glass mb-3">
    <div class="flex flex-col md:flex-row gap-2">
      <input id="archiveUrl" class="bg-gray-900 p-2 rounded flex-1" value="https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_eurojackpot.zip">
      <button id="loadLatestBtn" class="btn">üì• Neueste laden</button>
      <button id="forceDlBtn" class="btn" style="background:#b45309">‚¨áÔ∏è ZIP speichern</button>
      <a id="directDl" class="btn" style="background:#374151" target="_blank" rel="noopener">üîó Direktlink</a>
      <label class="btn" style="background:#374151;cursor:pointer">üìÑ Datei<input id="zipInput" type="file" class="file" accept=".zip,.txt,.csv"></label>
    </div>
    <div id="statusText" class="text-sm mt-2">Noch kein Archiv geladen.</div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-center mt-2">
      <div><div class="text-xs opacity-70">Ziehungen</div><div id="kpiCount" class="font-bold">‚Äì</div></div>
      <div><div class="text-xs opacity-70">Von</div><div id="kpiFrom" class="font-bold">‚Äì</div></div>
      <div><div class="text-xs opacity-70">Bis</div><div id="kpiTo" class="font-bold">‚Äì</div></div>
      <div><div class="text-xs opacity-70">Aktualit√§t</div><div id="kpiFresh" class="font-bold">‚Äì</div></div>
    </div>
  </div>
  <canvas id="chartMain" class="w-full h-60 mb-4"></canvas>
  <canvas id="chartEuro" class="w-full h-56"></canvas>
<script>
const $=s=>document.querySelector(s);
let draws=[]; let freqMain=Array(51).fill(0), freqEuro=Array(13).fill(0);
function setKPIs(){ if(!draws.length){ $('#kpiCount').textContent='‚Äì'; $('#kpiFrom').textContent='‚Äì'; $('#kpiTo').textContent='‚Äì'; $('#kpiFresh').textContent='‚Äì'; return; }
  $('#kpiCount').textContent=draws.length; $('#kpiFrom').textContent=draws[0].date; $('#kpiTo').textContent=draws.at(-1).date;
  const d=new Date(draws.at(-1).date); const days=Math.max(0, Math.round((Date.now()-d)/86400000));
  $('#kpiFresh').textContent= days<=14? 'aktuell' : (days<=60? 'ok ('+days+' Tage alt)' : 'veraltet ('+days+' Tage alt)'); }
async function ensureJSZip(){ return !!window.JSZip; }
async function fetchWithProxies(url){
  const trials=[url,'https://cors.isomorphic-git.org/'+url,'https://api.allorigins.win/raw?url='+encodeURIComponent(url),'https://thingproxy.freeboard.io/fetch/'+url,'https://corsproxy.io/?'+encodeURIComponent(url)];
  let last=null; for(const u of trials){
    try{ const res=await fetch(u); if(!res.ok) throw new Error('HTTP '+res.status);
      const ct=res.headers.get('content-type')||'';
      if(ct.includes('zip') || u.endsWith('.zip')){
        if(!(await ensureJSZip())) throw new Error('JSZip fehlt.');
        const blob=await res.blob(); const zip=await JSZip.loadAsync(blob); const entries=Object.values(zip.files);
        let entry=entries.find(f=>/\\.(txt|csv)$/i.test(f.name) && /eurojackpot/i.test(f.name)) || entries.find(f=>/\\.(txt|csv)$/i.test(f.name));
        if(!entry) throw new Error('ZIP ohne TXT/CSV'); const text=await entry.async('string'); return text;
      }else{ return await res.text(); }
    }catch(e){ last=e; }
  } throw last||new Error('Download fehlgeschlagen');}
function parseArchiveText(txt){
  try{ const lines=txt.replace(/\\r\\n?/g,'\\n').split('\\n').map(l=>l.trim()).filter(Boolean);
    const cleaned = lines.filter(l => (l.match(/\\d+/g)||[]).length >= 7);
    function iso(y,m,d){ const dt=new Date(+y, +m-1, +d); return isNaN(dt)? null : dt.toISOString().slice(0,10); }
    const regDMY=/(\\d{1,2})[.\\/-](\\d{1,2})[.\\/-](\\d{2,4})/; const regYMD=/(\\d{4})[.\\/-](\\d{1,2})[.\\/-](\\d{1,2})/;
    function parseLine(line){ let date=null; const dm=line.match(regDMY); const ym=line.match(regYMD);
      if(dm) date=iso(dm[3],dm[2],dm[1]); else if(ym) date=iso(ym[1],ym[2],ym[3]);
      const nums=(line.match(/\\d+/g)||[]).map(Number);
      const main=nums.filter(n=>n>=1&&n<=50).slice(0,5).sort((a,b)=>a-b);
      const euro=nums.filter(n=>n>=1&&n<=12).slice(0,2).sort((a,b)=>a-b);
      if(!date||main.length!==5||euro.length!==2) return null; return {date,main,euro}; }
    draws=[]; freqMain.fill(0); freqEuro.fill(0);
    cleaned.forEach(l=>{ const r=parseLine(l); if(r) draws.push(r); });
    if(!draws.length) throw new Error('Keine g√ºltigen Ziehungen erkannt.');
    draws.sort((a,b)=>a.date.localeCompare(b.date));
    draws.forEach(d=>{ d.main.forEach(n=>freqMain[n]++); d.euro.forEach(n=>freqEuro[n]++); });
    $('#statusText').textContent='Archiv geladen ‚úî'; setKPIs(); renderCharts();
  }catch(e){ $('#statusText').textContent='Fehler: '+e.message; }}
let chartMain, chartEuro;
function renderCharts(){
  if(chartMain) chartMain.destroy(); if(chartEuro) chartEuro.destroy();
  chartMain=new Chart($('#chartMain'),{type:'bar',data:{labels:[...Array(50).keys()].slice(1),datasets:[{data:[...freqMain].slice(1),borderWidth:0}]},options:{plugins:{legend:{display:false}}}});
  chartEuro=new Chart($('#chartEuro'),{type:'bar',data:{labels:[...Array(12).keys()].slice(1),datasets:[{data:[...freqEuro].slice(1),borderWidth:0}]},options:{plugins:{legend:{display:false}}}});
}
document.getElementById('loadLatestBtn').addEventListener('click', async ()=>{
  const url=$('#archiveUrl').value.trim(); $('#statusText').textContent='Lade neuestes Archiv‚Ä¶';
  try{ const text=await fetchWithProxies(url); parseArchiveText(text); }catch(e){ $('#statusText').innerHTML="Download nicht m√∂glich. <a class='underline' target='_blank' href='"+url+"'>Manuell √∂ffnen</a>."; }});
document.getElementById('forceDlBtn').addEventListener('click', async ()=>{
  const url=$('#archiveUrl').value.trim(); try{ const res=await fetch(url); const blob=await res.blob(); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='archiv_eurojackpot.zip'; a.click(); URL.revokeObjectURL(a.href); }catch(e){ alert('Direkt-Download nicht m√∂glich.'); }});
(function(){ const u=$('#archiveUrl').value.trim(); $('#directDl').href=u; })();
document.getElementById('zipInput').addEventListener('change', async (e)=>{
  const file=e.target.files?.[0]; if(!file) return; $('#statusText').textContent='Lade Datei‚Ä¶';
  try{ let text=''; if(file.name.toLowerCase().endsWith('.zip')){
      if(!(await ensureJSZip())){ alert('JSZip nicht verf√ºgbar.'); return; }
      const zip=await JSZip.loadAsync(file); const entries=Object.values(zip.files);
      let entry=entries.find(f=>/\\.(txt|csv)$/i.test(f.name) && /eurojackpot/i.test(f.name)) || entries.find(f=>/\\.(txt|csv)$/i.test(f.name));
      if(!entry) throw new Error('ZIP ohne TXT/CSV.'); text=await entry.async('string');
    }else{ text=await file.text(); }
    parseArchiveText(text);
  }catch(err){ $('#statusText').textContent='Fehler: '+err.message; }});
<\/script>
</body></html>`;

const lottoHTML = `<!DOCTYPE html>
<html lang="de"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Lotto 6aus49 Tool by EnoWeb ‚Ä¢ merged</title>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>body{background:#0b1022;color:#eaf7ff;font-family:Inter, ui-sans-serif, system-ui;padding:16px}.glass{background:rgba(15,18,40,.78);border:1px solid rgba(0,255,255,.18);border-radius:14px;padding:14px}.btn{display:inline-flex;align-items:center;gap:.5rem;height:40px;padding:0 12px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#15803d;color:#fff}.file{display:none}</style>
</head><body>
  <h2 class="text-xl font-bold mb-3">Lotto 6aus49 Archiv</h2>
  <div class="glass mb-3">
    <div class="flex flex-col md:flex-row gap-2">
      <input id="archiveUrl" class="bg-gray-900 p-2 rounded flex-1" value="https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_lotto.zip">
      <button id="loadLatestBtn" class="btn">üì• Neueste laden</button>
      <button id="forceDlBtn" class="btn" style="background:#b45309">‚¨áÔ∏è ZIP speichern</button>
      <a id="directDl" class="btn" style="background:#374151" target="_blank" rel="noopener">üîó Direktlink</a>
      <label class="btn" style="background:#374151;cursor:pointer">üìÑ Dateien<input id="zipInput" type="file" class="file" multiple accept=".zip,.txt,.csv"></label>
    </div>
    <div id="statusText" class="text-sm mt-2">Noch kein Archiv geladen.</div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-center mt-2">
      <div><div class="text-xs opacity-70">Ziehungen</div><div id="kpiCount" class="font-bold">‚Äì</div></div>
      <div><div class="text-xs opacity-70">Von</div><div id="kpiFrom" class="font-bold">‚Äì</div></div>
      <div><div class="text-xs opacity-70">Bis</div><div id="kpiTo" class="font-bold">‚Äì</div></div>
      <div><div class="text-xs opacity-70">Letzter Online‚ÄëCheck</div><div id="kpiFresh" class="font-bold">‚Äì</div></div>
    </div>
  </div>
<script>
const $=s=>document.querySelector(s);
let draws=[]; let freqMain=Array(50).fill(0);
const LS_ARCH='lz_all_archive_merged'; const LS_LASTDATE='lz_last_seen_draw_merged'; const LS_LASTCHECK='lz_last_online_check_merged';
function iso(y,m,d){ const Y=(+y<100)?(2000+(+y)):(+y); const dt=new Date(Date.UTC(Y,+m-1,+d)); return isNaN(dt)? null : dt.toISOString().slice(0,10); }
function tokenize(line){ return line.replace(/[,;\\t]/g,' ').trim().split(/\\s+/); }
function plausibleDMY(d,m,y){ return d>=1 && d<=31 && m>=1 && m<=12 && y>=1900 && y<=2100; }
function extractDateAndNumbers(line){
  const tok=tokenize(line); if(tok.length<9) return null;
  let d=null,m=null,y=null,startIdx=0;
  if(/^\\d+$/.test(tok[0]) && /^\\d+$/.test(tok[1]) && /^\\d+$/.test(tok[2])){ d=+tok[0]; m=+tok[1]; y=+tok[2]; if(plausibleDMY(d,m,y)) startIdx=3; else {d=m=y=null;} }
  if(!d){
    const m1=line.match(/(\\d{1,2})[.\\-\\/](\\d{1,2})[.\\-\\/](\\d{2,4})/);
    if(m1){ d=+m1[1]; m=+m1[2]; y=+m1[3];
      if(plausibleDMY(d,m,y)){
        const after=line.replace(m1[0],' ').replace(/[;,]/g,' ').trim().split(/\\s+/);
        return {date: iso(y,m,d), nums: after.map(Number).filter(n=>!Number.isNaN(n))};
      }
    }
  }
  if(!d) return null;
  return { date: iso(y,m,d), nums: tok.slice(startIdx).map(Number).filter(n=>!Number.isNaN(n)) };
}
function extractDrawSets(nums){
  const out=[]; let i=0;
  while(i<nums.length){
    const main=[]; let j=i;
    while(j<nums.length && main.length<6){ const n=nums[j]; if(1<=n && n<=49) main.push(n); j++; }
    if(main.length===6){
      out.push(main.sort((a,b)=>a-b));
      if(j<nums.length && 1<=nums[j] && nums[j]<=49) j++;   // alte Zusatzzahl optional
      while(j<nums.length && 0<=nums[j] && nums[j]<=9) j++; // Superzahlen optional ignorieren
      i=j;
    } else { break; }
  }
  return out;
}
function parseArchiveText(txt, saveToLS=true){
  try{
    const lines=txt.replace(/\\r\\n?/g,'\\n').split('\\n').map(l=>l.trim()).filter(Boolean);
    draws=[]; freqMain.fill(0);
    for(const line of lines){
      const dn=extractDateAndNumbers(line); if(!dn||!dn.date) continue;
      const sets=extractDrawSets(dn.nums);
      for(const main of sets){ draws.push({date:dn.date, main}); main.forEach(n=>freqMain[n]++); }
    }
    if(!draws.length) throw new Error('Keine g√ºltigen Ziehungen erkannt.');
    draws.sort((a,b)=>a.date.localeCompare(b.date));
    $('#kpiCount').textContent=draws.length; $('#kpiFrom').textContent=draws[0].date; $('#kpiTo').textContent=draws.at(-1).date;
    $('#statusText').textContent='Archiv geladen ‚úî (alle Ziehungen)';
    $('#kpiFresh').textContent = localStorage.getItem(LS_LASTCHECK) || '‚Äì';
    if(saveToLS){ localStorage.setItem(LS_ARCH, txt); }
    return draws.at(-1).date;
  }catch(e){ $('#statusText').textContent='Fehler: '+e.message; return null; }
}
async function ensureJSZip(){ return !!window.JSZip; }
async function fetchWithProxies(url){
  const trials=[url,'https://cors.isomorphic-git.org/'+url,'https://api.allorigins.win/raw?url='+encodeURIComponent(url),'https://thingproxy.freeboard.io/fetch/'+url,'https://corsproxy.io/?'+encodeURIComponent(url)];
  let last=null;
  for(const u of trials){
    try{
      const res=await fetch(u,{cache:'no-store'}); if(!res.ok) throw new Error('HTTP '+res.status);
      const ct=res.headers.get('content-type')||'';
      if(ct.includes('zip') || u.endsWith('.zip')){
        if(!(await ensureJSZip())) throw new Error('JSZip fehlt.');
        const blob=await res.blob(); const zip=await JSZip.loadAsync(blob); const entries=Object.values(zip.files);
        const wanted = entries.filter(f=>/\\.(txt|csv)$/i.test(f.name));
        if(!wanted.length) throw new Error('ZIP ohne TXT/CSV');
        let combined=''; for(const f of wanted){ combined += '\\n' + await f.async('string'); }
        return combined;
      } else { return await res.text(); }
    }catch(e){ last=e; }
  }
  throw last||new Error('Download fehlgeschlagen');
}
async function loadLatestAndDetect(){
  const url=$('#archiveUrl').value.trim();
  $('#statusText').textContent='Online-Archiv wird gepr√ºft‚Ä¶';
  try{
    const raw = await fetchWithProxies(url);
    const latestDate = parseArchiveText(raw, true);
    const lastSeen = localStorage.getItem(LS_LASTDATE);
    if(latestDate){
      const newDetected = (!lastSeen || latestDate > lastSeen);
      if(newDetected){ /* optional */ }
      localStorage.setItem(LS_LASTDATE, latestDate);
      const now = new Date().toISOString().replace('T',' ').slice(0,16);
      localStorage.setItem(LS_LASTCHECK, now);
      $('#kpiFresh').textContent = now;
    }
  }catch(e){
    const saved = localStorage.getItem(LS_ARCH);
    if(saved){ parseArchiveText(saved, false); }
    else{ $('#statusText').textContent='Online-Check fehlgeschlagen und kein gespeichertes Archiv vorhanden.'; }
  }
}
document.getElementById('loadLatestBtn').addEventListener('click', loadLatestAndDetect);
document.getElementById('forceDlBtn').addEventListener('click', async ()=>{
  const url=$('#archiveUrl').value.trim();
  try{ const res=await fetch(url); const blob=await res.blob(); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='archiv_lotto.zip'; a.click(); URL.revokeObjectURL(a.href); }catch(e){ alert('Direkt-Download nicht m√∂glich.'); }
});
(function(){ const u=$('#archiveUrl').value.trim(); $('#directDl').href=u; })();
document.getElementById('zipInput').addEventListener('change', async (e)=>{
  const files=Array.from(e.target.files||[]); if(!files.length) return; $('#statusText').textContent='Lade‚Ä¶';
  try{
    let combined='';
    for(const file of files){
      if(file.name.toLowerCase().endsWith('.zip')){
        const zip=await JSZip.loadAsync(file); const entries=Object.values(zip.files);
        for(const f of entries){ if(/\\.(txt|csv)$/i.test(f.name)){ combined += "\\n" + await f.async('string'); } }
      }else{ combined += "\\n" + await file.text(); }
    }
    const latestDate = parseArchiveText(combined, true);
    if(latestDate){
      localStorage.setItem(LS_LASTDATE, latestDate);
      const now = new Date().toISOString().replace('T',' ').slice(0,16);
      localStorage.setItem(LS_LASTCHECK, now); $('#kpiFresh').textContent = now;
    }
  }catch(err){ $('#statusText').textContent='Fehler: '+err.message; }
});
<\/script>
</body></html>`;

const ejURL = blobURL(eurojackpotHTML);
const lzURL = blobURL(lottoHTML);
document.getElementById('ej').src = ejURL;
document.getElementById('lz').src = lzURL;

document.getElementById('game').addEventListener('change', (e)=>{
  const v=e.target.value;
  document.getElementById('wrap-ej').classList.toggle('hidden', v!=='ej');
  document.getElementById('wrap-lz').classList.toggle('hidden', v!=='lz');
});
</script>
</body>
</html>
