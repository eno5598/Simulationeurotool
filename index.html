<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EuroJackpot ‚Ä¢ Premium Studio (by ENOWEB)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#070911;
  --panel:#0b1222ee;
  --ink:#e8f8ff;
  --accent1:#00fff0;
  --accent2:#ff5be8;
  --mint:#15d6c8;
  --teal:#0aa39a;
  --gold:#f4c655;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--ink);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;
  background:
    radial-gradient(1200px 800px at -10% -10%, rgba(0,255,240,.10), transparent 60%),
    radial-gradient(1200px 800px at 110% -10%, rgba(255,0,234,.10), transparent 60%),
    var(--bg);
}
.container{max-width:1100px;margin:20px auto;padding:0 16px}
.header h1{
  margin:0 0 4px 0; font-size:clamp(26px,5vw,42px); font-weight:900;
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text; color:transparent;
}
.header .by{
  font-weight:900;
  display:inline-block;
  background:linear-gradient(90deg,#00fff0,#67c3ff,#ff5be8,#ffd36a,#00fff0);
  background-size:400% 100%;
  -webkit-background-clip:text; color:transparent;
  animation:grad 5.5s linear infinite;
}
@keyframes grad{0%{background-position:0 50%}100%{background-position:100% 50%}}
.card{
  background:var(--panel);
  border:1px solid rgba(255,255,255,.06);
  border-radius:16px;
  box-shadow:0 18px 42px rgba(0,0,0,.55);
  padding:16px;
  backdrop-filter:blur(18px);
}
.grid{display:grid; gap:16px}
@media (min-width:960px){ .grid-2{grid-template-columns:1fr 1fr} }
.title{font-size:20px;font-weight:800;margin:.25rem 0 1rem 0}
.controls{display:flex;gap:10px;flex-wrap:wrap}
.btn{
  height:44px; padding:0 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
  font-weight:800; letter-spacing:.2px; cursor:pointer; transition:.15s transform;
  background:#15803d; color:#fff;
}
.btn:active{transform:translateY(1px)}
.btn.ghost{background:#2d3748}
.btn.warn{background:#b45309}
.btn[disabled]{opacity:.55;cursor:not-allowed}
.sim{
  position:relative; border:1px solid rgba(255,255,255,.08); border-radius:16px; overflow:hidden;
  background:radial-gradient(120% 120% at 50% 35%, #0b1422, #081122 60%, #070f1e);
  height:480px;
}
.sim .label{position:absolute;left:12px;top:10px;font-size:13px;font-weight:800;
  background:rgba(255,255,255,.06);border:1px solid rgba(140,170,255,.22);
  padding:6px 10px;border-radius:999px}
.sim .slot{position:absolute;right:10px;top:10px;width:100px;height:100px;border-radius:16px;
  border:1px solid rgba(0,255,200,.28);
  background:linear-gradient(180deg,rgba(0,255,170,.12),rgba(0,140,120,.10));
  display:flex;align-items:center;justify-content:center;font-weight:700;color:#98ffe0}
canvas{width:100%;height:100%}
.rail{display:flex;align-items:center;gap:10px;flex-wrap:wrap;background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:10px}
.slotbox{width:48px;height:48px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.15);
  display:flex;align-items:center;justify-content:center;font-weight:900}
.sep{width:1px;height:26px;background:rgba(255,255,255,.25);border-radius:1px;margin:0 4px}
.chip{display:inline-flex;align-items:center;justify-content:center;min-width:38px;height:38px;border-radius:999px;
  background:radial-gradient(120% 120% at 30% 28%, #19d5cc, #0aa39a 60%); color:#052a29; font-weight:900;
  box-shadow:inset 0 2px 6px rgba(255,255,255,.18), inset 0 -6px 10px rgba(0,0,0,.25)}
.chip.gold{background:radial-gradient(120% 120% at 30% 28%, #ffeeb4, #f4c655 60%); color:#241a05;
  box-shadow:0 0 18px rgba(255,220,120,.45), inset 0 2px 6px rgba(255,255,255,.35), inset 0 -6px 12px rgba(0,0,0,.25)}
.fly{position:fixed;z-index:80;min-width:38px;height:38px;border-radius:999px;display:flex;align-items:center;justify-content:center;
  font-weight:900;pointer-events:none;background:radial-gradient(120% 120% at 30% 28%, #ffeeb4, #f4c655 60%); color:#241a05;
  box-shadow:0 0 18px rgba(255,220,120,.45), inset 0 2px 6px rgba(255,255,255,.35), inset 0 -6px 12px rgba(0,0,0,.25)}
.small{opacity:.85}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>EuroJackpot ‚Ä¢ Premium Studio</h1>
    <div class="by">by ENOWEB</div>
  </div>

  <div class="grid grid-2">
    <div class="card">
      <div class="title">üé¨ Simulation (neues System)</div>
      <div class="grid grid-2">
        <div class="sim" id="simA">
          <div class="label">Haupttrommel (1‚Äì50)</div>
          <div class="slot" id="slotA">Auswurf</div>
          <canvas id="cvA" width="640" height="480"></canvas>
        </div>
        <div class="sim" id="simB">
          <div class="label">Eurotrommel (1‚Äì12)</div>
          <div class="slot" id="slotB">Auswurf</div>
          <canvas id="cvB" width="640" height="480"></canvas>
        </div>
      </div>

      <div class="rail" id="rail">
        <div class="slotbox" data-slot="A1"></div>
        <div class="slotbox" data-slot="A2"></div>
        <div class="slotbox" data-slot="A3"></div>
        <div class="slotbox" data-slot="A4"></div>
        <div class="slotbox" data-slot="A5"></div>
        <div class="sep"></div>
        <div class="slotbox" data-slot="B1"></div>
        <div class="slotbox" data-slot="B2"></div>
      </div>

      <div class="controls" style="margin-top:10px">
        <button class="btn" id="btnStart">Ziehung starten (5+2)</button>
        <button class="btn warn" id="btnReset">Reset</button>
        <div class="small" id="resultText">Noch kein Ergebnis</div>
      </div>
    </div>

    <div class="card">
      <div class="title">üìÇ Archiv (Auto + Fallback)</div>
      <input id="archiveUrl" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0b1422;color:#eaf7ff"
        value="https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_eurojackpot.zip">
      <div class="controls" style="margin-top:10px">
        <button class="btn" id="btnLoad">üì• Laden</button>
        <button class="btn ghost" id="btnSaveZip">‚¨áÔ∏è ZIP speichern</button>
        <a class="btn ghost" id="direct" target="_blank" rel="noopener">üîó Direktlink</a>
      </div>
      <div id="statusText" class="small" style="margin-top:6px">Noch kein Archiv geladen.</div>
      <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:8px;margin:10px 0">
        <div class="card" style="padding:8px;text-align:center">Ziehungen<br><b id="kpiCount">‚Äì</b></div>
        <div class="card" style="padding:8px;text-align:center">Von<br><b id="kpiFrom">‚Äì</b></div>
        <div class="card" style="padding:8px;text-align:center">Bis<br><b id="kpiTo">‚Äì</b></div>
      </div>
      <div class="small">Falls blockiert: ZIP/TXT hier hochladen oder CSV/TXT einf√ºgen.</div>
      <input id="fileInput" type="file" accept=".zip,.csv,.txt" style="margin-top:8px;width:100%">
      <textarea id="pasteBox" rows="5" placeholder="CSV/TXT hier einf√ºgen‚Ä¶" style="margin-top:8px;width:100%;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0b1422;color:#eaf7ff;padding:10px"></textarea>
      <button class="btn ghost" id="btnParsePaste" style="margin-top:8px">CSV/TXT einlesen</button>

      <div class="title" style="margin-top:20px">üìä Analyse</div>
      <div id="analysisIntro" class="small">Warte auf Ziehung‚Ä¶</div>
      <div class="grid" style="grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:8px">
        <div><div style="font-weight:800;margin-bottom:6px">Hot/Cold Haupt</div><div id="hotMain" class="small"></div></div>
        <div><div style="font-weight:800;margin-bottom:6px">Hot/Cold Euro</div><div id="hotEuro" class="small"></div></div>
        <div><div style="font-weight:800;margin-bottom:6px">Kombinationstreffer</div><div id="comboStats" class="small">‚Äì</div></div>
      </div>
    </div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
const LS_ARCH='ej_enoweb_archive_v11';

let draws=[], freqA=Array(51).fill(0), freqB=Array(13).fill(0);
async function ensureJSZip(){ return !!window.JSZip || new Promise((res)=>{ const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js'; s.onload=()=>res(true); s.onerror=()=>res(false); document.head.appendChild(s) }); }
async function fetchWithProxies(url){
  const trials=[ url, 'https://cors.isomorphic-git.org/'+url, 'https://api.allorigins.win/raw?url='+encodeURIComponent(url), 'https://thingproxy.freeboard.io/fetch/'+url, 'https://corsproxy.io/?'+encodeURIComponent(url) ];
  let last=null;
  for(const u of trials){
    try{
      const res=await fetch(u,{cache:'no-store'}); if(!res.ok) throw new Error('HTTP '+res.status);
      const ct=res.headers.get('content-type')||'';
      if(ct.includes('zip') || u.endsWith('.zip')){
        if(!(await ensureJSZip())) throw new Error('JSZip nicht verf√ºgbar.');
        const blob=await res.blob(); const zip=await JSZip.loadAsync(blob);
        const entries=Object.values(zip.files);
        const entry=entries.find(f=>/\\.(txt|csv)$/i.test(f.name) && /eurojackpot/i.test(f.name)) || entries.find(f=>/\\.(txt|csv)$/i.test(f.name));
        if(!entry) throw new Error('ZIP ohne TXT/CSV.'); return await entry.async('string');
      }else{ return await res.text(); }
    }catch(e){ last=e; }
  } throw last||new Error('Download fehlgeschlagen');
}
function parseArchiveText(txt){
  try{
    const lines=txt.replace(/\\r\\n?/g,'\\n').split('\\n').map(l=>l.trim()).filter(Boolean);
    const usable = lines.filter(l => (l.match(/\\d+/g)||[]).length>=7);
    const dmy=/(\\d{1,2})[.\\-\\/](\\d{1,2})[.\\-\\/](\\d{2,4})/, ymd=/(\\d{4})[.\\-\\/](\\d{1,2})[.\\-\\/](\\d{1,2})/;
    function iso(y,m,d){ const t=new Date(+y,+m-1,+d); return isNaN(t)?null:t.toISOString().slice(0,10); }
    function parseLine(l){
      const t=l.split(/;|,|\\t|\\s+/).filter(Boolean); let date=null, rest=[];
      if(t.length&&dmy.test(t[0])){ const m=t[0].match(dmy); date=iso(m[3],m[2],m[1]); rest=t.slice(1); }
      else if(t.length&&ymd.test(t[0])){ const m=t[0].match(ymd); date=iso(m[1],m[2],m[3]); rest=t.slice(1); }
      else{ rest=t.slice(0); }
      const nums=rest.map(Number).filter(n=>Number.isFinite(n));
      if(!date){ const only=(l.match(/\\d+/g)||[]).map(Number); if(only.length>=7){ const [a,b,c]=only.slice(0,3); const dd=iso(c,b,a); if(dd) date=dd; } }
      const main=nums.filter(n=>n>=1&&n<=50).slice(0,5).sort((a,b)=>a-b);
      const euro=nums.filter(n=>n>=1&&n<=12).slice(0,2).sort((a,b)=>a-b);
      if(!date||main.length!==5||euro.length!==2) return null;
      return {date, main, euro};
    }
    draws=[]; freqA.fill(0); freqB.fill(0);
    usable.forEach(l=>{ const r=parseLine(l); if(r) draws.push(r); });
    if(!draws.length) throw new Error('Keine g√ºltigen Ziehungen erkannt.');
    draws.sort((a,b)=>a.date.localeCompare(b.date));
    draws.forEach(d=>{ d.main.forEach(n=>freqA[n]++); d.euro.forEach(n=>freqB[n]++); });
    localStorage.setItem(LS_ARCH, txt);
    $('#statusText').textContent='Archiv geladen ‚úî';
    $('#kpiCount').textContent=draws.length; $('#kpiFrom').textContent=draws[0].date; $('#kpiTo').textContent=draws.at(-1).date;
    renderHotCold();
  }catch(e){ $('#statusText').textContent='Fehler: '+e.message; }
}
$('#btnLoad').onclick=async()=>{
  const url=$('#archiveUrl').value.trim(); $('#statusText').textContent='Lade Archiv‚Ä¶';
  try{ const text=await fetchWithProxies(url); parseArchiveText(text); }
  catch(e){ const saved=localStorage.getItem(LS_ARCH); if(saved){ parseArchiveText(saved); $('#statusText').textContent='Online blockiert ‚Äì lokale Kopie geladen.'; } else $('#statusText').textContent='Download blockiert ‚Äì bitte Datei hochladen oder Text einf√ºgen.'; }
};
$('#direct').href=$('#archiveUrl').value.trim();
$('#btnSaveZip').onclick=async()=>{
  const url=$('#archiveUrl').value.trim();
  const trials=['https://cors.isomorphic-git.org/'+url,'https://api.allorigins.win/raw?url='+encodeURIComponent(url),'https://thingproxy.freeboard.io/fetch/'+url,'https://corsproxy.io/?'+encodeURIComponent(url),url];
  for(const u of trials){ try{ const r=await fetch(u); if(!r.ok) throw 0; const b=await r.blob(); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='archiv_eurojackpot.zip'; a.click(); URL.revokeObjectURL(a.href); return; }catch{} }
  alert('ZIP-Download nicht m√∂glich.');
};
$('#fileInput').addEventListener('change', async (e)=>{
  const f=e.target.files?.[0]; if(!f) return;
  try{
    if(f.name.toLowerCase().endsWith('.zip')){
      if(!(await ensureJSZip())){ alert('JSZip nicht verf√ºgbar ‚Äì bitte TXT/CSV hochladen.'); return; }
      const zip=await JSZip.loadAsync(f); const entries=Object.values(zip.files);
      const entry=entries.find(x=>/\\.(txt|csv)$/i.test(x.name) && /eurojackpot/i.test(x.name)) || entries.find(x=>/\\.(txt|csv)$/i.test(x.name));
      if(!entry) throw new Error('ZIP ohne TXT/CSV.'); const txt=await entry.async('string'); parseArchiveText(txt);
    }else{ parseArchiveText(await f.text()); }
  }catch(err){ $('#statusText').textContent='Fehler: '+err.message; }
});
$('#btnParsePaste').onclick=()=>{ const v=$('#pasteBox').value; if(v.trim()) parseArchiveText(v); };
(()=>{ const saved=localStorage.getItem(LS_ARCH); if(saved){ try{ parseArchiveText(saved); $('#statusText').textContent='Archiv aus Speicher geladen ‚úî'; }catch{} } })();
function pills(freq, maxN){ const vals=freq.slice(1,maxN+1); const max=Math.max(...vals,1), min=Math.min(...vals.filter(v=>v>0),max);
  return vals.map((v,i)=>{ const n=i+1; const hot=v>=(min+(max-min)*0.66), cold=v<=(min+(max-min)*0.33);
  const bg=hot?'rgba(30,200,160,.25)':(cold?'rgba(90,120,255,.22)':'rgba(255,255,255,.06)');
  return `<span style="display:inline-flex;align-items:center;justify-content:center;min-width:34px;height:28px;margin:3px;border-radius:8px;background:${bg};border:1px solid rgba(255,255,255,.12);font-weight:800">${String(n).padStart(2,'0')}<small style="opacity:.7;margin-left:6px">${v}</small></span>`; }).join(''); }
function renderHotCold(){ $('#hotMain').innerHTML=pills(freqA,50); $('#hotEuro').innerHTML=pills(freqB,12); }

class PremiumDrum{
  constructor(canvas, count, slotEl){
    this.cv=canvas; this.ctx=canvas.getContext('2d');
    this.slotEl=slotEl;
    this.W=canvas.clientWidth; this.H=canvas.clientHeight; canvas.width=this.W; canvas.height=this.H;
    this.cx=this.W*0.48; this.cy=this.H*0.56; this.R=Math.min(this.W,this.H)*0.38;
    this.r=Math.max(12,this.R*0.09);
    this.cam={scale:1,tx:0,ty:0,toScale:1,toTx:0,toTy:0,t:1};
    this.pads=[0,Math.PI*0.66,Math.PI*1.33];
    this.padDir=1; this.padSpeed=1.8; this.padFlip=1800+Math.random()*1600;
    this.balls=[]; this.pool=new Set(Array.from({length:count},(_,i)=>i+1));
    for(const n of this.pool){
      this.balls.push({ n, a:Math.random()*Math.PI*2, w:(Math.random()<.5?-1:1)*(1.2+Math.random()*1.3),
        rMul:0.68+Math.random()*0.12, dr:0, spin:Math.random()*Math.PI*2, live:true, flip:400+Math.random()*700 });
    }
    this.intake= -Math.PI*0.12 + Math.PI/2;
    this.last=performance.now(); requestAnimationFrame(this.loop.bind(this));
  }
  xy(a,m=this.R*0.72){ return {x:this.cx+Math.cos(a)*m, y:this.cy+Math.sin(a)*m}; }
  async eject(onDrop){
    const P=this.xy(this.intake,this.R*0.88); let best=null,bd=1e9;
    for(const b of this.balls){ if(!b.live) continue; const p=this.xy(b.a,this.R*b.rMul); const d=(p.x-P.x)**2+(p.y-P.y)**2; if(d<bd){bd=d; best=b;} }
    if(!best) return null;
    this.cam={...this.cam,toScale:1.35,toTx:this.W*0.5-P.x,toTy:this.H*0.52-P.y,t:0};
    for(let i=0;i<16;i++){ best.w*=0.85; best.a+=(this.intake-best.a)*0.18; best.spin+=0.6; await sleep(18); }
    if(onDrop){ onDrop({num:best.n, start:this.xy(this.intake,this.R*0.9)}); }
    best.live=false; this.pool.delete(best.n);
    this.cam={...this.cam,toScale:1,toTx:0,toTy:0,t:0};
    return best.n;
  }
  update(dt){
    if(this.cam.t<1){ this.cam.t=Math.min(1,this.cam.t+dt*1.2);
      const e=this.cam.t*this.cam.t*(3-2*this.cam.t);
      this.cam.scale+= (this.cam.toScale-this.cam.scale)*e*dt*4;
      this.cam.tx+= (this.cam.toTx-this.cam.tx)*e*dt*4;
      this.cam.ty+= (this.cam.toTy-this.cam.ty)*e*dt*4;
    }
    this.padFlip-=dt*1000; if(this.padFlip<=0){ this.padDir*=-1; this.padFlip=1800+Math.random()*1600; }
    this.pads=this.pads.map(a=>a+this.padDir*1.8*dt);
    for(const b of this.balls){
      if(!b.live) continue;
      b.flip-=dt*1000; if(b.flip<=0){ b.w*=-1; b.flip=400+Math.random()*700; }
      b.w += (Math.random()*2-1)*0.06; b.w=clamp(b.w,-2.8,2.8);
      b.a = (b.a + b.w*dt + Math.PI*2)%(Math.PI*2);
      b.dr += (Math.random()*2-1)*0.004; b.dr=clamp(b.dr,-0.08,0.08);
      b.rMul = clamp(b.rMul + b.dr*dt, 0.62, 0.80);
      b.spin += b.w*0.45;
    }
    const alive=this.balls.filter(b=>b.live).sort((a,b)=>a.a-b.a);
    const minGap=(Math.PI*2)/Math.max(alive.length,2)*0.22;
    for(let i=0;i<alive.length;i++){
      const A=alive[i], B=alive[(i+1)%alive.length];
      let gap=(B.a-A.a+Math.PI*2)%(Math.PI*2);
      if(gap<minGap){ const push=(minGap-gap)/2; A.a-=push; B.a+=push; A.w-=push*0.6; B.w+=push*0.6; }
    }
  }
  drawGlass(ctx){
    ctx.save(); ctx.translate(this.cx,this.cy);
    const R=this.R, sides=12;
    ctx.lineWidth=16;
    const g=ctx.createLinearGradient(-R,0,R,0);
    g.addColorStop(0,'rgba(20,240,200,.10)');
    g.addColorStop(.5,'rgba(255,255,255,.12)');
    g.addColorStop(1,'rgba(20,240,200,.10)');
    ctx.strokeStyle=g;
    ctx.beginPath();
    for(let i=0;i<=sides;i++){ const a=i/sides*Math.PI*2; const x=Math.cos(a)*R, y=Math.sin(a)*R; if(i) ctx.lineTo(x,y); else ctx.moveTo(x,y); }
    ctx.stroke();
    const ig=ctx.createRadialGradient(0,0,R*0.2, 0,0,R*1.0);
    ig.addColorStop(0,'rgba(0,0,0,0)'); ig.addColorStop(1,'rgba(0,0,0,.35)');
    ctx.fillStyle=ig; ctx.beginPath(); ctx.arc(0,0,R,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }
  drawPaddles(ctx){
    ctx.save(); ctx.translate(this.cx,this.cy);
    for(let trail=0; trail<3; trail++){
      ctx.save(); ctx.globalAlpha=0.16*(3-trail); ctx.fillStyle='#19d5cc';
      for(const a of this.pads){ ctx.save(); ctx.rotate(a - trail*0.08); roundRect(ctx,-12,-6,this.R*0.86,12,6); ctx.fill(); ctx.restore(); }
      ctx.restore();
    }
    ctx.restore();
  }
  drawPipe(ctx){
    const slot=this.slotEl.getBoundingClientRect();
    const cvRect=this.cv.getBoundingClientRect();
    const P=this.xy(this.intake,this.R*0.88);
    const sx=P.x+6, sy=P.y-6;
    const ex=slot.left - cvRect.left + slot.width*0.1;
    const ey=slot.top  - cvRect.top  + slot.height*0.3;
    const cx=(sx+ex)/2 + 60, cy=(sy+ey)/2 - 80;
    ctx.save();
    ctx.lineWidth=16; ctx.strokeStyle='rgba(140,255,230,.12)';
    ctx.beginPath(); ctx.moveTo(sx,sy); ctx.quadraticCurveTo(cx,cy,ex,ey); ctx.stroke();
    ctx.lineWidth=4; ctx.strokeStyle='rgba(255,255,255,.15)'; ctx.stroke();
    ctx.translate(P.x,P.y); ctx.rotate(this.intake);
    ctx.fillStyle='rgba(120,255,230,.18)'; roundRect(ctx,-18,-74,36,148,12); ctx.fill();
    ctx.restore();
  }
  drawBall(ctx,p,rad,num,spin){
    const g=ctx.createRadialGradient(p.x-rad*0.35,p.y-rad*0.4,rad*0.1,p.x,p.y,rad*1.1);
    g.addColorStop(0,'#1fe8dc'); g.addColorStop(0.6,'#10b5ac'); g.addColorStop(1,'#0b7670');
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(p.x,p.y,rad,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='rgba(0,0,0,.35)'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(p.x,p.y,rad,0,Math.PI*2); ctx.stroke();
    ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(spin); ctx.globalAlpha=.18; ctx.fillStyle='#fff'; ctx.fillRect(-rad*0.8,-rad*0.12,rad*1.6,rad*0.24); ctx.restore();
    ctx.font='800 14px Inter,system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.lineWidth=3; ctx.strokeStyle='rgba(0,0,0,.55)'; ctx.strokeText(String(num).padStart(2,'0'),p.x,p.y);
    ctx.fillStyle='#eafffb'; ctx.fillText(String(num).padStart(2,'0'),p.x,p.y);
  }
  frame(ts){
    const dt=Math.min(1.6,Math.max(0.6,(ts-this.last)/16))*0.016; this.last=ts;
    this.update(dt);
    const ctx=this.ctx; ctx.clearRect(0,0,this.W,this.H);
    ctx.save(); ctx.translate(this.cam.tx,this.cam.ty); ctx.scale(this.cam.scale,this.cam.scale);
    this.drawGlass(ctx); this.drawPaddles(ctx); this.drawPipe(ctx);
    for(const b of this.balls){ if(!b.live) continue; const p=this.xy(b.a,this.R*b.rMul); this.drawBall(ctx,p,this.r,b.n,b.spin); }
    ctx.restore();
    requestAnimationFrame(this.frame.bind(this));
  }
  loop(ts){ this.frame(ts||performance.now()); }
}
function roundRect(ctx,x,y,w,h,r){ const rr=Math.min(r,Math.abs(w)/2,Math.abs(h)/2);
  ctx.beginPath(); ctx.moveTo(x+rr,y); ctx.arcTo(x+w,y,x+w,y+h,rr); ctx.arcTo(x+w,y+h,x,y+h,rr);
  ctx.arcTo(x,y+h,x,y,rr); ctx.arcTo(x,y,x+w,y,rr); ctx.closePath();
}
const rail=document.getElementById('rail');
function slotPlace(slot,num,gold=false){ rail.querySelector(`[data-slot="${slot}"]`).innerHTML=`<span class="chip ${gold?'gold':''}">${String(num).padStart(2,'0')}</span>`; }
function bez(p0,p1,p2,t){ const a=(1-t)*(1-t), b=2*(1-t)*t, c=t*t; return {x:a*p0.x+b*p1.x+c*p2.x, y:a*p0.y+b*p1.y+c*p2.y}; }
async function flyTo(slotElement,start,num,gold){
  const el=rail.querySelector(`[data-slot="${slotElement}"]`), r=el.getBoundingClientRect();
  const sx=start.x+90, sy=start.y-6, ex=r.left+r.width/2, ey=r.top+r.height/2;
  const ctrl={x:(sx+ex)/2+100, y:(sy+ey)/2-50};
  const chip=document.createElement('div'); chip.className='fly'; chip.textContent=String(num).padStart(2,'0');
  chip.style.left=(sx-19)+'px'; chip.style.top=(sy-19)+'px'; document.body.appendChild(chip);
  const D=Math.hypot(ex-sx,ey-sy), dur=1000+Math.min(600,D);
  await new Promise(res=>{ const t0=performance.now(); (function step(t){
      const u=Math.min(1,(t-t0)/dur); const p=bez({x:sx,y:sy},ctrl,{x:ex,y:ey},u);
      const rot=Math.atan2(p.y-sy,p.x-sx)+u*6*Math.PI;
      chip.style.transform=`translate(${p.x-sx}px,${p.y-sy}px) rotate(${rot}rad)`;
      if(u<1) requestAnimationFrame(step); else res();
  })(t0); });
  chip.remove(); slotPlace(slotElement,num,gold);
}

const drumA=new PremiumDrum(document.getElementById('cvA'),50,document.getElementById('slotA'));
const drumB=new PremiumDrum(document.getElementById('cvB'),12,document.getElementById('slotB'));
let result={A:[],B:[],ts:null}, busy=false;
document.getElementById('btnReset').onclick=()=>location.reload();
async function drawSet(drum,count,prefix,isEuro=false){
  const used=new Set();
  for(let i=0;i<count;i++){
    let n=null;
    do{ n=await drum.eject(({num,start})=>flyTo(`${prefix}${i+1}`,start,num,isEuro)); }
    while(n==null || used.has(n));
    used.add(n);
    (isEuro?result.B:result.A).push(n);
    await sleep(120);
  }
}
document.getElementById('btnStart').onclick=async(e)=>{
  if(busy) return; busy=true; e.currentTarget.setAttribute('disabled','true');
  result={A:[],B:[],ts:new Date().toISOString()};
  await drawSet(drumA,5,'A',false);
  await drawSet(drumB,2,'B',true);
  result.A.sort((a,b)=>a-b); result.B.sort((a,b)=>a-b);
  for(let i=0;i<5;i++) slotPlace('A'+(i+1),result.A[i],false);
  for(let i=0;i<2;i++) slotPlace('B'+(i+1),result.B[i],true);
  $('#resultText').innerHTML = `<b>Ergebnis:</b> Haupt: ${result.A.map(n=>String(n).padStart(2,'0')).join(' ')} ¬∑ Euro: ${result.B.map(n=>String(n).padStart(2,'0'))} <div class="small">${result.ts}</div>`;
  analyze(); busy=false; e.currentTarget.removeAttribute('disabled');
};
function analyze(){
  if(!draws.length){ $('#analysisIntro').textContent='Keine Archivdaten geladen.'; return; }
  $('#analysisIntro').textContent=`Archiv aktiv: ${draws.length} Ziehungen`;
  const set=new Set(result.A); let m5=0,m4=0,m3=0,e2=0,e1=0;
  for(const d of draws){
    const mm=d.main.filter(n=>set.has(n)).length; if(mm===5)m5++; else if(mm===4)m4++; else if(mm===3)m3++;
    const me=d.euro.filter(n=>result.B.includes(n)).length; if(me===2)e2++; else if(me===1)e1++;
  }
  $('#comboStats').innerHTML = `üéØ 5/5: ${m5}√ó ¬∑ 4/5: ${m4}√ó ¬∑ 3/5: ${m3}√ó<br>‚≠ê Euro 2/2: ${e2}√ó ¬∑ 1/2: ${e1}√ó`;
}
</script>
</body>
</html>
