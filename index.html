<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Eurojackpot – Venus & Pearl (v12)</title>
<style>
  :root{--bg:#0b1220;--fg:#e8eef9;--glass:rgba(255,255,255,.06);--border:rgba(255,255,255,.12);--accent:rgba(99,102,241,.45)}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg)}
  .wrap{max-width:1100px;margin:18px auto;padding:0 12px}
  .nav{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:12px}
  .nav button{display:flex;align-items:center;justify-content:center;gap:.5rem;border:1px solid var(--border);background:var(--glass);border-radius:.9rem;padding:16px;cursor:pointer}
  .nav .active{box-shadow:0 0 0 2px var(--accent) inset}
  .panel{margin-top:14px;background:var(--glass);border:1px solid var(--border);border-radius:1rem;padding:1rem}
  .badge{display:inline-block;padding:.2rem .6rem;border-radius:.5rem;border:1px solid var(--border);font-size:.85rem;opacity:.95}
  .btn{padding:.55rem .9rem;border-radius:.6rem;border:1px solid var(--border);background:rgba(16,185,129,.18);color:var(--fg);cursor:pointer}
  .btn-amber{background:rgba(245,158,11,.2)}
  .chip{display:inline-flex;align-items:center;justify-content:center;min-width:34px;height:34px;border-radius:999px;padding:0 .5rem;border:1px solid rgba(255,255,255,.2);margin:.15rem;background:#fff;color:#111;font-weight:700}
  #dbg{position:fixed;left:12px;bottom:12px;font:12px/1.2 ui-monospace,Consolas,monospace;color:#b7c7ff;background:rgba(17,24,39,.78);padding:.35rem .5rem;border:1px solid var(--border);border-radius:.4rem}
  canvas{background:#0b1022;border:1px solid rgba(255,255,255,.1);border-radius:.7rem}
</style>
</head>
<body>
<div class="wrap">
  <div class="nav">
    <button class="active">🎱 Trommel</button>
    <button>📁 Archiv</button><button>🗺️ Map</button><button>⚡ Generieren</button><button>📊 Analyse</button><button>⭐ Favoriten</button>
  </div>

  <section class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
      <h2 style="margin:0;font-weight:800">🎱 Ziehung – Trommel</h2>
      <div class="badge" id="drumLabel">Venus · 50 gelbe Styroporkugeln · Ø 4,5 cm · 4 g</div>
    </div>

    <div class="panel" style="display:grid;grid-template-columns:1fr 340px;gap:14px">
      <div>
        <canvas id="drumCanvas" width="780" height="560"></canvas>
      </div>
      <div>
        <div class="panel">
          <div style="font-weight:700;margin-bottom:.4rem">Ablauf</div>
          <p style="margin:.3rem 0 .6rem 0;opacity:.95">
            Ziehungstrommeln heißen „<b>Venus</b>“ und „<b>Pearl</b>“. Venus: 50 gelbe Styroporkugeln (Hauptzahlen), kräftiges
            Gebläse von unten, oben Fangvorrichtung. Danach Pearl: 12 weiße Kugeln → 2 Eurozahlen.
          </p>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn" id="startDraw">🎬 Start Ziehung</button>
            <button class="btn btn-amber" id="resetDraw">🔄 Reset</button>
          </div>
          <div style="margin-top:.7rem">
            <div class="badge">Gezogene Hauptzahlen (Venus)</div>
            <div id="outMain" style="margin-top:.25rem;display:flex;flex-wrap:wrap"></div>
            <div class="badge" style="margin-top:.7rem">Gezogene Eurozahlen (Pearl)</div>
            <div id="outEuro" style="margin-top:.25rem;display:flex;flex-wrap:wrap"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<div id="dbg">init…</div>

<script>
(function(){
  // Physical scaling
  const BALL_DIAM_CM=4.5, BALL_MASS_G=4.0, DRUM_DIAM_CM=70;
  const canvas=document.getElementById('drumCanvas');
  const ctx=canvas.getContext('2d',{alpha:false});
  const W=canvas.width, H=canvas.height, CX=W*0.5, CY=H*0.52;
  const DRUM_R=Math.min(W,H)*0.44;
  const cm2px=(DRUM_R*2)/DRUM_DIAM_CM;
  const R=Math.max(12,(BALL_DIAM_CM*cm2px)/2);

  // Catcher top-right
  const CATCH={x:CX+DRUM_R*0.47, y:CY-DRUM_R*0.78, r:R+5};

  // Bottom jets (strong updraft)
  const JETS=[
    {x:CX-DRUM_R*0.28, y:CY+DRUM_R*0.58, phase:0.0},
    {x:CX,             y:CY+DRUM_R*0.60, phase:1.4},
    {x:CX+DRUM_R*0.28, y:CY+DRUM_R*0.58, phase:2.8}
  ];
  const JET_R=Math.max(90,R*3.5);

  // Airflow swirl (clockwise recirculation)
  const OMEGA=0.8; // swirl strength

  // Gravity & drag
  const GRAV_Y=520; // px/s^2
  const LIN_DRAG=0.35; // proportional to speed

  // UI
  const outMain=document.getElementById('outMain'), outEuro=document.getElementById('outEuro');
  const startBtn=document.getElementById('startDraw'), resetBtn=document.getElementById('resetDraw'), label=document.getElementById('drumLabel');
  const dbg=document.getElementById('dbg');

  // State
  let balls=[], phase='idle', running=false, raf=0, lastT=0, lastCatch=0;
  let drawnMain=[], drawnEuro=[];

  // Helpers
  function rng(a,b){return a+Math.random()*(b-a);}
  function pill(n){const s=document.createElement('span');s.className='chip';s.textContent=n;return s;}
  function render(){outMain.innerHTML='';drawnMain.forEach(n=>outMain.appendChild(pill(n)));outEuro.innerHTML='';drawnEuro.forEach(n=>outEuro.appendChild(pill(n)));}

  // Spawn without overlap (Poissonish)
  function spawn(count){
    const res=[], minD=R*2.02; let tries=0;
    while(res.length<count && tries<8000){
      tries++;
      const a=Math.random()*Math.PI*2, r=DRUM_R*rng(0.2,0.9);
      const x=CX+Math.cos(a)*r, y=CY+Math.sin(a)*r;
      if(Math.hypot(x-CX,y-CY) > (DRUM_R - R*1.6)) continue;
      let ok=true; for(const o of res){ if(Math.hypot(o.x-x,o.y-y)<minD){ok=false;break;} }
      if(ok) res.push({id:res.length+1,x,y,vx:rng(-40,40),vy:rng(-40,40),r:R});
    }
    while(res.length<count){
      const a=Math.random()*Math.PI*2, r=DRUM_R*rng(0.2,0.95);
      res.push({id:res.length+1,x:CX+Math.cos(a)*r,y:CY+Math.sin(a)*r,vx:rng(-40,40),vy:rng(-40,40),r:R});
    }
    return res;
  }

  function init(count,isPearl){
    balls=spawn(count);
    label.textContent=isPearl?'Pearl · 12 weiße Styroporkugeln · Ø 4,5 cm · 4 g':'Venus · 50 gelbe Styroporkugeln · Ø 4,5 cm · 4 g';
  }

  // Drawing
  function drawDrum(isPearl){
    ctx.fillStyle='#0b1022'; ctx.fillRect(0,0,W,H);
    ctx.beginPath(); ctx.arc(CX,CY,DRUM_R,0,Math.PI*2);
    ctx.strokeStyle='rgba(210,230,255,.65)'; ctx.lineWidth=8; ctx.stroke();
    // Catch
    ctx.beginPath(); ctx.arc(CATCH.x,CATCH.y,CATCH.r,0,Math.PI*2);
    ctx.strokeStyle='rgba(255,255,255,.95)'; ctx.lineWidth=3; ctx.stroke();
    // Jets viz
    for(const j of JETS){ ctx.beginPath(); ctx.arc(j.x,j.y,7,0,Math.PI*2); ctx.fillStyle='rgba(120,170,255,.5)'; ctx.fill(); }
  }
  function drawBall(b,isPearl){
    ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.shadowColor='rgba(0,0,0,.45)'; ctx.shadowBlur=6;
    ctx.fillStyle=isPearl?'#FFFFFF':'#FFEB6A'; ctx.fill();
    ctx.shadowBlur=0; ctx.lineWidth=2; ctx.strokeStyle='rgba(0,0,0,.6)'; ctx.stroke();
    ctx.fillStyle='#111'; ctx.font='bold 13px Inter, system-ui';
    const s=String(b.id), w=ctx.measureText(s).width; ctx.fillText(s,b.x-w/2,b.y+4);
  }

  // Spatial grid
  const CELL=Math.max(22,R*2.2);
  const neigh=[[0,0],[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1]];
  function key(x,y){return (Math.floor(x/CELL))+','+(Math.floor(y/CELL));}

  function physics(dt, now, isPearl){
    // Build grid
    const grid=new Map();
    for(const b of balls){ const k=key(b.x,b.y); if(!grid.has(k)) grid.set(k,[]); grid.get(k).push(b); }

    for(const b of balls){
      // Forces
      let ax=0, ay=0;

      // Gravity
      ay += GRAV_Y;

      // Updraft jets (Gaussian field)
      for(const J of JETS){
        const dx=b.x-J.x, dy=b.y-J.y, d2=dx*dx+dy*dy;
        const sigma2=JET_R*JET_R;
        const strength = Math.exp(-d2/(2*sigma2));
        const pulse = 0.6+0.4*Math.sin(now*2.3+J.phase);
        ay -= 900*strength*pulse;                 // strong upward
        ax +=  120*strength*pulse * (dx/JET_R);   // slight lateral push
      }

      // Global clockwise airflow (tangential)
      const rx=b.x-CX, ry=b.y-CY, rlen=Math.hypot(rx,ry) || 1;
      const tx =  ry/rlen;   // cw tangent
      const ty = -rx/rlen;
      const swirl = OMEGA * (0.2 + 0.8*(rlen/DRUM_R)); // stronger near wall
      ax += tx * 200 * swirl;
      ay += ty * 200 * swirl;

      // Wall rolling shear (only near wall)
      const nearWall = Math.max(0,(rlen-(DRUM_R-R*1.6))/(R*1.6));
      ax += tx * 250 * nearWall;
      ay += ty * 250 * nearWall;

      // Linear air drag
      ax += -LIN_DRAG * b.vx;
      ay += -LIN_DRAG * b.vy;

      // Integrate
      b.vx += ax*dt;
      b.vy += ay*dt;
      b.x  += b.vx*dt;
      b.y  += b.vy*dt;

      // Wall collision (respect radius)
      const ddx=b.x-CX, ddy=b.y-CY;
      const dist=Math.hypot(ddx,ddy);
      const maxR=DRUM_R - b.r - 2;
      if(dist>maxR){
        const nx=ddx/dist, ny=ddy/dist;
        b.x=CX+nx*maxR; b.y=CY+ny*maxR;
        const vn=b.vx*nx + b.vy*ny;
        const vt_x=b.vx - vn*nx, vt_y=b.vy - vn*ny;
        const REST=0.78;
        b.vx = vt_x*1.01 - REST*vn*nx;
        b.vy = vt_y*1.01 - REST*vn*ny;
      }
    }

    // Collisions via grid
    for(const b of balls){
      const ix=Math.floor(b.x/CELL), iy=Math.floor(b.y/CELL);
      for(const n of neigh){
        const arr=grid.get((ix+n[0])+','+(iy+n[1])); if(!arr) continue;
        for(const o of arr){
          if(o===b) continue;
          const dx=o.x-b.x, dy=o.y-b.y, rsum=o.r+b.r, d2=dx*dx+dy*dy;
          if(d2<rsum*rsum){
            const d=Math.sqrt(d2)||0.0001, nx=dx/d, ny=dy/d;
            // separate
            const overlap=(rsum-d), push=overlap*0.52;
            b.x-=nx*push*0.5; b.y-=ny*push*0.5;
            o.x+=nx*push*0.5; o.y+=ny*push*0.5;
            // impulse exchange
            const reln=(b.vx-o.vx)*nx+(b.vy-o.vy)*ny;
            const J=(-1.9*reln)/2;
            b.vx+=J*nx; b.vy+=J*ny;
            o.vx-=J*nx; o.vy-=J*ny;
          }
        }
      }
    }

    // Catcher
    for(let i=balls.length-1;i>=0;i--){
      const b=balls[i];
      const d=Math.hypot(b.x-CATCH.x,b.y-CATCH.y);
      const wait=(phase==='main')?1500:1800;
      if(d < CATCH.r-1){
        const nowMs=now*1000.0;
        if(nowMs - lastCatch < wait){
          // deflect out
          const nx=(b.x-CATCH.x)/(d||1), ny=(b.y-CATCH.y)/(d||1);
          b.vx += nx*120; b.vy += ny*120;
          continue;
        }
        balls.splice(i,1); lastCatch=nowMs;
        setTimeout(()=>capture(b),180);
      }
    }
  }

  function capture(ball){
    if(phase==='main'){
      drawnMain.push(ball.id); drawnMain.sort((a,b)=>a-b); render();
      if(drawnMain.length>=5) phase='switch';
    }else if(phase==='euro'){
      drawnEuro.push(ball.id); drawnEuro.sort((a,b)=>a-b); render();
      if(drawnEuro.length>=2){ phase='done'; stop(); }
    }
  }

  function draw(){
    const isPearl=(phase==='euro'||phase==='done');
    drawDrum(isPearl);
    for(const b of balls) drawBall(b,isPearl);
  }

  function loop(ts){
    if(!running) return;
    const t=ts*0.001, dt=Math.min(0.033, lastT?(t-lastT):0.016); lastT=t;
    if(phase==='main'||phase==='euro'){ physics(dt,t,(phase!=='main')); }
    else if(phase==='switch'){ phase='euro_init'; setTimeout(()=>{ init(12,true); lastCatch=performance.now(); phase='euro'; },650); }
    draw();
    dbg.textContent='phase='+phase+' | balls='+balls.length+' | main='+drawnMain.length+' euro='+drawnEuro.length;
    raf=requestAnimationFrame(loop);
  }

  function start(){ if(running) return; running=true; lastT=0; lastCatch=performance.now(); raf=requestAnimationFrame(loop); }
  function stop(){ running=false; if(raf) cancelAnimationFrame(raf); raf=0; }
  function reset(){ stop(); drawnMain=[]; drawnEuro=[]; outMain.innerHTML=''; outEuro.innerHTML=''; balls=[]; label.textContent='Venus · 50 gelbe Styroporkugeln · Ø 4,5 cm · 4 g'; phase='idle'; draw(); }

  document.getElementById('resetDraw').addEventListener('click', reset);
  document.getElementById('startDraw').addEventListener('click', ()=>{ reset(); init(50,false); phase='main'; start(); });

  // Autostart
  (function(){ reset(); init(50,false); phase='main'; start(); })();
})();
</script>
</body>
</html>
