<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Eurojackpot â€“ v15 (Trommel + Analyse)</title>
<style>
  :root{--bg:#0b1220;--fg:#e8eef9;--glass:rgba(255,255,255,.06);--border:rgba(255,255,255,.12)}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg)}
  .wrap{max-width:980px;margin:16px auto;padding:0 12px}
  .nav{display:flex;gap:8px;flex-wrap:wrap}
  .nav button{display:flex;gap:.4rem;align-items:center;border:1px solid var(--border);background:var(--glass);color:var(--fg);padding:.6rem .9rem;border-radius:.7rem;cursor:pointer}
  .nav .active{outline:2px solid rgba(99,102,241,.45)}
  .panel{margin-top:12px;background:var(--glass);border:1px solid var(--border);border-radius:1rem;padding:1rem}
  .badge{display:inline-block;padding:.2rem .6rem;border-radius:.5rem;border:1px solid var(--border);font-size:.85rem;opacity:.95}
  .btn{padding:.55rem .9rem;border-radius:.6rem;border:1px solid var(--border);background:rgba(16,185,129,.18);color:var(--fg);cursor:pointer}
  .btn-amber{background:rgba(245,158,11,.2)}
  .chip{display:inline-flex;align-items:center;justify-content:center;min-width:34px;height:34px;border-radius:999px;padding:0 .5rem;border:1px solid rgba(255,255,255,.2);margin:.15rem;background:#fff;color:#111;font-weight:700}
  .hidden{display:none}
  #dbg{position:fixed;left:8px;bottom:8px;font:11px/1.2 ui-monospace,Consolas,monospace;color:#b7c7ff;background:rgba(17,24,39,.7);padding:.25rem .4rem;border:1px solid rgba(255,255,255,.2);border-radius:.4rem;z-index:9}
  #drumBox{width:100%;aspect-ratio:4/3;max-height:70vh}
  #drumCanvas{width:100%;height:100%;background:#0b1022;border:1px solid rgba(255,255,255,.1);border-radius:.7rem;display:block}
</style>
</head>
<body>
<div class="wrap">
  <div class="nav">
    <button class="active" onclick="openTab('trommel', this)">ğŸ± Trommel</button>
    <button onclick="openTab('analyse', this)">ğŸ“Š Analyse</button>
  </div>

  <!-- TROMMEL -->
  <section id="tab-trommel" class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
      <h2 style="margin:0;font-weight:800">ğŸ± Ziehung â€“ Trommel (Venus âœ Pearl)</h2>
      <div class="badge" id="drumLabel">Venus Â· 50 gelbe Styroporkugeln Â· Ã˜ 4,5 cm Â· 4 g</div>
    </div>
    <div id="drumBox" class="panel"><canvas id="drumCanvas"></canvas></div>
    <div style="margin-top:.7rem;display:flex;gap:.5rem;flex-wrap:wrap">
      <button class="btn" id="startDraw">ğŸ¬ Start Ziehung</button>
      <button class="btn btn-amber" id="resetDraw">ğŸ”„ Reset</button>
    </div>
    <p style="opacity:.9;margin:.7rem 0 .3rem 0">
      Ziehungstrommeln: <b>Venus</b> (50 gelbe Styroporkugeln) â†’ 5 Hauptzahlen. <b>GeblÃ¤se unten</b> wirbelt, <b>Fang oben</b> fÃ¤ngt die Kugel.
      Danach <b>Pearl</b> (12 weiÃŸe) â†’ 2 Eurozahlen. Material/GrÃ¶ÃŸe: Styropor Ã˜ 4,5 cm, 4 g.
    </p>
    <div class="badge">Gezogene Hauptzahlen (Venus)</div>
    <div id="outMain" style="margin-top:.25rem;display:flex;flex-wrap:wrap"></div>
    <div class="badge" style="margin-top:.7rem">Gezogene Eurozahlen (Pearl)</div>
    <div id="outEuro" style="margin-top:.25rem;display:flex;flex-wrap:wrap"></div>
  </section>

  <!-- ANALYSE -->
  <section id="tab-analyse" class="panel hidden">
    <h2 class="text-xl" style="margin:0 0 6px 0;font-weight:800">ğŸ“Š Analyse</h2>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
      <button class="btn" id="btn-refresh-stats">ğŸ”„ Statistik aktualisieren</button>
      <button class="btn btn-amber" id="btn-clear-data">ğŸ—‘ï¸ Daten lÃ¶schen</button>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div class="panel">
        <h3 style="margin:0 0 6px 0">HÃ¤ufigkeit Hauptzahlen (1â€“50)</h3>
        <div id="freq-main" style="display:flex;flex-wrap:wrap"></div>
      </div>
      <div class="panel">
        <h3 style="margin:0 0 6px 0">HÃ¤ufigkeit Eurozahlen (1â€“12)</h3>
        <div id="freq-euro" style="display:flex;flex-wrap:wrap"></div>
      </div>
    </div>
    <div class="panel" style="margin-top:12px">
      <h3 style="margin:0 0 6px 0">Treffer-Statistik deiner Tipps</h3>
      <div id="hit-stats"></div>
    </div>
    <div class="panel" style="margin-top:12px">
      <h3 style="margin:0 0 6px 0">Verlauf (letzte Ziehungen/Generierungen)</h3>
      <div id="history"></div>
    </div>
  </section>
</div>
<div id="dbg">idleâ€¦</div>

<script>
function openTab(name, btn){
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('tab-trommel').classList.add('hidden');
  document.getElementById('tab-analyse').classList.add('hidden');
  document.getElementById('tab-'+name).classList.remove('hidden');
  if(name==='analyse' && window.EJRefreshAnalysis){ EJRefreshAnalysis(); }
}
</script>

<script>
/* === Shared data (localStorage) ========================================= */
window.EJ = window.EJ || {
  history: [], // {type:'draw'|'gen', main:[n...], euro:[n...] , ts:number}
  tips: [],    // array of {main:[5], euro:[2]}
  recordGeneratedTip(tip){ try{ if(!tip||!tip.main||!tip.euro) return; EJ.tips.push(tip); EJ._save(); }catch(e){} },
  recordDraw(main, euro){ try{ EJ.history.push({type:'draw', main:[...main], euro:[...euro], ts:Date.now()}); EJ._save(); }catch(e){} },
  _save(){ try{ localStorage.setItem('ej_data', JSON.stringify({history:EJ.history, tips:EJ.tips})); }catch(e){} },
  _load(){ try{ const j=localStorage.getItem('ej_data'); if(j){ const o=JSON.parse(j); EJ.history=o.history||[]; EJ.tips=o.tips||[]; } }catch(e){} }
}; EJ._load();

/* === Trommel (v15) â€“ Start-only, gate colors, chute ===================== */
(function(){
  const box=document.getElementById('drumBox'), canvas=document.getElementById('drumCanvas');
  const ctx=canvas.getContext('2d',{alpha:false});
  const label=document.getElementById('drumLabel'), outMain=document.getElementById('outMain'), outEuro=document.getElementById('outEuro'), dbg=document.getElementById('dbg');
  const startBtn=document.getElementById('startDraw'), resetBtn=document.getElementById('resetDraw');

  function resize(){
    const dpr=Math.max(1, Math.floor(window.devicePixelRatio||1));
    const rect=box.getBoundingClientRect();
    canvas.width = Math.floor(rect.width*dpr);
    canvas.height= Math.floor(rect.height*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    setupGeom(); drawFrame();
  }
  window.addEventListener('resize', resize);

  const BALL_DIAM_CM=4.5, DRUM_DIAM_CM=70;
  let W=0,H=0,CX=0,CY=0,DRUM_R=0,cm2px=0,R=0, CATCH, JETS, JET_R;
  function setupGeom(){
    W=canvas.clientWidth; H=canvas.clientHeight; CX=W*0.5; CY=H*0.52; DRUM_R=Math.min(W,H)*0.44;
    cm2px=(DRUM_R*2)/DRUM_DIAM_CM; R=Math.max(10,(BALL_DIAM_CM*cm2px)/2);
    CATCH={x:CX+DRUM_R*0.47,y:CY-DRUM_R*0.78,r:R+5};
    JETS=[{x:CX-DRUM_R*0.28,y:CY+DRUM_R*0.58,phase:0.0},{x:CX,y:CY+DRUM_R*0.60,phase:1.1},{x:CX+DRUM_R*0.28,y:CY+DRUM_R*0.58,phase:2.2}];
    JET_R=Math.max(90,R*3.6);
  }

  const OMEGA=1.1, GRAV_Y=540, LIN_DRAG=0.32, REST=0.78;

  let balls=[], phase='idle', running=false, raf=0, lastT=0;
  let drawnMain=[], drawnEuro=[];
  let gateOpen=false, chuteBall=null, chuteT=0;     // gate closed by default
  let capturingEnabled=false;                       // only after Start

  function rng(a,b){return a+Math.random()*(b-a);}
  function chip(n){const s=document.createElement('span');s.className='chip';s.textContent=n;return s;}
  function render(){ outMain.innerHTML=''; drawnMain.forEach(n=>outMain.appendChild(chip(n)));
                     outEuro.innerHTML=''; drawnEuro.forEach(n=>outEuro.appendChild(chip(n))); }

  function spawn(count){
    const res=[], minD=R*2.02; let tries=0;
    while(res.length<count && tries<9000){ tries++; const a=Math.random()*Math.PI*2, rr=DRUM_R*rng(0.2,0.9);
      const x=CX+Math.cos(a)*rr, y=CY+Math.sin(a)*rr; if(Math.hypot(x-CX,y-CY)>(DRUM_R-R*1.6)) continue;
      let ok=true; for(const o of res){ if(Math.hypot(o.x-x,o.y-y)<minD){ ok=false; break; } }
      if(ok) res.push({id:res.length+1,x,y,vx:rng(-60,60),vy:rng(-60,60),r:R}); }
    while(res.length<count){ const a=Math.random()*Math.PI*2, rr=DRUM_R*rng(0.2,0.95);
      res.push({id:res.length+1,x:CX+Math.cos(a)*rr,y:CY+Math.sin(a)*rr,vx:rng(-60,60),vy:rng(-60,60),r:R}); }
    return res;
  }

  function init(count,isPearl){ balls=spawn(count);
    label.textContent = isPearl ? 'Pearl Â· 12 weiÃŸe Styroporkugeln Â· Ã˜ 4,5 cm Â· 4 g' : 'Venus Â· 50 gelbe Styroporkugeln Â· Ã˜ 4,5 cm Â· 4 g'; }

  function drawDrum(isPearl){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.beginPath(); ctx.arc(CX,CY,DRUM_R,0,Math.PI*2); ctx.strokeStyle='rgba(210,230,255,.65)'; ctx.lineWidth=8; ctx.stroke();
    ctx.beginPath(); ctx.arc(CATCH.x,CATCH.y,CATCH.r,0,Math.PI*2);
    ctx.strokeStyle = gateOpen ? '#80e27e' : '#ff5252'; ctx.lineWidth=3; ctx.stroke();
    const outX=CX+DRUM_R*0.6, outY=CY+DRUM_R*0.35;
    ctx.beginPath(); ctx.moveTo(CATCH.x, CATCH.y+CATCH.r); ctx.quadraticCurveTo(CX+DRUM_R*0.55, CY-DRUM_R*0.2, outX, outY);
    ctx.lineWidth=6; ctx.strokeStyle='rgba(200,220,255,.25)'; ctx.stroke();
    for(const j of JETS){ ctx.beginPath(); ctx.arc(j.x,j.y,7,0,Math.PI*2); ctx.fillStyle='rgba(120,170,255,.5)'; ctx.fill(); }
  }
  function drawBall(b,isPearl){
    ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.shadowColor='rgba(0,0,0,.45)'; ctx.shadowBlur=6;
    ctx.fillStyle=isPearl?'#FFFFFF':'#FFEB6A'; ctx.fill(); ctx.shadowBlur=0; ctx.lineWidth=2; ctx.strokeStyle='rgba(0,0,0,.6)'; ctx.stroke();
    ctx.fillStyle='#111'; ctx.font='bold 13px Inter, system-ui'; const s=String(b.id), w=ctx.measureText(s).width; ctx.fillText(s,b.x-w/2,b.y+4);
  }

  function chutePoint(t){ const p0={x:CATCH.x,y:CATCH.y+CATCH.r}, p1={x:CX+DRUM_R*0.55,y:CY-DRUM_R*0.2}, p2={x:CX+DRUM_R*0.6,y:CY+DRUM_R*0.35};
    const u=1-t; return {x:u*u*p0.x+2*u*t*p1.x+t*t*p2.x, y:u*u*p0.y+2*u*t*p1.y+t*t*p2.y}; }

  const neigh=[[0,0],[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1]];
  function CELL(){ return Math.max(22,R*2.2); }

  function physics(dt,now,isPearl){
    const grid=new Map(), C=CELL();
    for(const b of balls){ const k=(Math.floor(b.x/C))+','+(Math.floor(b.y/C)); if(!grid.has(k)) grid.set(k,[]); grid.get(k).push(b); }
    for(const b of balls){
      let ax=0, ay=0; ay+=540;
      for(const J of JETS){ const dx=b.x-J.x, dy=b.y-J.y, d2=dx*dx+dy*dy, sigma2=JET_R*JET_R;
        const s=Math.exp(-d2/(2*sigma2)); const p=0.65+0.45*Math.sin(now*2.6+J.phase);
        ay -= 1080*s*p; ax += 140*s*p*(dx/JET_R); }
      const rx=b.x-CX, ry=b.y-CY, rlen=Math.hypot(rx,ry)||1; const tx=ry/rlen, ty=-rx/rlen;
      const swirl=1.1*(0.2+0.8*(rlen/DRUM_R)); ax+=tx*250*swirl; ay+=ty*250*swirl;
      const nearWall=Math.max(0,(rlen-(DRUM_R-R*1.6))/(R*1.6)); ax+=tx*320*nearWall; ay+=ty*320*nearWall;
      ax+=-0.32*b.vx; ay+=-0.32*b.vy;
      b.vx+=ax*dt; b.vy+=ay*dt; b.x+=b.vx*dt; b.y+=b.vy*dt;
      const ddx=b.x-CX, ddy=b.y-CY, dist=Math.hypot(ddx,ddy), maxR=DRUM_R-b.r-2;
      if(dist>maxR){ const nx=ddx/dist, ny=ddy/dist; b.x=CX+nx*maxR; b.y=CY+ny*maxR;
        const vn=b.vx*nx+b.vy*ny, vtx=b.vx-vn*nx, vty=b.vy-vn*ny; b.vx=vtx*1.01-0.78*vn*nx; b.vy=vty*1.01-0.78*vn*ny; }
    }
    for(const b of balls){ const C=CELL(), ix=Math.floor(b.x/C), iy=Math.floor(b.y/C);
      for(const n of neigh){ const arr=grid.get((ix+n[0])+','+(iy+n[1])); if(!arr) continue;
        for(const o of arr){ if(o===b) continue; const dx=o.x-b.x, dy=o.y-b.y, rsum=o.r+b.r, d2=dx*dx+dy*dy;
          if(d2<rsum*rsum){ const d=Math.sqrt(d2)||0.0001, nx=dx/d, ny=dy/d; const overlap=(rsum-d), push=overlap*0.53;
            b.x-=nx*push*0.5; b.y-=ny*push*0.5; o.x+=nx*push*0.5; o.y+=ny*push*0.5;
            const reln=(b.vx-o.vx)*nx+(b.vy-o.vy)*ny; const J=(-2.0*reln)/2; b.vx+=J*nx; b.vy+=J*ny; o.vx-=J*nx; o.vy-=J*ny; } } } }
    if(capturingEnabled && gateOpen && !chuteBall){
      for(let i=balls.length-1;i>=0;i--){ const b=balls[i]; const d=Math.hypot(b.x-CATCH.x,b.y-CATCH.y);
        if(d < CATCH.r-1){ balls.splice(i,1); gateOpen=false; chuteBall={id:b.id,isPearl:isPearl}; chuteT=0; break; } }
    }
  }

  function commitNumber(id,isPearl){
    if(phase==='main'){ drawnMain.push(id); drawnMain.sort((a,b)=>a-b); render(); if(drawnMain.length>=5) phase='switch'; }
    else if(phase==='euro'){ drawnEuro.push(id); drawnEuro.sort((a,b)=>a-b); render(); if(drawnEuro.length>=2){ phase='done'; EJ.recordDraw(drawnMain,drawnEuro); } }
  }

  function updateChute(dt){
    if(!chuteBall) return; chuteT=Math.min(1, chuteT + dt*0.8);
    const p=chutePoint(chuteT); drawBall({x:p.x,y:p.y,r:R,id:chuteBall.id}, chuteBall.isPearl);
    if(chuteT>=1){ const id=chuteBall.id, isPearl=chuteBall.isPearl; chuteBall=null;
      setTimeout(()=>{ commitNumber(id,isPearl);
        if(phase==='switch'){ if(!chuteBall){ phase='euro_init'; setTimeout(()=>{ init(12,true); phase='euro'; }, 500); } }
        setTimeout(()=>{ gateOpen=true; }, 300);
      }, 1200);
    }
  }

  function drawFrame(){ const isPearl=(phase==='euro'||phase==='done'); drawDrum(isPearl); for(const b of balls) drawBall(b,isPearl); updateChute(0); }
  function loop(ts){ if(!running) return; const t=ts*0.001, dt=Math.min(0.033, lastT?(t-lastT):0.016); lastT=t;
    if(phase==='main'||phase==='euro'){ physics(dt,t,(phase!=='main')); }
    drawDrum(phase!=='main'); for(const b of balls) drawBall(b,(phase!=='main')); updateChute(dt);
    if(dbg) dbg.textContent='phase='+phase+' | balls='+balls.length+' | main='+drawnMain.length+' euro='+drawnEuro.length+(gateOpen?' | gate:open':' | gate:closed')+(capturingEnabled?' | capturing:on':' | capturing:off');
    raf=requestAnimationFrame(loop); }
  function start(){ if(running) return; running=true; lastT=0; raf=requestAnimationFrame(loop); }
  function stop(){ running=false; if(raf) cancelAnimationFrame(raf); raf=0; }
  function reset(){ stop(); drawnMain=[]; drawnEuro=[]; outMain.innerHTML=''; outEuro.innerHTML=''; balls=[]; phase='idle'; gateOpen=false; chuteBall=null; capturingEnabled=false; drawFrame(); label.textContent='Venus Â· 50 gelbe Styroporkugeln Â· Ã˜ 4,5 cm Â· 4 g'; }

  resetBtn.addEventListener('click', ()=>{ reset(); init(50,false); phase='main'; start(); });
  startBtn.addEventListener('click', ()=>{ if(phase==='idle'){ init(50,false); phase='main'; } start(); gateOpen=true; capturingEnabled=true; });

  // Boot
  resize(); reset(); init(50,false); phase='main'; start();
})(); 

/* === Analyse: Frequenz, Treffer, Verlauf ================================ */
(function(){
  const freqMain=document.getElementById('freq-main'), freqEuro=document.getElementById('freq-euro'), hitStats=document.getElementById('hit-stats'), history=document.getElementById('history');
  const btnRefresh=document.getElementById('btn-refresh-stats'), btnClear=document.getElementById('btn-clear-data');

  function renderFreq(){
    const fm=new Array(50).fill(0), fe=new Array(12).fill(0);
    for(const h of EJ.history){ for(const n of h.main) fm[n-1]++; for(const e of h.euro) fe[e-1]++; }
    function pills(container, arr){ container.innerHTML=''; arr.forEach((c,i)=>{ const s=document.createElement('span'); s.className='chip'; s.textContent=(i+1)+' â€¢ '+c; s.style.margin='4px'; container.appendChild(s); }); }
    pills(freqMain,fm); pills(freqEuro,fe);
  }
  function renderHits(){
    const counts={'0/5':0,'1/5':0,'2/5':0,'3/5':0,'4/5':0,'5/5':0};
    for(const tip of EJ.tips){
      for(const h of EJ.history){
        const set=new Set(tip.main); let k=0; h.main.forEach(n=>{ if(set.has(n)) k++; });
        const key=`${k}/5`; counts[key]=(counts[key]||0)+1;
      }
    }
    hitStats.innerHTML=Object.keys(counts).map(k=>`<span class="chip" style="margin:4px">${k}: ${counts[k]}</span>`).join('');
  }
  function renderHistory(){
    history.innerHTML = EJ.history.slice(-20).reverse().map(h=>`<div class="panel" style="margin:6px 0;padding:6px"><b>${new Date(h.ts).toLocaleString()}</b><div>Haupt: ${h.main.join(', ')} &nbsp;|&nbsp; Euro: ${h.euro.join(', ')}</div></div>`).join('');
  }
  function refresh(){ EJ._load(); renderFreq(); renderHits(); renderHistory(); }

  if(btnRefresh) btnRefresh.addEventListener('click', refresh);
  if(btnClear) btnClear.addEventListener('click', ()=>{ EJ.history=[]; EJ.tips=[]; EJ._save(); refresh(); });

  window.EJRefreshAnalysis = refresh;
})(); 
</script>
</body>
</html>