<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EuroJackpot ‚Ä¢ Ziehung Pro (by ENOWEB)</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<style>
:root{ --ink:#eaf7ff; --bg:#060712; --panel:rgba(18,22,38,.82); --cy:#00fff0; --mag:#ff00ea; --gold:#f4c655; }
body{margin:0;color:var(--ink);font-family:Inter,ui-sans-serif,system-ui;background:
 radial-gradient(1000px 700px at -10% -10%, rgba(0,255,240,.12), transparent 60%),
 radial-gradient(1000px 700px at 110% -10%, rgba(255,0,234,.12), transparent 60%), var(--bg);}
.h1{font-weight:900;background:linear-gradient(90deg,var(--cy),var(--mag));-webkit-background-clip:text;color:transparent}
.brand{font-weight:900;background:linear-gradient(90deg,#00fff0,#6cc7ff,#ff5be8,#ffd36a,#00fff0);background-size:400% 100%;
 -webkit-background-clip:text;color:transparent;animation:grad 6s linear infinite}
@keyframes grad{0%{background-position:0 50%}100%{background-position:100% 50%}}
.card{background:var(--panel);backdrop-filter:blur(14px);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px;box-shadow:0 12px 36px rgba(0,0,0,.45)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:44px;padding:0 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);font-weight:700}
.btn--green{background:#15803d;color:#fff}.btn--amber{background:#b45309;color:#fff}.btn--gray{background:#374151;color:#fff}
.sim{position:relative;border:1px solid rgba(255,255,255,.08);border-radius:12px;overflow:hidden;background:#03070e}
.sim canvas{width:100%;height:420px;max-height:65vh;background:radial-gradient(70% 90% at 50% 35%, #0b1626, #071220, #050c18)}
.badge{background:rgba(255,255,255,.06); border:1px solid rgba(140,170,255,.22); border-radius:999px; padding:.25rem .65rem; font-size:.78rem;}
.slot{position:absolute;right:10px;top:10px;width:96px;height:96px;border-radius:16px;border:1px solid rgba(0,255,200,.28);background:linear-gradient(180deg,rgba(0,255,170,.12),rgba(0,140,120,.10));display:flex;align-items:center;justify-content:center;font-size:12px;color:#8bffc9}
.rail{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;padding:.5rem .75rem;border-radius:12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.07)}
.rail .slotbox{width:46px;height:46px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-weight:800}
.chip{display:inline-flex;align-items:center;justify-content:center;min-width:38px;height:38px;border-radius:999px;background:linear-gradient(180deg,#0fd5c6,#0aa39a);color:#042725;font-weight:900}
.chip--gold{background:linear-gradient(180deg,#ffe7a2,#f4c655);color:#241a05}
.fchip{position:fixed;z-index:60;min-width:38px;height:38px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-weight:900;pointer-events:none;
 background:linear-gradient(180deg,#ffe7a2,#f4c655);color:#241a05;box-shadow:inset 0 -6px 10px rgba(0,0,0,.15),0 10px 22px rgba(255,220,130,.25)}
.small{font-size:.85rem;opacity:.9}
</style>
</head>
<body class="p-4">
  <header class="mb-2">
    <h1 class="h1 text-3xl md:text-4xl">EuroJackpot ‚Ä¢ Ziehung Pro</h1>
    <div class="brand text-lg">by ENOWEB</div>
  </header>

  <div class="grid grid-cols-1 xl:grid-cols-3 gap-3">
    <section class="card xl:col-span-2">
      <h2 class="font-bold text-xl mb-2">üåÄ Simulation (2 Trommeln ‚Äì echtes ‚ÄûTrommeln‚Äú)</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div class="sim"><div class="badge absolute m-2">Haupttrommel (1‚Äì50)</div><div class="slot">Auswurf</div><canvas id="cvA" width="680" height="420"></canvas></div>
        <div class="sim"><div class="badge absolute m-2">Eurotrommel (1‚Äì12)</div><div class="slot">Auswurf</div><canvas id="cvB" width="680" height="420"></canvas></div>
      </div>
      <div class="mt-3 rail" id="rail">
        <div class="slotbox" data-slot="A1"></div>
        <div class="slotbox" data-slot="A2"></div>
        <div class="slotbox" data-slot="A3"></div>
        <div class="slotbox" data-slot="A4"></div>
        <div class="slotbox" data-slot="A5"></div>
        <div class="w-0.5 h-8 bg-white bg-opacity-20 rounded"></div>
        <div class="slotbox" data-slot="B1"></div>
        <div class="slotbox" data-slot="B2"></div>
      </div>
      <div class="flex gap-2 mt-3">
        <button id="btnStart" class="btn btn--green">Ziehung starten (5+2)</button>
        <button id="btnReset" class="btn btn--amber">Reset</button>
      </div>
      <div id="resultText" class="mt-3 text-lg"><span class="badge">Noch kein Ergebnis</span></div>
    </section>

    <section class="card">
      <h2 class="font-bold text-xl mb-2">üìÇ Archiv (bew√§hrter Loader)</h2>
      <input id="archiveUrl" class="bg-gray-900 p-2 rounded w-full mb-2" value="https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_eurojackpot.zip">
      <div class="flex flex-wrap gap-2 mb-2">
        <button id="btnLoad" class="btn btn--green">üì• Laden</button>
        <button id="btnSaveZip" class="btn btn--amber">‚¨áÔ∏è ZIP speichern</button>
        <a id="direct" class="btn btn--gray" target="_blank" rel="noopener">üîó Direktlink</a>
      </div>
      <div id="statusText" class="text-sm mb-2">Noch kein Archiv geladen.</div>
      <div class="grid grid-cols-3 gap-2 text-center my-2">
        <div class="badge">Ziehungen: <b id="kpiCount">‚Äì</b></div>
        <div class="badge">Von: <b id="kpiFrom">‚Äì</b></div>
        <div class="badge">Bis: <b id="kpiTo">‚Äì</b></div>
      </div>
      <div class="small">Falls blockiert: ZIP/TXT hier hochladen oder Inhalt einf√ºgen.</div>
      <input id="fileInput" type="file" class="mt-2 block w-full bg-gray-900 p-2 rounded" accept=".zip,.csv,.txt">
      <textarea id="pasteBox" class="mt-2 w-full h-24 bg-gray-900 p-2 rounded" placeholder="Oder CSV/TXT hier einf√ºgen‚Ä¶"></textarea>
      <button id="btnParsePaste" class="btn btn--gray mt-2">CSV/TXT einlesen</button>
    </section>
  </div>

  <section class="card mt-3">
    <h2 class="font-bold text-xl mb-2">üìä Analyse</h2>
    <div id="analysisIntro" class="small">Warte auf Ziehung‚Ä¶</div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-2">
      <div><div class="font-semibold mb-1">Hot/Cold Haupt</div><div id="hotMain" class="text-sm opacity-90"></div></div>
      <div><div class="font-semibold mb-1">Hot/Cold Euro</div><div id="hotEuro" class="text-sm opacity-90"></div></div>
      <div><div class="font-semibold mb-1">Kombinationstreffer</div><div id="comboStats" class="text-sm">‚Äì</div></div>
    </div>
  </section>

<script>
const $=s=>document.querySelector(s); const $$=s=>Array.from(document.querySelectorAll(s));
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v)); function rng(seed){ let s=seed|0||Date.now()%2147483647; return ()=> (s=(s*48271)%2147483647)/2147483647; }
const LS_ARCH='ej_enoweb_archive_v7';

/* ===== Archiv Loader (Proxy-Kette + Upload + Paste + Local) ===== */
let draws=[], freqA=Array(51).fill(0), freqB=Array(13).fill(0);
async function ensureJSZip(){ return !!window.JSZip || new Promise((res)=>{ const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js'; s.onload=()=>res(true); s.onerror=()=>res(false); document.head.appendChild(s) }); }
async function fetchWithProxies(url){
  const trials=[ url, 'https://cors.isomorphic-git.org/'+url, 'https://api.allorigins.win/raw?url='+encodeURIComponent(url), 'https://thingproxy.freeboard.io/fetch/'+url, 'https://corsproxy.io/?'+encodeURIComponent(url) ];
  let last=null;
  for(const u of trials){
    try{
      const res=await fetch(u,{cache:'no-store'}); if(!res.ok) throw new Error('HTTP '+res.status);
      const ct=res.headers.get('content-type')||'';
      if(ct.includes('zip') || u.endsWith('.zip')){
        if(!(await ensureJSZip())) throw new Error('JSZip nicht verf√ºgbar.');
        const blob=await res.blob(); const zip=await JSZip.loadAsync(blob);
        const entries=Object.values(zip.files);
        const entry=entries.find(f=>/\.(txt|csv)$/i.test(f.name) && /eurojackpot/i.test(f.name)) || entries.find(f=>/\.(txt|csv)$/i.test(f.name));
        if(!entry) throw new Error('ZIP ohne TXT/CSV.'); return await entry.async('string');
      }else{ return await res.text(); }
    }catch(e){ last=e; }
  } throw last||new Error('Download fehlgeschlagen');
}
function parseArchiveText(txt){
  try{
    const lines=txt.replace(/\r\n?/g,'\n').split('\n').map(l=>l.trim()).filter(Boolean);
    const usable = lines.filter(l => (l.match(/\d+/g)||[]).length>=7);
    const dmy=/^(\d{1,2})[.\-\/](\d{1,2})[.\-\/](\d{2,4})$/, ymd=/^(\d{4})[.\-\/](\d{1,2})[.\-\/](\d{1,2})$/;
    function iso(y,m,d){ const t=new Date(+y,+m-1,+d); return isNaN(t)?null:t.toISOString().slice(0,10); }
    function parseLine(l){
      const t=l.split(/;|,|\t|\s+/).filter(Boolean); let date=null, rest=[];
      if(t.length&&dmy.test(t[0])){ const m=t[0].match(dmy); date=iso(m[3],m[2],m[1]); rest=t.slice(1); }
      else if(t.length&&ymd.test(t[0])){ const m=t[0].match(ymd); date=iso(m[1],m[2],m[3]); rest=t.slice(1); }
      else{ rest=t.slice(0); }
      const nums=rest.map(Number).filter(n=>Number.isFinite(n));
      if(!date){ const only=(l.match(/\d+/g)||[]).map(Number); if(only.length>=7){ const [a,b,c]=only.slice(0,3); const dd=iso(c,b,a); if(dd) date=dd; } }
      const main=nums.filter(n=>n>=1&&n<=50).slice(0,5).sort((a,b)=>a-b);
      const euro=nums.filter(n=>n>=1&&n<=12).slice(0,2).sort((a,b)=>a-b);
      if(!date||main.length!==5||euro.length!==2) return null;
      return {date, main, euro};
    }
    draws=[]; freqA.fill(0); freqB.fill(0);
    usable.forEach(l=>{ const r=parseLine(l); if(r) draws.push(r); });
    if(!draws.length) throw new Error('Keine g√ºltigen Ziehungen erkannt.');
    draws.sort((a,b)=>a.date.localeCompare(b.date));
    draws.forEach(d=>{ d.main.forEach(n=>freqA[n]++); d.euro.forEach(n=>freqB[n]++); });
    localStorage.setItem(LS_ARCH, txt);
    $('#statusText').textContent='Archiv geladen ‚úî';
    $('#kpiCount').textContent=draws.length; $('#kpiFrom').textContent=draws[0].date; $('#kpiTo').textContent=draws.at(-1).date;
    renderHotCold();
  }catch(e){ $('#statusText').textContent='Fehler: '+e.message; }
}
$('#btnLoad').onclick=async()=>{
  const url=$('#archiveUrl').value.trim(); $('#statusText').textContent='Lade Archiv‚Ä¶';
  try{ const text=await fetchWithProxies(url); parseArchiveText(text); }
  catch(e){ const saved=localStorage.getItem(LS_ARCH); if(saved){ parseArchiveText(saved); $('#statusText').textContent='Online blockiert ‚Äì lokale Kopie geladen.'; } else $('#statusText').textContent='Download blockiert ‚Äì bitte Datei hochladen oder Text einf√ºgen.'; }
};
$('#direct').href=$('#archiveUrl').value.trim();
$('#btnSaveZip').onclick=async()=>{
  const url=$('#archiveUrl').value.trim();
  const trials=['https://cors.isomorphic-git.org/'+url,'https://api.allorigins.win/raw?url='+encodeURIComponent(url),'https://thingproxy.freeboard.io/fetch/'+url,'https://corsproxy.io/?'+encodeURIComponent(url),url];
  for(const u of trials){ try{ const r=await fetch(u); if(!r.ok) throw 0; const b=await r.blob(); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='archiv_eurojackpot.zip'; a.click(); URL.revokeObjectURL(a.href); return; }catch{} }
  alert('ZIP-Download nicht m√∂glich.');
};
$('#fileInput').addEventListener('change', async (e)=>{
  const f=e.target.files?.[0]; if(!f) return;
  try{
    if(f.name.toLowerCase().endsWith('.zip')){
      if(!(await ensureJSZip())){ alert('JSZip nicht verf√ºgbar ‚Äì bitte TXT/CSV hochladen.'); return; }
      const zip=await JSZip.loadAsync(f); const entries=Object.values(zip.files);
      const entry=entries.find(x=>/\.(txt|csv)$/i.test(x.name) && /eurojackpot/i.test(x.name)) || entries.find(x=>/\.(txt|csv)$/i.test(x.name));
      if(!entry) throw new Error('ZIP ohne TXT/CSV.'); const txt=await entry.async('string'); parseArchiveText(txt);
    }else{ parseArchiveText(await f.text()); }
  }catch(err){ $('#statusText').textContent='Fehler: '+err.message; }
});
$('#btnParsePaste').onclick=()=>{ const v=$('#pasteBox').value; if(v.trim()) parseArchiveText(v); };
(()=>{ const saved=localStorage.getItem(LS_ARCH); if(saved){ try{ parseArchiveText(saved); $('#statusText').textContent='Archiv aus Speicher geladen ‚úî'; }catch{} } })();

/* ===== Hot/Cold Pills ===== */
function pills(freq, maxN){
  if(!freq) return '‚Äì'; const vals=freq.slice(1,maxN+1);
  const max=Math.max(...vals,1), min=Math.min(...vals.filter(v=>v>0),max);
  return vals.map((v,i)=>{ const n=i+1; const hot=v>=(min+(max-min)*0.66), cold=v<=(min+(max-min)*0.33);
    const bg=hot?'rgba(30,200,160,.25)':(cold?'rgba(90,120,255,.22)':'rgba(255,255,255,.06)');
    return `<span style="display:inline-flex;align-items:center;justify-content:center;min-width:34px;height:28px;margin:3px;border-radius:8px;background:${bg};border:1px solid rgba(255,255,255,.12);font-weight:800">${String(n).padStart(2,'0')}<small style="opacity:.7;margin-left:6px">${v}</small></span>`; }).join(''); }
function renderHotCold(){ $('#hotMain').innerHTML=pills(freqA,50); $('#hotEuro').innerHTML=pills(freqB,12); }

/* ===== Drum Simulation (trommelt + rollt) ===== */
class Drum{
  constructor(canvas,count,seed=0){ this.cv=canvas; this.ct=canvas.getContext('2d');
    this.W=canvas.clientWidth; this.H=canvas.clientHeight; canvas.width=this.W; canvas.height=this.H;
    this.cx=this.W*0.5; this.cy=this.H*0.6; this.R=Math.min(this.W,this.H)*0.38; this.r=Math.max(12,this.R*0.09);
    this.rng=rng(seed||Date.now()); this.balls=[];
    for(let i=1;i<=count;i++){ const th=this.rng()*Math.PI*2; this.balls.push({n:i, th, w:(this.rng()*2-1)*1.2}); }
    this.arms=[0,Math.PI*2/3,-Math.PI*2/3]; this.armSpeed=1.4;
    this.intake=-Math.PI*0.2 + Math.PI/2; this.flap=0; this.target=null;
    this.prev=null; this.tick=0; this.loop=this.loop.bind(this); this.loop(); this.onDrop=null;
  }
  xy(th,rm=0.68){ return {x:this.cx+Math.cos(th)*(this.R*rm), y:this.cy+Math.sin(th)*(this.R*rm)}; }
  nearest(){ const P=this.xy(this.intake,0.86); let best=null,bd=1e9; for(const b of this.balls){ if(b.dead) continue; const p=this.xy(b.th); const d=(p.x-P.x)**2+(p.y-P.y)**2; if(d<bd){bd=d; best=b;} } return best; }
  async drawOne(){ if(this.target) return; this.target=this.nearest();
    for(let t=0;t<14;t++){ this.target.w*=0.85; this.target.th += (this.intake - this.target.th)*0.14; await sleep(26); }
    this.flap=1; await sleep(250); const p=this.xy(this.intake,0.86); if(this.onDrop){ this.onDrop({num:this.target.n, start:{x:p.x+90,y:p.y-6}}); }
    this.target.dead=true; this.target=null; await sleep(150); this.flap=0;
  }
  update(dt){
    const jitter=(this.tick%3===0)? (this.rng()*0.5-0.25) : 0;
    for(const b of this.balls){ if(b.dead) continue; b.w += jitter + (this.rng()*2-1)*0.03; b.w=clamp(b.w,-2.2,2.2); b.th=(b.th+b.w*dt+Math.PI*2)%(Math.PI*2); }
    const alive=this.balls.filter(b=>!b.dead).sort((a,b)=>a.th-b.th);
    if(alive.length>1){ const gap=(Math.PI*2)/alive.length*0.32; for(let i=0;i<alive.length;i++){ const A=alive[i], B=alive[(i+1)%alive.length]; let g=(B.th-A.th+Math.PI*2)%(Math.PI*2); if(g<gap){ const push=(gap-g)/2; A.th-=push; B.th+=push; } } }
    if(this.target){ this.target.th += (this.intake - this.target.th)*0.14; this.target.w*=0.82; }
  }
  draw(){
    const ctx=this.ct; ctx.clearRect(0,0,this.W,this.H);
    ctx.save(); ctx.translate(this.cx,this.cy); ctx.lineWidth=22; ctx.strokeStyle='rgba(10,25,38,.96)'; ctx.beginPath(); ctx.arc(0,0,this.R,0,Math.PI*2); ctx.stroke(); ctx.restore();
    ctx.save(); ctx.translate(this.cx,this.cy); ctx.fillStyle='#17c3b2'; this.arms=this.arms.map(a=>a+ this.armSpeed*0.016);
    for(const a of this.arms){ ctx.save(); ctx.rotate(a); roundRect(ctx,-8,-4,this.R*0.78,8,4); ctx.fill(); ctx.restore(); } ctx.restore();
    const P=this.xy(this.intake,0.86);
    ctx.save(); ctx.translate(P.x,P.y); ctx.rotate(this.intake+(this.flap?0.42:0)); ctx.fillStyle='#136d68'; roundRect(ctx,-16,-70,32,140,10); ctx.fill(); ctx.restore();
    ctx.save(); ctx.translate(P.x+26,P.y-12); ctx.rotate(-0.33); ctx.fillStyle='rgba(60,200,170,.18)'; roundRect(ctx,0,0,160,12,6); ctx.fill(); ctx.restore();
    ctx.save(); ctx.translate(P.x+96,P.y+22); ctx.rotate(-0.33); ctx.fillStyle='rgba(60,200,170,.18)'; roundRect(ctx,0,0,180,12,6); ctx.fill(); ctx.restore();
    ctx.save(); ctx.font='800 14px Inter,system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle';
    for(const b of this.balls){ if(b.dead && b!==this.target) continue; const p=this.xy(b===this.target?this.target.th:b.th);
      ctx.beginPath(); ctx.arc(p.x,p.y,this.r+6,0,Math.PI*2); ctx.fillStyle='rgba(0,0,0,.14)'; ctx.fill();
      ctx.beginPath(); ctx.arc(p.x,p.y,this.r,0,Math.PI*2); ctx.fillStyle= b===this.target ? '#f9d67a' : '#13b3aa'; ctx.fill();
      ctx.lineWidth=3; ctx.strokeStyle='rgba(0,0,0,.55)'; ctx.strokeText(String(b.n).padStart(2,'0'),p.x,p.y);
      ctx.fillStyle= b===this.target ? '#241a05' : '#eafffb'; ctx.fillText(String(b.n).padStart(2,'0'),p.x,p.y); } ctx.restore();
  }
  frame(ts){ if(!this.prev) this.prev=ts; const dt=clamp((ts-this.prev)/16,0.6,1.6); this.prev=ts; this.tick++; this.update(dt*0.016); this.draw(); }
  loop(ts=performance.now()){ this.frame(ts); requestAnimationFrame(this.loop); }
}
function roundRect(ctx,x,y,w,h,r){const rr=Math.min(r,Math.abs(w)/2,Math.abs(h)/2);ctx.beginPath();ctx.moveTo(x+rr,y);ctx.arcTo(x+w,y,x+w,y+h,rr);ctx.arcTo(x+w,y+h,x,y+h,rr);ctx.arcTo(x,y+h,x,y,rr);ctx.arcTo(x,y,x+w,y,rr);ctx.closePath();}

/* Ergebnis-Rail: Bezier + Rotation */
const rail=$('#rail');
function place(slot,num,gold){ rail.querySelector(`[data-slot="${slot}"]`).innerHTML=`<span class="chip ${gold?'chip--gold':''}">${String(num).padStart(2,'0')}</span>`; }
function bezier(p0,p1,p2,t){ const a=(1-t)*(1-t), b=2*(1-t)*t, c=t*t; return {x:a*p0.x + b*p1.x + c*p2.x, y:a*p0.y + b*p1.y + c*p2.y}; }
async function rollTo(fromCanvas, startXY, slot, num, gold){
  const slotEl=rail.querySelector(`[data-slot="${slot}"]`);
  const s=fromCanvas.getBoundingClientRect(), e=slotEl.getBoundingClientRect();
  const sx=s.left + startXY.x*(fromCanvas.clientWidth/fromCanvas.width), sy=s.top + startXY.y*(fromCanvas.clientHeight/fromCanvas.height);
  const ex=e.left+e.width/2, ey=e.top+e.height/2;
  const ctrl={x:(sx+ex)/2 + 80, y:(sy+ey)/2 - 40};
  const chip=document.createElement('div'); chip.className='fchip'; chip.textContent=String(num).padStart(2,'0');
  chip.style.left=(sx-19)+'px'; chip.style.top=(sy-19)+'px'; document.body.appendChild(chip);
  const D=Math.hypot(ex-sx,ey-sy); const dur=900+Math.min(600,D); let last={x:sx,y:sy};
  await new Promise(resolve=>{ const start=performance.now(); function step(now){ const t=Math.min(1,(now-start)/dur);
    const p=bezier({x:sx,y:sy},ctrl,{x:ex,y:ey},t); const dx=p.x-last.x, dy=p.y-last.y; const rot=Math.atan2(dy,dx);
    chip.style.transform=`translate(${p.x-sx}px,${p.y-sy}px) rotate(${rot + t*6*Math.PI}rad)`; last=p; if(t<1) requestAnimationFrame(step); else resolve();}
    requestAnimationFrame(step);
  });
  chip.remove(); place(slot,num,gold);
}

/* App */
const drumA=new Drum($('#cvA'),50); const drumB=new Drum($('#cvB'),12);
let cur={main:[],euro:[],ts:null}, running=false;
drumA.onDrop=({num,start})=>{ rollTo(drumA.cv,start,'A'+(cur.main.length+1),num,false); cur.main.push(num); };
drumB.onDrop=({num,start})=>{ rollTo(drumB.cv,start,'B'+(cur.euro.length+1),num,true); cur.euro.push(num); };
$('#btnReset').onclick=()=>location.reload();
$('#btnStart').onclick=async()=>{
  if(running) return; running=true; cur={main:[],euro:[],ts:new Date().toISOString()};
  await sleep(500); for(let i=0;i<5;i++){ await drumA.drawOne(); await sleep(350); } for(let i=0;i<2;i++){ await drumB.drawOne(); await sleep(350); }
  cur.main.sort((a,b)=>a-b); cur.euro.sort((a,b)=>a-b);
  for(let i=0;i<5;i++) place('A'+(i+1),cur.main[i],false); for(let i=0;i<2;i++) place('B'+(i+1),cur.euro[i],true);
  $('#resultText').innerHTML=`<b>Ergebnis:</b> Haupt: ${cur.main.map(n=>String(n).padStart(2,'0')).join(' ')} ¬∑ Euro: ${cur.euro.map(n=>String(n).padStart(2,'0')).join(' ')} <div class="text-xs opacity-80">${cur.ts}</div>`;
  analyze(); running=false;
};

/* Analyse */
function analyze(){
  if(!draws.length){ $('#analysisIntro').textContent='Keine Archivdaten geladen.'; return; }
  $('#analysisIntro').textContent=`Archiv aktiv: ${draws.length} Ziehungen`;
  const set=new Set(cur.main); let m5=0,m4=0,m3=0,e2=0,e1=0;
  for(const d of draws){ const mm=d.main.filter(n=>set.has(n)).length; if(mm===5)m5++; else if(mm===4)m4++; else if(mm===3)m3++;
    const me=d.euro.filter(n=>cur.euro.includes(n)).length; if(me===2)e2++; else if(me===1)e1++; }
  $('#comboStats').innerHTML=`üéØ 5/5: ${m5}√ó ¬∑ 4/5: ${m4}√ó ¬∑ 3/5: ${m3}√ó<br>‚≠ê Euro 2/2: ${e2}√ó ¬∑ 1/2: ${e1}√ó`;
}
</script>
</body>
</html>
