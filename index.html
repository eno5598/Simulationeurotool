
<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Trommel ‚Äì Venus & Pearl (Demo v7)</title>
<style>
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#0b1220;color:#e8eef9}
  .wrap{max-width:980px;margin:24px auto;padding:0 12px}
  .nav{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:18px;justify-content:center}
  .nav button{display:flex;gap:.35rem;align-items:center;border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);color:#e8eef9;border-radius:.8rem;padding:.6rem .9rem;cursor:pointer}
  .nav .active{box-shadow:0 0 0 2px rgba(99,102,241,.45) inset}
  .view{display:none}
  .view.show{display:block}
  .glass{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:.9rem;padding:.9rem}
  .badge{display:inline-block;padding:.2rem .6rem;border-radius:.5rem;border:1px solid rgba(255,255,255,.15);font-size:.85rem;opacity:.9}
  .btn{padding:.55rem .9rem;border-radius:.6rem;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:#e8eef9;cursor:pointer}
  .btn--green{background:rgba(16,185,129,.2)}
  .btn--amber{background:rgba(245,158,11,.2)}
  .chip{display:inline-flex;align-items:center;justify-content:center;min-width:34px;height:34px;border-radius:999px;padding:0 .5rem;border:1px solid rgba(255,255,255,.2);margin:.15rem;background:rgba(255,255,255,.96);color:#111;font-weight:700;transform:scale(1);transition:transform .25s ease}
  .chip.pop{transform:scale(1.12)}
  @keyframes gateFlash{0%{opacity:0}30%{opacity:.95}100%{opacity:0}}
</style>
</head>
<body>
<div class="wrap">
  <div class="nav">
    <button class="tab-btn" data-v="home">üè† Home</button>
    <button class="tab-btn active" data-v="drum">üé± Trommel</button>
  </div>

  <div id="v-home" class="view">Dies ist nur eine Demo-Seite, damit du sehen kannst, dass die Trommel funktioniert.</div>

  <div id="v-drum" class="view show">
    <div class="flex items-center justify-between" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem">
      <h2 style="margin:0;font-size:1.4rem;font-weight:800">üé± Ziehung ‚Äì Trommel</h2>
      <div class="badge" id="drumLabel">Venus ¬∑ 50 gelbe Styroporkugeln</div>
    </div>

    <div class="glass" style="display:grid;grid-template-columns:1fr 330px;gap:12px;">
      <div>
        <canvas id="drumCanvas" width="680" height="520" style="width:100%;height:auto;background:#0b1022;border:1px solid rgba(255,255,255,.1);border-radius:.6rem"></canvas>
      </div>
      <div class="glass">
        <div style="font-weight:700;margin-bottom:.35rem">Ziehung</div>
        <div style="opacity:.85;font-size:.95rem">Originalaufbau: <b>Venus</b> (50 gelbe Kugeln ‚Üí Hauptzahlen) mit kr√§ftigem Gebl√§se und <b>Fang oben</b>. Danach automatisch <b>Pearl</b> (12 wei√üe Kugeln ‚Üí Eurozahlen).</div>
        <div style="margin-top:.6rem;display:flex;gap:.5rem;flex-wrap:wrap">
          <button class="btn btn--green" id="drumAutoStart">üé¨ Start Ziehung</button>
          <button class="btn btn--amber" id="drumReset">üîÑ Reset</button>
        </div>
        <div style="margin-top:.6rem">
          <div class="badge">Gezogene Hauptzahlen (Venus)</div>
          <div id="drumOutMain" style="margin-top:.25rem;display:flex;flex-wrap:wrap"></div>
          <div class="badge" style="margin-top:.6rem">Gezogene Eurozahlen (Pearl)</div>
          <div id="drumOutEuro" style="margin-top:.25rem;display:flex;flex-wrap:wrap"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Tiny tab switch for the demo
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.view').forEach(v=>v.classList.remove('show'));
    document.getElementById('v-'+btn.dataset.v).classList.add('show');
  });
});
</script>

<script>
/* === Trommel-Physik ‚Äì v7 (Venus/Pearl, Gebl√§se unten, Fang oben) ========= */
(function(){
  const canvas = document.getElementById('drumCanvas');
  const ctx = canvas.getContext('2d');

  const BALL_DIAM_PX = 20, R = BALL_DIAM_PX/2, MASS = 4;
  const W = canvas.width, H = canvas.height, CX = W*0.5, CY = H*0.50, DRUM_R = Math.min(W,H)*0.44;

  // Fang oben am Rand
  const CATCH_POS = { x: CX + DRUM_R*0.50, y: CY - DRUM_R*0.78 };
  const CATCH_R = 18;

  // 3 Gebl√§se unten
  const JETS = [
    {x: CX - DRUM_R*0.30, y: CY + DRUM_R*0.62, phase: 0},
    {x: CX,                 y: CY + DRUM_R*0.62, phase: Math.PI/2},
    {x: CX + DRUM_R*0.30, y: CY + DRUM_R*0.62, phase: Math.PI}
  ];
  let jetT = 0;

  const PADDLES = 3, PADDLE_LEN = DRUM_R*0.65; let paddleAngle=0;

  const btnStart = document.getElementById('drumAutoStart');
  const btnReset = document.getElementById('drumReset');
  const outMain = document.getElementById('drumOutMain');
  const outEuro = document.getElementById('drumOutEuro');
  const label = document.getElementById('drumLabel');

  let balls=[], phase='idle', running=false, rafId=null, last=0;
  let drawnMain=[], drawnEuro=[];
  let tNoise=0, tGrav=0, lastCatch=0, minGapMain=1500, minGapEuro=1800;

  function rng(a,b){ return a + Math.random()*(b-a); }
  function pill(n, euro=false){
    const span=document.createElement('span');
    span.className='chip'+(euro?' euro':'');
    span.textContent=n;
    setTimeout(()=>{ span.classList.add('pop'); setTimeout(()=>span.classList.remove('pop'),260); },10);
    return span;
  }
  function renderOutputs(){
    outMain.innerHTML=''; drawnMain.forEach(n=> outMain.appendChild(pill(n,false)));
    outEuro.innerHTML=''; drawnEuro.forEach(n=> outEuro.appendChild(pill(n,true)));
  }

  function initBalls(count, isPearl){
    balls.length=0;
    const labels=Array.from({length:count},(_,i)=> i+1);
    for(let i=0;i<count;i++){
      const a=Math.random()*Math.PI*2, r=DRUM_R*0.55*rng(0.35,0.92);
      const x=CX + r*Math.cos(a), y=CY + r*Math.sin(a);
      balls.push({ id:labels[i], x,y, vx:rng(-80,80), vy:rng(-80,80), r:R, m:4 });
    }
    label.textContent = isPearl ? 'Pearl ¬∑ 12 wei√üe Styroporkugeln' : 'Venus ¬∑ 50 gelbe Styroporkugeln';
  }

  function drawDrum(isPearl){
    ctx.clearRect(0,0,W,H);
    ctx.beginPath(); ctx.arc(CX,CY,DRUM_R,0,Math.PI*2);
    ctx.strokeStyle='rgba(180,220,255,0.35)'; ctx.lineWidth=8; ctx.stroke();
    // Paddel
    ctx.save(); ctx.translate(CX,CY);
    for(let i=0;i<PADDLES;i++){ const ang=paddleAngle + i*(2*Math.PI/PADDLES);
      ctx.rotate(ang); ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(PADDLE_LEN,0);
      ctx.lineWidth=6; ctx.strokeStyle='rgba(200,200,255,0.22)'; ctx.stroke(); ctx.rotate(-ang); }
    ctx.restore();
    // Catch oben
    ctx.beginPath(); ctx.arc(CATCH_POS.x, CATCH_POS.y, CATCH_R, 0, Math.PI*2);
    ctx.strokeStyle='rgba(255,255,255,.38)'; ctx.lineWidth=3; ctx.stroke();
    // Jets anzeigen
    JETS.forEach(j=>{ ctx.beginPath(); ctx.arc(j.x, j.y, 6, 0, Math.PI*2); ctx.fillStyle='rgba(180,220,255,.35)'; ctx.fill(); });
  }
  function drawBall(b, isPearl){
    ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fillStyle = isPearl ? 'rgba(255,255,255,0.96)' : 'rgba(255,240,120,0.98)';
    ctx.fill(); ctx.lineWidth=1.5; ctx.strokeStyle = 'rgba(0,0,0,0.45)'; ctx.stroke();
    ctx.fillStyle='#111'; ctx.font='bold 12px Inter, system-ui';
    const s=String(b.id); const w=ctx.measureText(s).width; ctx.fillText(s, b.x-w/2, b.y+4);
  }

  const CELL = R*2.4; function hash(x,y){ return ((x/CELL)|0)+','+((y/CELL)|0); }
  let gvec={x:0,y:65};

  function step(dt, now, isPearl){
    tNoise+=dt; tGrav+=dt; jetT+=dt; paddleAngle+=2.1*dt;

    if(tGrav>1.05){ tGrav=0; const ang=rng(-Math.PI,Math.PI), g=rng(45,85); gvec={x:Math.cos(ang)*g, y:Math.sin(ang)*g}; }
    if(tNoise>0.22){ tNoise=0; for(const b of balls){ b.vx+=rng(-28,28); b.vy+=rng(-28,28);} }

    const JET_R = 72; const baseLift = isPearl ? 170 : 210;
    for(const b of balls){
      b.vx*=0.988; b.vy*=0.988;
      b.vx+=gvec.x*dt; b.vy+=gvec.y*dt;

      // Paddel
      const relx=b.x-CX, rely=b.y-CY, ang=Math.atan2(rely,relx), r=Math.hypot(relx,rely);
      for(let i=0;i<PADDLES;i++){ const target=paddleAngle + i*(2*Math.PI/PADDLES);
        const diff=Math.atan2(Math.sin(ang-target), Math.cos(ang-target));
        if(Math.abs(diff)<0.20 && r<DRUM_R*0.8){ const k=(DRUM_R-r)*(isPearl?10:12)*dt; b.vx+=-Math.sin(target)*k; b.vy+=Math.cos(target)*k; } }

      // Jets
      for(const J of JETS){
        const px=b.x-J.x, py=b.y-J.y, d2=px*px+py*py;
        if(d2 < JET_R*JET_R){
          const pulse=(Math.sin(jetT*2.5 + J.phase)+1)*0.5;
          const lift=baseLift*pulse;
          b.vy -= lift*dt;
          b.vx += px*0.004*dt;
        }
      }

      b.x+=b.vx*dt; b.y+=b.vy*dt;

      const dx=b.x-CX, dy=b.y-CY, dist=Math.hypot(dx,dy), maxR=DRUM_R-b.r-4;
      if(dist>maxR){ const nx=dx/dist, ny=dy/dist; b.x=CX+nx*maxR; b.y=CY+ny*maxR;
        const vn=b.vx*nx + b.vy*ny; const vtx=b.vx - vn*nx, vty=b.vy - vn*ny; const e=0.80;
        b.vx = vtx*1.01 - e*vn*nx; b.vy = vty*1.01 - e*vn*ny; }
    }

    // collisions
    const grid=new Map(), neigh=[[0,0],[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1]];
    for(const b of balls){ const key=hash(b.x,b.y); if(!grid.has(key)) grid.set(key,[]); grid.get(key).push(b); }
    for(const b of balls){
      const ix=(b.x/CELL)|0, iy=(b.y/CELL)|0;
      for(const [dx,dy] of neigh){
        const bucket=grid.get((ix+dx)+','+(iy+dy)); if(!bucket) continue;
        for(const o of bucket){ if(o===b) continue;
          const dx2=o.x-b.x, dy2=o.y-b.y, rsum=b.r+o.r, d2=dx2*dx2+dy2*dy2;
          if(d2<rsum*rsum){
            const d=Math.sqrt(d2)||0.0001, nx=dx2/d, ny=dy2/d, reln=(b.vx-o.vx)*nx + (b.vy-o.vy)*ny;
            const J=(-1.85*reln)/2; b.vx+=J*nx; b.vy+=J*ny; o.vx-=J*nx; o.vy-=J*ny;
            const overlap=(rsum-d), push=overlap*0.5; b.x-=nx*push*0.5; b.y-=ny*push*0.5; o.x+=nx*push*0.5; o.y+=ny*push*0.5;
          }
        }
      }
    }

    // Catch oben
    for(let i=balls.length-1;i>=0;i--){
      const b=balls[i], d=Math.hypot(b.x-CATCH_POS.x, b.y-CATCH_POS.y);
      const wait = (phase==='main') ? minGapMain : minGapEuro;
      if(d < CATCH_R-2){
        if(now - lastCatch < wait){
          const nx=(b.x-CATCH_POS.x)/(d||1), ny=(b.y-CATCH_POS.y)/(d||1);
          b.vx += nx*80; b.vy += ny*80; continue;
        }
        balls.splice(i,1); lastCatch = now;
        setTimeout(()=> capture(b), 220);
      }
    }
  }

  function capture(ball){
    if(phase==='main'){
      drawnMain.push(ball.id); drawnMain.sort((a,b)=>a-b); renderOutputs();
      if(drawnMain.length===5){ phase='switch'; }
    }else if(phase==='euro'){
      drawnEuro.push(ball.id); drawnEuro.sort((a,b)=>a-b); renderOutputs();
      if(drawnEuro.length===2){ phase='done'; stop(); }
    }
  }

  function draw(){
    const isPearl = (phase==='euro'||phase==='done');
    drawDrum(isPearl);
    for(const b of balls) drawBall(b, isPearl);
  }

  function loop(ts){
    if(!running) return;
    const now = performance.now(), t=ts*0.001, dt=Math.min(0.033, last? (t-last):0.016); last=t;
    if(phase==='main' || phase==='euro'){ step(dt, now, (phase!=='main')); }
    else if(phase==='switch'){ phase='euro_init_wait'; setTimeout(()=>{ initBalls(12, true); lastCatch = performance.now(); phase='euro'; }, 700); }
    draw(); rafId=requestAnimationFrame(loop);
  }

  function start(){ if(running) return; running=true; last=0; lastCatch=performance.now(); rafId=requestAnimationFrame(loop); }
  function stop(){ running=false; if(rafId) cancelAnimationFrame(rafId); rafId=null; }
  function reset(){ stop(); drawnMain.length=0; drawnEuro.length=0; outMain.innerHTML=''; outEuro.innerHTML=''; phase='idle'; balls.length=0; label.textContent='Venus ¬∑ 50 gelbe Styroporkugeln'; draw(); }

  btnReset.addEventListener('click', reset);
  btnStart.addEventListener('click', ()=>{ reset(); initBalls(50, false); phase='main'; start(); });

  draw();
})();
</script>
</body>
</html>
