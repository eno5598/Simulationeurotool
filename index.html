<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EuroJackpot ‚Ä¢ Twin‚ÄëCyclone Studio (by ENOWEB)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<style>
:root{
  --bg:#06060b;
  --panel:#0b1222f0;
  --ink:#e9f7ff;
  --mint:#10e6d7;
  --teal:#0aa39a;
  --gold:#f6cc58;
  --accent1:#00fff0; --accent2:#6cc7ff; --accent3:#ff5be8; --accent4:#ffd36a;
}
html,body{height:100%}*{box-sizing:border-box}
body{
  margin:0;color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;
  background:
    radial-gradient(1100px 800px at -20% -10%, rgba(0,255,240,.08), transparent 60%),
    radial-gradient(1100px 800px at 120% -10%, rgba(255,0,234,.08), transparent 60%),
    radial-gradient(100% 100% at 50% 120%, #03040a, #080a14);
}
.container{max-width:1180px;margin:18px auto;padding:0 14px}
h1{margin:0;font-size:clamp(28px,4.5vw,44px);font-weight:900;
   background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3),var(--accent4),var(--accent1));
   background-size:400% 100%;-webkit-background-clip:text;color:transparent;animation:titleAnim 6s linear infinite}
@keyframes titleAnim{0%{background-position:0 50%}100%{background-position:100% 50%}}
.by{font-weight:900;display:inline-block;margin-top:2px;
   background:linear-gradient(90deg,#00fff0,#6cc7ff,#ff5be8,#ffd36a,#00fff0);
   background-size:400% 100%;-webkit-background-clip:text;color:transparent;animation:titleAnim 7s linear infinite}
.card{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;
      box-shadow:0 20px 46px rgba(0,0,0,.6);backdrop-filter:blur(18px)}
.grid{display:grid;gap:14px}
@media(min-width:980px){.g2{grid-template-columns:1fr 1fr}}
.sectionTitle{font-weight:900;font-size:20px;margin:.25rem 0 12px 0}
.btn{height:44px;padding:0 14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);font-weight:800;color:#fff;background:#15803d;cursor:pointer}
.btn:disabled{opacity:.6;cursor:not-allowed}
.btn.ghost{background:#314158}
.btn.warn{background:#b45309}
.sim{position:relative;border:1px solid rgba(255,255,255,.09);border-radius:16px;overflow:hidden;height:480px;
     background:radial-gradient(120% 120% at 50% 30%, #0a1426, #091326 60%, #071223)}
.sim .label{position:absolute;left:12px;top:10px;font-size:12px;font-weight:800;background:rgba(255,255,255,.06);
           border:1px solid rgba(140,170,255,.22);padding:6px 10px;border-radius:999px}
.sim .slot{position:absolute;right:10px;top:10px;width:106px;height:106px;border-radius:16px;
  border:1px solid rgba(0,255,200,.28);background:linear-gradient(180deg,rgba(0,255,170,.12),rgba(0,140,120,.10));
  display:flex;align-items:center;justify-content:center;font-weight:800;color:#98ffe0}
canvas{width:100%;height:100%}
.rail{display:flex;align-items:center;gap:8px;flex-wrap:wrap;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);
      border-radius:14px;padding:10px}
.slotbox{width:50px;height:50px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.16);
         display:flex;align-items:center;justify-content:center;font-weight:900}
.sep{width:1px;height:28px;background:rgba(255,255,255,.25);border-radius:2px;margin:0 4px}
.chip{display:inline-flex;align-items:center;justify-content:center;min-width:40px;height:40px;border-radius:999px;
      background:radial-gradient(120% 120% at 30% 28%, #1ae3d9, #0aa39a 60%);color:#062a29;font-weight:900;
      box-shadow:inset 0 2px 6px rgba(255,255,255,.2), inset 0 -6px 12px rgba(0,0,0,.3)}
.chip.gold{background:radial-gradient(120% 120% at 30% 28%, #fff1b9, #f6cc58 60%);color:#221a06;
      box-shadow:0 0 18px rgba(255,220,120,.5), inset 0 2px 6px rgba(255,255,255,.35), inset 0 -6px 12px rgba(0,0,0,.25)}
.fly{position:fixed;z-index:90;min-width:40px;height:40px;border-radius:999px;display:flex;align-items:center;justify-content:center;
     font-weight:900;pointer-events:none;background:radial-gradient(120% 120% at 30% 28%, #fff1b9, #f6cc58 60%);color:#221a06;
     box-shadow:0 0 18px rgba(255,220,120,.5), inset 0 2px 6px rgba(255,255,255,.35), inset 0 -6px 12px rgba(0,0,0,.25)}
.small{opacity:.85}
</style>
</head>
<body>
<div class="container">
  <h1>EuroJackpot ‚Ä¢ Twin‚ÄëCyclone Studio</h1>
  <div class="by">by ENOWEB</div>

  <div class="grid g2" style="margin-top:12px">
    <div class="card">
      <div class="sectionTitle">üé¨ Simulation (Twin‚ÄëCyclone + Rohr‚ÄëZoom)</div>
      <div class="grid g2">
        <div class="sim">
          <div class="label">Haupttrommel (1‚Äì50)</div>
          <div class="slot" id="slotA">Auswurf</div>
          <canvas id="cvA" width="680" height="480"></canvas>
        </div>
        <div class="sim">
          <div class="label">Eurotrommel (1‚Äì12)</div>
          <div class="slot" id="slotB">Auswurf</div>
          <canvas id="cvB" width="680" height="480"></canvas>
        </div>
      </div>
      <div class="rail" id="rail" style="margin-top:10px">
        <div class="slotbox" data-slot="A1"></div>
        <div class="slotbox" data-slot="A2"></div>
        <div class="slotbox" data-slot="A3"></div>
        <div class="slotbox" data-slot="A4"></div>
        <div class="slotbox" data-slot="A5"></div>
        <div class="sep"></div>
        <div class="slotbox" data-slot="B1"></div>
        <div class="slotbox" data-slot="B2"></div>
      </div>
      <div style="display:flex;gap:10px;align-items:center;margin-top:10px">
        <button class="btn" id="btnStart">Ziehung starten (5+2)</button>
        <button class="btn warn" id="btnReset">Reset</button>
        <div id="resultText" class="small">Noch kein Ergebnis</div>
      </div>
    </div>

    <div class="card">
      <div class="sectionTitle">üìÇ Archiv (Auto + Upload + Paste)</div>
      <input id="archiveUrl" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);
             background:#0b1422;color:#eaf7ff"
        value="https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_eurojackpot.zip">
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <button class="btn" id="btnLoad">üì• Laden</button>
        <button class="btn ghost" id="btnSaveZip">‚¨áÔ∏è ZIP speichern</button>
        <a class="btn ghost" id="direct" target="_blank" rel="noopener">üîó Direkt</a>
      </div>
      <div id="statusText" class="small" style="margin-top:6px">Noch kein Archiv geladen.</div>
      <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:8px;margin:10px 0">
        <div class="card" style="padding:8px;text-align:center">Ziehungen<br><b id="kpiCount">‚Äì</b></div>
        <div class="card" style="padding:8px;text-align:center">Von<br><b id="kpiFrom">‚Äì</b></div>
        <div class="card" style="padding:8px;text-align:center">Bis<br><b id="kpiTo">‚Äì</b></div>
      </div>
      <div class="small">Fallbacks:</div>
      <input id="fileInput" type="file" accept=".zip,.csv,.txt" style="margin-top:8px;width:100%">
      <textarea id="pasteBox" rows="5" placeholder="CSV/TXT hier einf√ºgen‚Ä¶" style="margin-top:8px;width:100%;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0b1422;color:#eaf7ff;padding:10px"></textarea>
      <button class="btn ghost" id="btnParsePaste" style="margin-top:8px">CSV/TXT einlesen</button>

      <div class="sectionTitle" style="margin-top:14px">üìä Analyse</div>
      <div id="analysisIntro" class="small">Warte auf Ziehung‚Ä¶</div>
      <div class="grid" style="grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:8px">
        <div><div style="font-weight:800;margin-bottom:6px">Hot/Cold Haupt</div><div id="hotMain" class="small"></div></div>
        <div><div style="font-weight:800;margin-bottom:6px">Hot/Cold Euro</div><div id="hotEuro" class="small"></div></div>
        <div><div style="font-weight:800;margin-bottom:6px">Kombinationstreffer</div><div id="comboStats" class="small">‚Äì</div></div>
      </div>
    </div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
const LS='ej_twincyclone_archiv_v1';

// ===== Robustes Archiv =====
let draws=[], freqA=Array(51).fill(0), freqB=Array(13).fill(0);
async function fetchWithProxies(url){
  const list=[ url, 'https://cors.isomorphic-git.org/'+url, 'https://api.allorigins.win/raw?url='+encodeURIComponent(url), 'https://thingproxy.freeboard.io/fetch/'+url, 'https://corsproxy.io/?'+encodeURIComponent(url) ];
  let last=null;
  for(const u of list){
    try{
      const res=await fetch(u,{cache:'no-store'}); if(!res.ok) throw new Error('HTTP '+res.status);
      const ct=res.headers.get('content-type')||'';
      if(ct.includes('zip')||u.endsWith('.zip')){
        const blob=await res.blob(); const zip=await JSZip.loadAsync(blob);
        const entries=Object.values(zip.files);
        const entry=entries.find(f=>/\\.(txt|csv)$/i.test(f.name) && /eurojackpot/i.test(f.name)) || entries.find(f=>/\\.(txt|csv)$/i.test(f.name));
        const txt=await entry.async('string'); return txt;
      }else{
        return await res.text();
      }
    }catch(e){ last=e; }
  }
  throw last||new Error('Download fehlgeschlagen');
}
function parseArchiveText(txt){
  try{
    const lines=txt.replace(/\\r\\n?/g,'\\n').split('\\n').map(s=>s.trim()).filter(Boolean);
    const usable=lines.filter(l=>(l.match(/\\d+/g)||[]).length>=7);
    const dmy=/(\\d{1,2})[.\\/-](\\d{1,2})[.\\/-](\\d{2,4})/; const ymd=/(\\d{4})[.\\/-](\\d{1,2})[.\\/-](\\d{1,2})/;
    function iso(y,m,d){ const t=new Date(+y,+m-1,+d); return isNaN(t)?null:t.toISOString().slice(0,10); }
    function parseLine(l){
      const t=l.split(/;|,|\\t|\\s+/).filter(Boolean);
      let date=null, rest=[];
      if(t.length&&dmy.test(t[0])){ const m=t[0].match(dmy); date=iso(m[3],m[2],m[1]); rest=t.slice(1); }
      else if(t.length&&ymd.test(t[0])){ const m=t[0].match(ymd); date=iso(m[1],m[2],m[3]); rest=t.slice(1); }
      else rest=t.slice(0);
      const nums=rest.map(Number).filter(n=>Number.isFinite(n));
      if(!date){ const only=(l.match(/\\d+/g)||[]).map(Number); if(only.length>=7){ const [a,b,c]=only.slice(0,3); const dd=iso(c,b,a); if(dd) date=dd; } }
      const main=nums.filter(n=>n>=1&&n<=50).slice(0,5).sort((a,b)=>a-b);
      const euro=nums.filter(n=>n>=1&&n<=12).slice(0,2).sort((a,b)=>a-b);
      if(!date||main.length!==5||euro.length!==2) return null;
      return {date,main,euro};
    }
    draws=[]; freqA.fill(0); freqB.fill(0);
    usable.forEach(l=>{ const r=parseLine(l); if(r) draws.push(r); });
    if(!draws.length) throw new Error('Keine g√ºltigen Ziehungen erkannt');
    draws.sort((a,b)=>a.date.localeCompare(b.date));
    draws.forEach(d=>{ d.main.forEach(n=>freqA[n]++); d.euro.forEach(n=>freqB[n]++); });
    localStorage.setItem(LS, txt);
    $('#statusText').textContent='Archiv geladen ‚úî';
    $('#kpiCount').textContent=draws.length; $('#kpiFrom').textContent=draws[0].date; $('#kpiTo').textContent=draws.at(-1).date;
    renderHotCold();
  }catch(e){ $('#statusText').textContent='Fehler: '+e.message; }
}
$('#btnLoad').onclick=async()=>{
  $('#statusText').textContent='Lade Archiv‚Ä¶';
  try{ const t=await fetchWithProxies($('#archiveUrl').value.trim()); parseArchiveText(t); }
  catch(e){ const saved=localStorage.getItem(LS); if(saved){ parseArchiveText(saved); $('#statusText').textContent='Online blockiert ‚Äì lokale Kopie geladen.'; } else $('#statusText').textContent='Download blockiert ‚Äì ZIP/TXT hochladen oder Inhalt einf√ºgen.'; }
};
$('#btnSaveZip').onclick=async()=>{
  const url=$('#archiveUrl').value.trim();
  const list=['https://cors.isomorphic-git.org/'+url,'https://api.allorigins.win/raw?url='+encodeURIComponent(url),'https://thingproxy.freeboard.io/fetch/'+url,'https://corsproxy.io/?'+encodeURIComponent(url),url];
  for(const u of list){ try{ const r=await fetch(u); if(!r.ok) throw 0; const b=await r.blob(); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='archiv_eurojackpot.zip'; a.click(); URL.revokeObjectURL(a.href); return; }catch{} }
  alert('ZIP-Download nicht m√∂glich.');
};
$('#direct').href=$('#archiveUrl').value.trim();
$('#fileInput').addEventListener('change', async (e)=>{
  const f=e.target.files?.[0]; if(!f) return;
  try{
    if(f.name.toLowerCase().endsWith('.zip')){
      const ab=await f.arrayBuffer(); const zip=await JSZip.loadAsync(ab);
      const entries=Object.values(zip.files);
      const entry=entries.find(x=>/\\.(txt|csv)$/i.test(x.name) && /eurojackpot/i.test(x.name)) || entries.find(x=>/\\.(txt|csv)$/i.test(x.name));
      if(!entry) throw new Error('ZIP ohne TXT/CSV.');
      const txt=await entry.async('string'); parseArchiveText(txt);
    }else{
      const txt=await f.text(); parseArchiveText(txt);
    }
  }catch(err){ $('#statusText').textContent='Fehler: '+err.message; }
});
$('#btnParsePaste').onclick=()=>{ const v=$('#pasteBox').value; if(v.trim()) parseArchiveText(v); };
(()=>{ const saved=localStorage.getItem(LS); if(saved){ try{ parseArchiveText(saved); $('#statusText').textContent='Archiv aus Speicher geladen ‚úî'; }catch{} } })();
function pills(freq, maxN){ const vals=freq.slice(1,maxN+1); const max=Math.max(...vals,1), min=Math.min(...vals.filter(v=>v>0),max);
  return vals.map((v,i)=>{ const n=i+1; const hot=v>=(min+(max-min)*0.66), cold=v<=(min+(max-min)*0.33);
  const bg=hot?'rgba(30,200,160,.25)':(cold?'rgba(90,120,255,.22)':'rgba(255,255,255,.06)');
  return `<span style="display:inline-flex;align-items:center;justify-content:center;min-width:34px;height:28px;margin:3px;border-radius:8px;background:${bg};border:1px solid rgba(255,255,255,.12);font-weight:800">${String(n).padStart(2,'0')}<small style="opacity:.7;margin-left:6px">${v}</small></span>`; }).join(''); }
function renderHotCold(){ $('#hotMain').innerHTML=pills(freqA,50); $('#hotEuro').innerHTML=pills(freqB,12); }

// ===== Neues Trommel‚ÄëSystem (Twin‚ÄëCyclone) =====
class Drum{
  constructor(canvas, count, slotEl, themeHue=175){
    this.cv=canvas; this.ctx=canvas.getContext('2d'); this.slotEl=slotEl;
    this.W=canvas.clientWidth; this.H=canvas.clientHeight; canvas.width=this.W; canvas.height=this.H;
    this.cx=this.W*0.48; this.cy=this.H*0.56; this.R=Math.min(this.W,this.H)*0.38;
    this.r=Math.max(12,this.R*0.09); // 4.5cm skaliert
    // Kamera
    this.cam={s:1,tx:0,ty:0,ts:1,ttx:0,tty:0,t:1};
    // Speckle‚ÄëTexturen je Ball
    function speckles(n){ const a=[]; for(let i=0;i<8;i++) a.push([(Math.random()*2-1)*0.6,(Math.random()*2-1)*0.6, Math.random()*0.6+0.15]); return a; }
    // B√§lle
    this.balls=[]; this.left=new Set(Array.from({length:count},(_,i)=>i+1));
    for(const n of this.left){
      this.balls.push({n, a:Math.random()*Math.PI*2, w:(Math.random()<.5?-1:1)*(1.3+Math.random()*1.4),
        rm:0.68+Math.random()*0.12, rv:0, spin:Math.random()*Math.PI*2, live:true, flip:300+Math.random()*800,
        spec:speckles()});
    }
    // Doppel‚ÄëWirbel: Paddel drehen, Drehrichtung flippt, plus innerer Mini‚ÄëWirbel
    this.pads=[0,Math.PI*0.66,Math.PI*1.33]; this.padDir=1; this.padSp=1.9; this.padFlip=1800+Math.random()*1600;
    this.miniPhase=Math.random()*Math.PI*2;
    // Intake
    this.intake=-Math.PI*0.12 + Math.PI/2;
    // Farben
    this.h=themeHue;
    this.tPrev=performance.now(); requestAnimationFrame(this.loop.bind(this));
  }
  xy(a,m){ return {x:this.cx+Math.cos(a)*m, y:this.cy+Math.sin(a)*m}; }
  async eject(onDrop){
    const P=this.xy(this.intake,this.R*0.9);
    let best=null,bd=1e9;
    for(const b of this.balls){ if(!b.live) continue; const p=this.xy(b.a,this.R*b.rm); const d=(p.x-P.x)**2+(p.y-P.y)**2; if(d<bd){bd=d; best=b;} }
    if(!best) return null;
    this.cam={...this.cam,ts:1.35,ttx:this.W*0.5-P.x,tty:this.H*0.52-P.y,t:0};
    for(let i=0;i<16;i++){ best.w*=0.85; best.a+=(this.intake-best.a)*0.18; best.spin+=0.55; await sleep(18); }
    if(onDrop) onDrop({num:best.n, start:P});
    best.live=false; this.left.delete(best.n);
    this.cam={...this.cam,ts:1,ttx:0,tty:0,t:0};
    return best.n;
  }
  update(dt){
    if(this.cam.t<1){ this.cam.t=Math.min(1,this.cam.t+dt*1.2);
      const e=this.cam.t*this.cam.t*(3-2*this.cam.t);
      this.cam.s += (this.cam.ts - this.cam.s)*e*dt*4;
      this.cam.tx+= (this.cam.ttx- this.cam.tx)*e*dt*4;
      this.cam.ty+= (this.cam.tty- this.cam.ty)*e*dt*4;
    }
    this.padFlip-=dt*1000; if(this.padFlip<=0){ this.padDir*=-1; this.padFlip=1800+Math.random()*1600; }
    this.pads=this.pads.map(a=>a+this.padDir*this.padSp*dt);
    this.miniPhase+=dt*1.3;
    for(const b of this.balls){
      if(!b.live) continue;
      b.flip-=dt*1000; if(b.flip<=0){ b.w*=-1; b.flip=300+Math.random()*800; }
      // tangential + Mini‚ÄëWirbel
      b.w += (Math.random()*2-1)*0.06 + Math.sin(this.miniPhase + b.a*3)*0.015;
      b.w=clamp(b.w,-2.9,2.9);
      b.a=(b.a + b.w*dt + Math.PI*2)%(Math.PI*2);
      // radial jitter
      b.rv += (Math.random()*2-1)*0.004; b.rv=clamp(b.rv,-0.08,0.08);
      b.rm = clamp(b.rm + b.rv*dt, 0.62, 0.80);
      b.spin += b.w*0.45;
    }
    // Entschl√§ngeln
    const alive=this.balls.filter(x=>x.live).sort((a,b)=>a.a-b.a);
    const gapMin=(Math.PI*2)/Math.max(alive.length,2)*0.22;
    for(let i=0;i<alive.length;i++){ const A=alive[i], B=alive[(i+1)%alive.length];
      let g=(B.a-A.a+Math.PI*2)%(Math.PI*2); if(g<gapMin){ const p=(gapMin-g)/2; A.a-=p; B.a+=p; A.w-=p*0.6; B.w+=p*0.6; } }
  }
  drawGlass(ctx){
    // Oktagon + Ring + Streulicht
    ctx.save(); ctx.translate(this.cx,this.cy); const R=this.R;
    ctx.lineWidth=18;
    const g=ctx.createLinearGradient(-R,0,R,0); g.addColorStop(0,'rgba(20,240,200,.10)'); g.addColorStop(.5,'rgba(255,255,255,.12)'); g.addColorStop(1,'rgba(20,240,200,.10)');
    ctx.strokeStyle=g; ctx.beginPath();
    const sides=8;
    for(let i=0;i<=sides;i++){ const a=i/sides*Math.PI*2; const x=Math.cos(a)*R, y=Math.sin(a)*R; if(i) ctx.lineTo(x,y); else ctx.moveTo(x,y); }
    ctx.stroke();
    // Innen‚ÄëVignette
    const ig=ctx.createRadialGradient(0,0,R*0.2,0,0,R); ig.addColorStop(0,'rgba(0,0,0,0)'); ig.addColorStop(1,'rgba(0,0,0,.32)');
    ctx.fillStyle=ig; ctx.beginPath(); ctx.arc(0,0,R,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }
  drawPaddles(ctx){
    ctx.save(); ctx.translate(this.cx,this.cy);
    for(let k=0;k<3;k++){
      ctx.save(); ctx.globalAlpha=0.18*(3-k); ctx.fillStyle='hsl('+this.h+',60%,48%)';
      for(const a of this.pads){ ctx.save(); ctx.rotate(a - k*0.08); this.roundRect(ctx,-14,-7,this.R*0.84,14,7); ctx.fill(); ctx.restore(); }
      ctx.restore();
    }
    ctx.restore();
  }
  drawPipe(ctx){
    const slot=this.slotEl.getBoundingClientRect(), rect=this.cv.getBoundingClientRect();
    const P=this.xy(this.intake,this.R*0.9);
    const sx=P.x+6, sy=P.y-6; const ex=slot.left-rect.left+slot.width*0.1, ey=slot.top-rect.top+slot.height*0.3;
    const cx=(sx+ex)/2+60, cy=(sy+ey)/2-80;
    ctx.save();
    ctx.lineWidth=18; ctx.strokeStyle='rgba(140,255,230,.12)'; ctx.beginPath(); ctx.moveTo(sx,sy); ctx.quadraticCurveTo(cx,cy,ex,ey); ctx.stroke();
    ctx.lineWidth=4; ctx.strokeStyle='rgba(255,255,255,.15)'; ctx.stroke();
    ctx.translate(P.x,P.y); ctx.rotate(this.intake); ctx.fillStyle='rgba(120,255,230,.18)';
    this.roundRect(ctx,-20,-78,40,156,12); ctx.fill(); ctx.restore();
  }
  drawBall(ctx,p,rad,b){
    const g=ctx.createRadialGradient(p.x-rad*.35,p.y-rad*.4,rad*.1,p.x,p.y,rad*1.1);
    g.addColorStop(0,'#1fe8dc'); g.addColorStop(.6,'#12b6ad'); g.addColorStop(1,'#0a766f');
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(p.x,p.y,rad,0,Math.PI*2); ctx.fill();
    // Speckles (Styropor‚ÄëLook)
    ctx.save(); ctx.globalAlpha=.22; ctx.fillStyle='#fff';
    for(const s of b.spec){ ctx.beginPath(); ctx.arc(p.x+s[0]*rad, p.y+s[1]*rad, s[2]*2, 0, Math.PI*2); ctx.fill(); }
    ctx.restore();
    ctx.strokeStyle='rgba(0,0,0,.35)'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(p.x,p.y,rad,0,Math.PI*2); ctx.stroke();
    // Glanzstreifen
    ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(b.spin); ctx.globalAlpha=.18; ctx.fillStyle='#fff'; ctx.fillRect(-rad*.8,-rad*.12,rad*1.6,rad*.24); ctx.restore();
    // Nummer
    ctx.font='800 14px Inter,system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.lineWidth=3; ctx.strokeStyle='rgba(0,0,0,.55)'; ctx.strokeText(String(b.n).padStart(2,'0'),p.x,p.y);
    ctx.fillStyle='#eafffb'; ctx.fillText(String(b.n).padStart(2,'0'),p.x,p.y);
  }
  frame(ts){
    const dt=Math.min(1.6,Math.max(0.6,(ts-this.tPrev)/16))*0.016; this.tPrev=ts;
    this.update(dt);
    const ctx=this.ctx; ctx.clearRect(0,0,this.W,this.H);
    ctx.save(); ctx.translate(this.cam.tx,this.cam.ty); ctx.scale(this.cam.s,this.cam.s);
    this.drawGlass(ctx); this.drawPaddles(ctx); this.drawPipe(ctx);
    for(const b of this.balls){ if(!b.live) continue; const p=this.xy(b.a,this.R*b.rm); this.drawBall(ctx,p,this.r,b); }
    ctx.restore();
    requestAnimationFrame(this.frame.bind(this));
  }
  loop(ts){ this.frame(ts||performance.now()); }
  roundRect(ctx,x,y,w,h,r){ const rr=Math.min(r,Math.abs(w)/2,Math.abs(h)/2);
    ctx.beginPath(); ctx.moveTo(x+rr,y); ctx.arcTo(x+w,y,x+w,y+h,rr); ctx.arcTo(x+w,y+h,x,y+h,rr);
    ctx.arcTo(x,y+h,x,y,rr); ctx.arcTo(x,y,x+w,y,rr); ctx.closePath();
  }
}

const rail=document.getElementById('rail');
function slotPlace(slot,num,gold){ rail.querySelector(`[data-slot="${slot}"]`).innerHTML=`<span class="chip ${gold?'gold':''}">${String(num).padStart(2,'0')}</span>`; }
function bez(p0,p1,p2,t){ const a=(1-t)*(1-t), b=2*(1-t)*t, c=t*t; return {x:a*p0.x+b*p1.x+c*p2.x, y:a*p0.y+b*p1.y+c*p2.y}; }
async function flyTo(slot,start,num,gold){
  const el=rail.querySelector(`[data-slot="${slot}"]`), r=el.getBoundingClientRect();
  const sx=start.x+90, sy=start.y-6, ex=r.left+r.width/2, ey=r.top+r.height/2;
  const ctrl={x:(sx+ex)/2+100, y:(sy+ey)/2-50};
  const chip=document.createElement('div'); chip.className='fly'; chip.textContent=String(num).padStart(2,'0');
  chip.style.left=(sx-20)+'px'; chip.style.top=(sy-20)+'px'; document.body.appendChild(chip);
  const D=Math.hypot(ex-sx,ey-sy), dur=1000+Math.min(600,D);
  await new Promise(res=>{ const t0=performance.now(); (function step(t){ const u=Math.min(1,(t-t0)/dur); const p=bez({x:sx,y:sy},ctrl,{x:ex,y:ey},u);
    const rot=Math.atan2(p.y-sy,p.x-sx)+u*6*Math.PI; chip.style.transform=`translate(${p.x-sx}px,${p.y-sy}px) rotate(${rot}rad)`;
    if(u<1) requestAnimationFrame(step); else res(); })(t0); });
  chip.remove(); slotPlace(slot,num,gold);
}

// App
const drumA=new Drum(document.getElementById('cvA'),50,document.getElementById('slotA'),175);
const drumB=new Drum(document.getElementById('cvB'),12,document.getElementById('slotB'),185);
let result={A:[],B:[],ts:null}, busy=false;
document.getElementById('btnReset').onclick=()=>location.reload();

async function drawSet(drum,count,prefix,isEuro=false){
  const used=new Set();
  for(let i=0;i<count;i++){
    let n=null;
    do{ n=await drum.eject(({num,start})=>flyTo(`${prefix}${i+1}`,start,num,isEuro)); } while(n==null || used.has(n));
    used.add(n);
    (isEuro?result.B:result.A).push(n);
    await sleep(120);
  }
}
document.getElementById('btnStart').onclick=async(e)=>{
  if(busy) return; busy=true; e.currentTarget.disabled=true;
  result={A:[],B:[],ts:new Date().toISOString()};
  await drawSet(drumA,5,'A',false);
  await drawSet(drumB,2,'B',true);
  result.A.sort((a,b)=>a-b); result.B.sort((a,b)=>a-b);
  for(let i=0;i<5;i++) slotPlace('A'+(i+1),result.A[i],false);
  for(let i=0;i<2;i++) slotPlace('B'+(i+1),result.B[i],true);
  $('#resultText').innerHTML=`<b>Ergebnis:</b> Haupt: ${result.A.map(n=>String(n).padStart(2,'0')).join(' ')} ¬∑ Euro: ${result.B.map(n=>String(n).padStart(2,'0')).join(' ')} <div class="small">${result.ts}</div>`;
  analyze(); busy=false; e.currentTarget.disabled=false;
};

// Analyse
function analyze(){
  if(!draws.length){ $('#analysisIntro').textContent='Keine Archivdaten geladen.'; return; }
  $('#analysisIntro').textContent=`Archiv aktiv: ${draws.length} Ziehungen`;
  const set=new Set(result.A); let m5=0,m4=0,m3=0,e2=0,e1=0;
  for(const d of draws){ const mm=d.main.filter(n=>set.has(n)).length; if(mm===5)m5++; else if(mm===4)m4++; else if(mm===3)m3++;
    const me=d.euro.filter(n=>result.B.includes(n)).length; if(me===2)e2++; else if(me===1)e1++; }
  $('#comboStats').innerHTML=`üéØ 5/5: ${m5}√ó ¬∑ 4/5: ${m4}√ó ¬∑ 3/5: ${m3}√ó<br>‚≠ê Euro 2/2: ${e2}√ó ¬∑ 1/2: ${e1}√ó`;
}
</script>
</body>
</html>
