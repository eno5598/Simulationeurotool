<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Eurojackpot Trommel â€“ Venus & Pearl (v9)</title>
<style>
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#0b1220;color:#e8eef9}
  .wrap{max-width:1000px;margin:16px auto;padding:0 12px}
  .glass{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:.9rem;padding:.9rem}
  .badge{display:inline-block;padding:.2rem .6rem;border-radius:.5rem;border:1px solid rgba(255,255,255,.15);font-size:.85rem;opacity:.95}
  .btn{padding:.55rem .9rem;border-radius:.6rem;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:#e8eef9;cursor:pointer}
  .btn--green{background:rgba(16,185,129,.2)}
  .btn--amber{background:rgba(245,158,11,.2)}
  .chip{display:inline-flex;align-items:center;justify-content:center;min-width:34px;height:34px;border-radius:999px;padding:0 .5rem;border:1px solid rgba(255,255,255,.2);margin:.15rem;background:rgba(255,255,255,.96);color:#111;font-weight:700;transform:scale(1);transition:transform .25s ease}
  .chip.pop{transform:scale(1.12)}
  #dbg{position:fixed;left:12px;bottom:12px;font:12px/1.2 monospace;color:#b7c7ff;background:rgba(17,24,39,.7);padding:.35rem .5rem;border:1px solid rgba(255,255,255,.15);border-radius:.4rem}
</style>
</head>
<body>
<div class="wrap">
  <h2 style="margin:0 0 10px 0;font-weight:800">ðŸŽ± Eurojackpot Trommel â€“ Venus & Pearl (v9)</h2>
  <div class="badge" id="drumLabel">Venus Â· 50 gelbe Styroporkugeln</div>
  <div class="glass" style="display:grid;grid-template-columns:1fr 330px;gap:12px;margin-top:10px">
    <div>
      <canvas id="drumCanvas" width="760" height="560" style="width:100%;height:auto;background:#0b1022;border:1px solid rgba(255,255,255,.1);border-radius:.6rem"></canvas>
    </div>
    <div class="glass">
      <div style="font-weight:700;margin-bottom:.35rem">Ziehung</div>
      <div style="opacity:.85;font-size:.95rem"><b>Venus</b> (50 gelb) mit GeblÃ¤se unten & Fang oben. Danach <b>Pearl</b> (12 weiÃŸ).<br><small>Skalierung: Kugel Ã˜ 4.5 cm, Gewicht 4 g; Trommel innen ~70 cm Ã˜.</small></div>
      <div style="margin-top:.6rem;display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="btn btn--green" id="drumAutoStart">ðŸŽ¬ Start Ziehung</button>
        <button class="btn btn--amber" id="drumReset">ðŸ”„ Reset</button>
      </div>
      <div style="margin-top:.6rem">
        <div class="badge">Gezogene Hauptzahlen (Venus)</div>
        <div id="drumOutMain" style="margin-top:.25rem;display:flex;flex-wrap:wrap"></div>
        <div class="badge" style="margin-top:.6rem">Gezogene Eurozahlen (Pearl)</div>
        <div id="drumOutEuro" style="margin-top:.25rem;display:flex;flex-wrap:wrap"></div>
      </div>
    </div>
  </div>
</div>
<div id="dbg">initâ€¦</div>

<script>
(function(){
  const BALL_DIAM_CM = 4.5;
  const DRUM_DIAM_CM = 70.0;
  const canvas = document.getElementById('drumCanvas');
  const ctx = canvas.getContext('2d', { alpha:false });
  const W=canvas.width, H=canvas.height;
  const CX=W*0.5, CY=H*0.52;
  const DRUM_R = Math.min(W,H)*0.44;
  const pxPerCm = (DRUM_R*2) / DRUM_DIAM_CM;
  const BALL_DIAM_PX = BALL_DIAM_CM * pxPerCm;
  const R = Math.max(6, BALL_DIAM_PX/2);

  const outMain = document.getElementById('drumOutMain');
  const outEuro = document.getElementById('drumOutEuro');
  const btnStart = document.getElementById('drumAutoStart');
  const btnReset = document.getElementById('drumReset');
  const label = document.getElementById('drumLabel');
  const dbg = document.getElementById('dbg');

  const CATCH_POS = { x: CX + DRUM_R*0.48, y: CY - DRUM_R*0.78 };
  const CATCH_R   = R + 4;

  const JETS = [
    { x: CX - DRUM_R*0.32, y: CY + DRUM_R*0.60, phase: 0.0 },
    { x: CX,               y: CY + DRUM_R*0.60, phase: 1.2 },
    { x: CX + DRUM_R*0.32, y: CY + DRUM_R*0.60, phase: 2.4 }
  ];
  const JET_R = Math.max(70, R*3.3);

  const PADDLES = 3; let paddleAngle = 0;
  const REST = 0.82; const BASE_LIFT_V = 250; const BASE_LIFT_P = 190;
  let gvec = { x:0, y:60 };

  let balls=[], drawnMain=[], drawnEuro=[];
  let phase='idle', running=false, rafId=null, last=0, lastCatchMs=0;
  let tNoise=0, tGrav=0, jetT=0;

  function rng(a,b){ return a + Math.random()*(b-a); }
  function speed(b){ return Math.hypot(b.vx, b.vy); }
  function pill(n, euro){ const s=document.createElement('span'); s.className='chip'+(euro?' euro':''); s.textContent=n; setTimeout(()=>{ s.classList.add('pop'); setTimeout(()=> s.classList.remove('pop'), 240); }, 10); return s; }
  function render(){ outMain.innerHTML=''; drawnMain.forEach(n=> outMain.appendChild(pill(n,false))); outEuro.innerHTML=''; drawnEuro.forEach(n=> outEuro.appendChild(pill(n,true))); }

  function spawnPacked(count){
    const res=[]; const attempts=4000; const minDist=R*2.1; let tries=0;
    while(res.length<count && tries<attempts){
      tries++; const a=Math.random()*Math.PI*2, r=DRUM_R*rng(0.25,0.9);
      const x=CX+Math.cos(a)*r, y=CY+Math.sin(a)*r;
      if(Math.hypot(x-CX,y-CY) > (DRUM_R - R*1.6)) continue;
      let ok=true; for(const o of res){ if(Math.hypot(o.x-x,o.y-y) < minDist){ ok=false; break; } }
      if(ok) res.push({ id:res.length+1, x:x, y:y, vx:rng(-50,50), vy:rng(-50,50), r:R });
    }
    while(res.length<count){ const a=Math.random()*Math.PI*2, r=DRUM_R*rng(0.2,0.95); const x=CX+Math.cos(a)*r, y=CY+Math.sin(a)*r;
      res.push({ id:res.length+1, x:x, y:y, vx:rng(-50,50), vy:rng(-50,50), r:R }); }
    return res;
  }

  function initBalls(count, isPearl){ balls = spawnPacked(count); label.textContent = isPearl ? 'Pearl Â· 12 weiÃŸe Styroporkugeln' : 'Venus Â· 50 gelbe Styroporkugeln'; }

  function drawDrum(isPearl){
    ctx.fillStyle='#0b1022'; ctx.fillRect(0,0,W,H);
    ctx.beginPath(); ctx.arc(CX,CY,DRUM_R,0,Math.PI*2); ctx.strokeStyle='rgba(200,220,255,.38)'; ctx.lineWidth=8; ctx.stroke();
    ctx.save(); ctx.translate(CX,CY); const L=DRUM_R*0.66; paddleAngle+=0.022;
    for(let i=0;i<PADDLES;i++){ const ang=paddleAngle + i*(2*Math.PI/PADDLES); ctx.rotate(ang); ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(L,0); ctx.lineWidth=6; ctx.strokeStyle='rgba(200,200,255,.22)'; ctx.stroke(); ctx.rotate(-ang); }
    ctx.restore();
    ctx.beginPath(); ctx.arc(CATCH_POS.x, CATCH_POS.y, CATCH_R, 0, Math.PI*2); ctx.strokeStyle='rgba(255,255,255,.65)'; ctx.lineWidth=3; ctx.stroke();
    for(const j of JETS){ ctx.beginPath(); ctx.arc(j.x,j.y,7,0,Math.PI*2); ctx.fillStyle='rgba(120,170,255,.35)'; ctx.fill(); }
  }
  function drawBall(b, isPearl){
    ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fillStyle=isPearl?'rgba(255,255,255,.96)':'rgba(255,240,120,.98)'; ctx.fill();
    ctx.lineWidth=1.4; ctx.strokeStyle='rgba(0,0,0,.45)'; ctx.stroke();
    ctx.fillStyle='#111'; ctx.font='bold 12px Inter, system-ui'; const s=String(b.id), w=ctx.measureText(s).width; ctx.fillText(s,b.x-w/2,b.y+4);
  }

  const CELL=Math.max(18, R*2.2); function key(x,y){ return (Math.floor(x/CELL))+','+(Math.floor(y/CELL)); }
  const neigh=[[0,0],[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1]];

  function step(dt, now, isPearl){
    tNoise+=dt; tGrav+=dt; jetT+=dt;
    if(tGrav>1.0){ tGrav=0; const ang=rng(-Math.PI,Math.PI), g=rng(40,85); gvec={x:Math.cos(ang)*g, y:Math.sin(ang)*g}; }
    if(tNoise>0.22){ tNoise=0; for(const b of balls){ b.vx+=rng(-18,18); b.vy+=rng(-18,18); } }
    const base=isPearl?BASE_LIFT_P:BASE_LIFT_V;

    for(const b of balls){
      const dx=b.x-CX, dy=b.y-CY, dist=Math.hypot(dx,dy);
      const wallProx = Math.max(0, (dist - (DRUM_R - R*2.0)) / (R*2.0));
      const tang = Math.atan2(dy,dx) + Math.PI/2;
      const shear = wallProx * 35;
      b.vx += Math.cos(tang)*shear*dt; b.vy += Math.sin(tang)*shear*dt;

      b.vx*=0.988; b.vy*=0.988; b.vx+=gvec.x*dt; b.vy+=gvec.y*dt;
      for(const J of JETS){ const jx=b.x-J.x, jy=b.y-J.y, d2=jx*jx+jy*jy;
        if(d2 < JET_R*JET_R){ const p=(Math.sin(jetT*2.7 + J.phase)+1)*0.5; b.vy -= base*p*dt; b.vx += jx*0.0018*dt; } }
      if(speed(b) < 18){ b.vx += rng(-30,30)*dt; b.vy += rng(-30,30)*dt; }

      b.x+=b.vx*dt; b.y+=b.vy*dt;
      const ddx=b.x-CX, ddy=b.y-CY; const dist2=Math.hypot(ddx,ddy); const maxR=DRUM_R - b.r - 3;
      if(dist2>maxR){ const nx=ddx/dist2, ny=ddy/dist2; b.x=CX+nx*maxR; b.y=CY+ny*maxR; const vn=b.vx*nx+b.vy*ny; const vtx=b.vx-vn*nx, vty=b.vy-vn*ny; b.vx=vtx*1.01-REST*vn*nx; b.vy=vty*1.01-REST*vn*ny; }
    }

    const grid=new Map(); for(const b of balls){ const k=key(b.x,b.y); if(!grid.has(k)) grid.set(k,[]); grid.get(k).push(b); }
    for(const b of balls){ const ix=Math.floor(b.x/CELL), iy=Math.floor(b.y/CELL);
      for(const n of neigh){ const arr=grid.get((ix+n[0])+','+(iy+n[1])); if(!arr) continue;
        for(const o of arr){ if(o===b) continue; const dx=o.x-b.x, dy=o.y-b.y, rsum=o.r+b.r, d2=dx*dx+dy*dy;
          if(d2<rsum*rsum){ const d=Math.sqrt(d2)||0.0001, nx=dx/d, ny=dy/d; const overlap=(rsum-d), push=overlap*0.55;
            b.x-=nx*push*0.5; b.y-=ny*push*0.5; o.x+=nx*push*0.5; o.y+=ny*push*0.5;
            const reln=(b.vx-o.vx)*nx+(b.vy-o.vy)*ny; const J=(-1.8*reln)/2; b.vx+=J*nx; b.vy+=J*ny; o.vx-=J*nx; o.vy-=J*ny; } } } }

    for(let i=balls.length-1;i>=0;i--){ const b=balls[i]; const d=Math.hypot(b.x-CATCH_POS.x,b.y-CATCH_POS.y); const wait=(phase==='main')?1500:1800;
      if(d < CATCH_R-1){ const nowMs=now*1000.0; if(nowMs - lastCatchMs < wait){ const nx=(b.x-CATCH_POS.x)/(d||1), ny=(b.y-CATCH_POS.y)/(d||1); b.vx+=nx*85; b.vy+=ny*85; continue; }
        balls.splice(i,1); lastCatchMs=nowMs; setTimeout(()=>capture(b),200); } }
  }

  function capture(ball){ if(phase==='main'){ drawnMain.push(ball.id); drawnMain.sort((a,b)=>a-b); render(); if(drawnMain.length>=5){ phase='switch'; } }
                          else if(phase==='euro'){ drawnEuro.push(ball.id); drawnEuro.sort((a,b)=>a-b); render(); if(drawnEuro.length>=2){ phase='done'; stop(); } } }

  function draw(){ const isPearl=(phase==='euro'||phase==='done'); drawDrum(isPearl); for(const b of balls) drawBall(b,isPearl); }

  function loop(ts){ if(!running) return; const t=ts*0.001, dt=Math.min(0.033, last?(t-last):0.016); last=t;
    if(phase==='main'||phase==='euro'){ step(dt, t, (phase!=='main')); }
    else if(phase==='switch'){ phase='euro_init'; setTimeout(()=>{ initBalls(12, true); phase='euro'; lastCatchMs=performance.now(); }, 700); }
    draw(); if(dbg) dbg.textContent='phase='+phase+' | balls='+balls.length+' | drawn='+drawnMain.length+'+'+drawnEuro.length+' | R(px)='+R.toFixed(1);
    rafId=requestAnimationFrame(loop); }

  function start(){ if(running) return; running=true; last=0; lastCatchMs=performance.now(); rafId=requestAnimationFrame(loop); }
  function stop(){ running=false; if(rafId) cancelAnimationFrame(rafId); rafId=null; }
  function reset(){ stop(); drawnMain=[]; drawnEuro=[]; outMain.innerHTML=''; outEuro.innerHTML=''; balls=[]; label.textContent='Venus Â· 50 gelbe Styroporkugeln'; phase='idle'; draw(); }

  btnReset.addEventListener('click', reset);
  btnStart.addEventListener('click', ()=>{ reset(); initBalls(50,false); phase='main'; start(); });
  (function(){ reset(); initBalls(50,false); phase='main'; start(); })();
})();
</script>
</body>
</html>