<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EuroJackpot • TV‑Style Ziehung (by ENOWEB)</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<style>
:root{ --ink:#eaf7ff; --bg:#060712; --panel:rgba(18,22,38,.82); --cy:#00fff0; --mag:#ff5be8; --gold:#f4c655; --green:#18c47d; }
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;color:var(--ink);font-family:Inter,ui-sans-serif,system-ui;background:
  radial-gradient(1200px 800px at -10% -10%, rgba(0,255,240,.10), transparent 60%),
  radial-gradient(1200px 800px at 110% -10%, rgba(255,0,234,.10), transparent 60%),
  linear-gradient(180deg,#060a12,#05070e 60%, #060a12);}
.h1{background:linear-gradient(90deg,var(--cy),var(--mag));-webkit-background-clip:text;color:transparent;font-weight:900}
.brand{font-weight:900;letter-spacing:1px; display:inline-block; background:linear-gradient(90deg,#00fff0,#6cc7ff,#ff5be8,#ffd36a,#00fff0); background-size:400% 100%;
  -webkit-background-clip:text; color:transparent; animation:gradmove 6s linear infinite}
@keyframes gradmove{0%{background-position:0% 50%}100%{background-position:100% 50%}}
.card{background:var(--panel);backdrop-filter:blur(14px);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px;box-shadow:0 14px 44px rgba(0,0,0,.45)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;height:44px;padding:0 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);font-weight:700}
.btn--green{background:#15803d;color:#fff}.btn--amber{background:#b45309;color:#fff}.btn--gray{background:#374151;color:#fff}
.badge{background:rgba(255,255,255,.06); border:1px solid rgba(140,170,255,.22); border-radius:999px; padding:.25rem .65rem; font-size:.78rem;}
.small{font-size:.85rem;opacity:.9}
.grid2{display:grid;grid-template-columns:1fr;gap:14px}@media(min-width:900px){.grid2{grid-template-columns:1fr 1fr}}

.simwrap{position:relative;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,.08);background:#03070e}
.simwrap canvas{width:100%;height:440px;max-height:65vh;background:radial-gradient(70% 90% at 50% 35%, #0b1626, #071220, #050c18)}
.simlabel{position:absolute;top:10px;left:12px}
.slot{position:absolute;right:10px;top:10px;width:96px;height:96px;border-radius:16px;border:1px solid rgba(0,255,200,.28);background:linear-gradient(180deg,rgba(0,255,170,.12),rgba(0,140,120,.10));display:flex;align-items:center;justify-content:center;font-size:12px;color:#8bffc9}

.rail{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;padding:.5rem .75rem;border-radius:12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.07)}
.rail .slotbox{width:46px;height:46px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-weight:800}
.sep{width:2px;height:30px;background:rgba(255,255,255,.15);border-radius:2px;margin:0 .25rem}

.floating-chip{position:fixed;z-index:60;min-width:38px;height:38px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-weight:900;pointer-events:none;
  background:linear-gradient(180deg,#ffe7a2,#f4c655);color:#241a05;box-shadow:inset 0 -6px 10px rgba(0,0,0,.15),0 10px 22px rgba(255,220,130,.25)}
.chip{display:inline-flex;align-items:center;justify-content:center;min-width:38px;height:38px;border-radius:999px;background:linear-gradient(180deg,#0fd5c6,#0aa39a);color:#042725;font-weight:900;letter-spacing:.5px}
.chip--gold{background:linear-gradient(180deg,#ffe7a2,#f4c655);color:#241a05}

table.heat{width:100%; border-collapse:separate; border-spacing:0 6px}
table.heat td{padding:6px 8px; background:rgba(255,255,255,.05); border-radius:8px; text-align:center}
td.hot{background:linear-gradient(180deg,rgba(30,200,160,.35),rgba(30,200,160,.12))}
td.cold{background:linear-gradient(180deg,rgba(90,120,255,.28),rgba(90,120,255,.10))}
</style>
</head>
<body class="p-4">
  <header class="mb-2">
    <h1 class="h1 text-3xl md:text-4xl">EuroJackpot • TV‑Style Ziehung</h1>
    <div class="brand text-lg">by ENOWEB</div>
  </header>

  <div class="grid grid-cols-1 xl:grid-cols-3 gap-3">
    <section class="card xl:col-span-2">
      <h2 class="font-bold text-xl mb-2">🌀 Simulation (2 Trommeln, Sog + Klappe + Rutsche)</h2>
      <div class="grid2">
        <div class="simwrap">
          <div class="simlabel badge">Haupttrommel (1–50)</div>
          <div class="slot">Auswurf</div>
          <canvas id="cvA" width="680" height="440"></canvas>
        </div>
        <div class="simwrap">
          <div class="simlabel badge">Eurotrommel (1–12)</div>
          <div class="slot">Auswurf</div>
          <canvas id="cvB" width="680" height="440"></canvas>
        </div>
      </div>
      <div class="mt-3 rail" id="resultRail">
        <div class="slotbox" data-slot="A1"></div>
        <div class="slotbox" data-slot="A2"></div>
        <div class="slotbox" data-slot="A3"></div>
        <div class="slotbox" data-slot="A4"></div>
        <div class="slotbox" data-slot="A5"></div>
        <div class="sep"></div>
        <div class="slotbox" data-slot="B1"></div>
        <div class="slotbox" data-slot="B2"></div>
      </div>
      <div class="flex flex-wrap gap-2 mt-3">
        <button id="btnStart" class="btn btn--green">Ziehung starten (5+2)</button>
        <button id="btnReset" class="btn btn--amber">Reset</button>
      </div>
      <div id="resultText" class="mt-3 text-lg"><span class="badge">Noch kein Ergebnis</span></div>
    </section>

    <section class="card">
      <h2 class="font-bold text-xl mb-2">📂 Archiv (Auto + Fallback)</h2>
      <input id="archiveUrl" class="bg-gray-900 p-2 rounded w-full mb-2" value="https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_eurojackpot.zip">
      <div id="statusText" class="text-sm mb-2">Starte Archiv‑Download…</div>
      <div class="grid grid-cols-3 gap-2 text-center my-2">
        <div class="badge">Ziehungen: <b id="kpiCount">–</b></div>
        <div class="badge">Von: <b id="kpiFrom">–</b></div>
        <div class="badge">Bis: <b id="kpiTo">–</b></div>
      </div>
      <div class="mt-2 small opacity-80">Falls der Online‑Abruf blockiert ist: ZIP/TXT hier laden oder Inhalt einfügen.</div>
      <input id="fileInput" type="file" class="mt-2 block w-full bg-gray-900 p-2 rounded" accept=".zip,.csv,.txt">
      <textarea id="pasteBox" class="mt-2 w-full h-24 bg-gray-900 p-2 rounded" placeholder="Oder CSV/TXT hier einfügen…"></textarea>
      <button id="btnParsePaste" class="btn btn--gray mt-2">CSV/TXT einlesen</button>
    </section>
  </div>

  <section class="card mt-3">
    <h2 class="font-bold text-xl mb-2">📊 Analyse</h2>
    <div class="small mb-2" id="analysisIntro">Warte auf eine neue Ziehung…</div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
      <div><div class="font-semibold mb-1">Hot & Cold (Hauptzahlen)</div><table class="heat" id="hotMain"></table></div>
      <div><div class="font-semibold mb-1">Hot & Cold (Eurozahlen)</div><table class="heat" id="hotEuro"></table></div>
      <div><div class="font-semibold mb-1">Kombinations‑Treffer</div><div id="comboStats" class="small">–</div></div>
    </div>
  </section>

<script>
const $=s=>document.querySelector(s);
const LS_ARCH='ej_enoweb_archive_v4';
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
function rng(seed){ let s=seed|0||Date.now()%2147483647; return ()=> (s=(s*48271)%2147483647)/2147483647; }

/* ===== ARCHIV LADEN ===== */
window.__ej={draws:[],freqA:Array(51).fill(0),freqB:Array(13).fill(0)};

async function getTextFromRes(res,url){
  const blob=await res.blob();
  const ct=(res.headers.get('content-type')||'').toLowerCase();
  const sig=await blob.slice(0,4).text().catch(()=>'');
  if(ct.includes('zip') || url.endsWith('.zip') || sig.startsWith('PK')){
    try{ const zip=await JSZip.loadAsync(blob); let out=''; for(const f of Object.values(zip.files)){ if(/\\.(txt|csv)$/i.test(f.name)) out+='\\n'+await f.async('string'); } if(out.trim()) return out; }catch{}
  }
  try{ return await (new Response(blob)).text(); }catch{return '';}
}
async function fetchWithProxies(url){
  const chain=[
    'https://api.allorigins.win/raw?url='+encodeURIComponent(url),
    'https://corsproxy.io/?'+encodeURIComponent(url),
    'https://cors.isomorphic-git.org/'+url,
    'https://thingproxy.freeboard.io/fetch/'+url,
    url
  ];
  for(const u of chain){
    try{
      const r=await fetch(u,{cache:'no-store'}); if(!r.ok) throw 0;
      const t=await getTextFromRes(r,url); if(t && t.trim()) return t;
    }catch{}
  }
  throw new Error('Alle Quellen blockiert');
}
function parseEuroArchive(txt){
  try{
    const t=txt.replace(/\\r\\n?/g,'\\n'); const lines=t.split('\\n').map(l=>l.trim()).filter(Boolean);
    const head=lines[0];
    let delim=(head.match(/\\t/g)||[]).length>(head.match(/;/g)||[]).length?'\\t':(head.match(/;/g)||[]).length?';':',';
    let H=head.split(delim).map(s=>s.trim());
    let idx={Tag:H.findIndex(x=>/tag/i.test(x)), Monat:H.findIndex(x=>/monat|month/i.test(x)), Jahr:H.findIndex(x=>/jahr|year/i.test(x)),
      A:[1,2,3,4,5].map(k=>H.findIndex(x=>new RegExp('ZahlA'+k,'i').test(x))), B:[1,2].map(k=>H.findIndex(x=>new RegExp('ZahlB'+k,'i').test(x)))};
    if(idx.A.some(i=>i<0)||idx.B.some(i=>i<0)){
      idx={Tag:H.findIndex(x=>/tag/i.test(x)), Monat:H.findIndex(x=>/monat|month/i.test(x)), Jahr:H.findIndex(x=>/jahr|year/i.test(x)),
      A:[1,2,3,4,5].map(k=>H.findIndex(x=>new RegExp('Zahl'+k,'i').test(x))), B:[1,2].map(k=>H.findIndex(x=>new RegExp('Euro'+k,'i').test(x)))};
    }
    if(idx.Tag<0||idx.Monat<0||idx.Jahr<0||idx.A.some(i=>i<0)||idx.B.some(i=>i<0)) throw new Error('Kopfzeile nicht erkannt.');
    const out=[];
    for(let i=1;i<lines.length;i++){
      const c=lines[i].split(delim).map(s=>s.trim());
      if(c.length<=Math.max(...idx.A,...idx.B)) continue;
      const A=idx.A.map(ii=>+c[ii]).filter(Number.isFinite), B=idx.B.map(ii=>+c[ii]).filter(Number.isFinite);
      const day=+c[idx.Tag], mon=+c[idx.Monat], year=+c[idx.Jahr];
      if(A.length===5 && B.length===2){
        const date=new Date(Date.UTC(year,mon-1,day)).toISOString().slice(0,10);
        out.push({date, main:A.slice().sort((a,b)=>a-b), euro:B.slice().sort((a,b)=>a-b)});
      }
    }
    if(!out.length) throw new Error('Keine Ziehungen gefunden.');
    out.sort((a,b)=>a.date.localeCompare(b.date));
    window.__ej.draws=out; window.__ej.freqA=Array(51).fill(0); window.__ej.freqB=Array(13).fill(0);
    out.forEach(d=>{ d.main.forEach(n=>window.__ej.freqA[n]++); d.euro.forEach(n=>window.__ej.freqB[n]++); });
    $('#kpiCount').textContent=out.length; $('#kpiFrom').textContent=out[0].date; $('#kpiTo').textContent=out.at(-1).date;
    $('#statusText').textContent='Archiv geladen ✔';
    renderHotCold();
  }catch(e){ $('#statusText').textContent='Fehler: '+e.message; }
}
async function autoLoadArchive(){
  const url=$('#archiveUrl').value.trim();
  $('#statusText').textContent='Lade Archiv…';
  try{
    const raw=await fetchWithProxies(url);
    localStorage.setItem(LS_ARCH,raw);
    parseEuroArchive(raw);
  }catch(e){
    const saved=localStorage.getItem(LS_ARCH);
    if(saved){ parseEuroArchive(saved); $('#statusText').textContent='Online blockiert – lokale Kopie geladen.'; }
    else{ $('#statusText').textContent='Auto‑Download blockiert. Bitte ZIP hochladen oder Inhalt einfügen.'; }
  }
}
autoLoadArchive();
$('#fileInput').addEventListener('change', async (ev)=>{
  const file=ev.target.files[0]; if(!file) return;
  if(file.name.endsWith('.zip')){ const zip=await JSZip.loadAsync(file); let txt=''; for(const f of Object.values(zip.files)){ if(/\\.(txt|csv)$/i.test(f.name)) txt+='\\n'+await f.async('string'); } localStorage.setItem(LS_ARCH,txt); parseEuroArchive(txt); }
  else{ const txt=await file.text(); localStorage.setItem(LS_ARCH,txt); parseEuroArchive(txt); }
});
$('#btnParsePaste').onclick=()=>{ const txt=$('#pasteBox').value; if(txt.trim()){ localStorage.setItem(LS_ARCH,txt); parseEuroArchive(txt); } };

/* ===== Hot/Cold ===== */
function renderHotCold(){
  const A=window.__ej.freqA, B=window.__ej.freqB;
  function table(el, arr, maxN){
    const vals=arr.slice(1,maxN+1); const max=Math.max(...vals,1), min=Math.min(...vals.filter(v=>v>0),max);
    let html='';
    for(let i=1;i<=maxN;i+=5){
      html+='<tr>';
      for(let j=i;j<i+5 && j<=maxN;j++){
        const v=arr[j]||0; const cls = v>= (min + (max-min)*0.66) ? 'hot' : (v<= (min + (max-min)*0.33) ? 'cold' : '');
        html+=`<td class="${cls}"><div class="text-xs opacity-75">${String(j).padStart(2,'0')}</div><div class="font-bold">${v}</div></td>`;
      }
      html+='</tr>';
    }
    el.innerHTML=html;
  }
  table($('#hotMain'),A,50);
  table($('#hotEuro'),B,12);
}

/* ===== Custom Premium Simulation ===== */
class DrumSim{
  constructor(canvas, count, seed=0){
    this.canvas=canvas; this.ctx=canvas.getContext('2d');
    this.W=canvas.clientWidth; this.H=canvas.clientHeight; canvas.width=this.W; canvas.height=this.H;
    this.cx=this.W*0.48; this.cy=this.H*0.58; this.R=Math.min(this.W,this.H)*0.38;
    this.rBall=Math.max(12,this.R*0.08);
    this.intakeAngle=-Math.PI*0.18+Math.PI/2;
    this.intakePos=()=>({x:this.cx+Math.cos(this.intakeAngle)*(this.R-64), y:this.cy+Math.sin(this.intakeAngle)*(this.R-64)});
    this.rng=(function(seed){ let s=seed|0||Date.now()%2147483647; return ()=> (s=(s*48271)%2147483647)/2147483647; })(seed||Date.now());
    this.balls=[]; for(let i=1;i<=count;i++){ const th=i/count*Math.PI*2 + this.rng()*0.2; const w=(this.rng()*2-1)*0.6; this.balls.push({n:i, th, w, alive:true}); }
    this.target=null; this.flap=0; this.phase='mix';
    this.arms=[0,Math.PI*2/3,-Math.PI*2/3]; this.armSpeed=1.1;
    this.anim=null; this.onEject=null; this.tick=0; this.prev=null;
    this.loop=this.loop.bind(this); this.loop();
  }
  nearestBall(){
    const P=this.intakePos(); let best=null,bd=1e9;
    for(const b of this.balls){ if(!b.alive) continue; const x=this.cx+Math.cos(b.th)*(this.R*0.62), y=this.cy+Math.sin(b.th)*(this.R*0.62);
      const d=(x-P.x)**2+(y-P.y)**2; if(d<bd){bd=d; best=b;} } return best;
  }
  async drawOne(){
    if(this.phase!=='mix') return null; this.target=this.nearestBall(); this.phase='suck'; await sleep(700); this.flap=1; await sleep(350);
    const P=this.intakePos(); const pos={x:P.x+90,y:P.y-10}; const num=this.target?.n||0;
    if(this.onEject && num){ this.onEject({num,pos}); }
    if(this.target){ this.target.alive=false; }
    await sleep(200); this.flap=0; this.phase='mix'; this.target=null; return num;
  }
  ballXY(th, rMul=0.62){ return {x:this.cx+Math.cos(th)*(this.R*rMul), y:this.cy+Math.sin(th)*(this.R*rMul)}; }
  drawRing(){
    const ctx=this.ctx; ctx.save(); ctx.translate(this.cx,this.cy);
    ctx.lineWidth=22; ctx.strokeStyle='rgba(10,25,38,.96)'; ctx.beginPath(); ctx.arc(0,0,this.R,0,Math.PI*2); ctx.stroke(); ctx.restore();
    const P=this.ballXY(this.intakeAngle,0.80);
    ctx.save(); ctx.translate(P.x,P.y); ctx.rotate(this.intakeAngle+(this.flap?0.45:0)); ctx.fillStyle='#136d68'; roundRect(ctx,-16,-70,32,140,10); ctx.fill(); ctx.restore();
    ctx.save(); ctx.translate(P.x+30,P.y-14); ctx.rotate(-0.35); ctx.fillStyle='rgba(60,200,170,.18)'; roundRect(ctx,0,0,160,12,6); ctx.fill(); ctx.restore();
    ctx.save(); ctx.translate(P.x+100,P.y+24); ctx.rotate(-0.35); ctx.fillStyle='rgba(60,200,170,.18)'; roundRect(ctx,0,0,180,12,6); ctx.fill(); ctx.restore();
  }
  drawArms(dt){
    const ctx=this.ctx; this.armSpeed=clamp(this.armSpeed+dt*0.05,0.9,1.8);
    this.arms=this.arms.map(a=>a+(this.armSpeed*dt*(this.tick%2?1:-1)));
    ctx.save(); ctx.translate(this.cx,this.cy); ctx.fillStyle='#17c3b2';
    for(const a of this.arms){ ctx.save(); ctx.rotate(a); roundRect(ctx,-8,-4, this.R*0.8, 8, 4); ctx.fill(); ctx.restore(); } ctx.restore();
  }
  update(dt){
    for(const b of this.balls){ if(!b.alive) continue; b.w += (this.rng()*2-1)*0.02; b.w = clamp(b.w, -1.5, 1.5); b.th += b.w*dt; }
    const alive=this.balls.filter(b=>b.alive).sort((a,b)=>a.th-b.th);
    if(alive.length>1){
      const minGap = (Math.PI*2)/alive.length * 0.35;
      for(let i=0;i<alive.length;i++){ const A=alive[i], B=alive[(i+1)%alive.length];
        let gap=(B.th-A.th+Math.PI*2)%(Math.PI*2); if(gap<minGap){ const push=(minGap-gap)/2; A.th-=push; B.th+=push; } }
    }
    if(this.phase==='suck' && this.target){ const P=this.intakePos(); const pos=this.ballXY(this.target.th);
      const dx=P.x-pos.x, dy=P.y-pos.y, ang=Math.atan2(dy,dx); this.target.th += (ang - this.target.th) * 0.10; this.target.w *= 0.82; }
  }
  drawBalls(){
    const ctx=this.ctx; ctx.save(); ctx.font='800 14px Inter,system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle';
    for(const b of this.balls){ if(!b.alive && b!==this.target) continue; const p=this.ballXY(b===this.target? this.target.th : b.th);
      ctx.beginPath(); ctx.arc(p.x,p.y,this.rBall+6,0,Math.PI*2); ctx.fillStyle='rgba(0,0,0,.14)'; ctx.fill();
      ctx.beginPath(); ctx.arc(p.x,p.y,this.rBall,0,Math.PI*2); ctx.fillStyle= b===this.target ? '#f9d67a' : '#13b3aa'; ctx.fill();
      ctx.lineWidth=3; ctx.strokeStyle='rgba(0,0,0,.55)'; ctx.strokeText(String(b.n).padStart(2,'0'),p.x,p.y);
      ctx.fillStyle= b===this.target ? '#241a05' : '#eafffb'; ctx.fillText(String(b.n).padStart(2,'0'),p.x,p.y); }
    ctx.restore();
  }
  frame(ts){ if(!this.prev) this.prev=ts; const dt=clamp((ts-this.prev)/16, 0.5, 1.6); this.prev=ts; this.tick++;
    const ctx=this.ctx; ctx.clearRect(0,0,this.W,this.H); this.drawRing(); this.update(dt*0.016); this.drawArms(dt*0.016); this.drawBalls(); }
  loop(ts=performance.now()){ this.frame(ts); this.anim=requestAnimationFrame(this.loop); }
}
function roundRect(ctx,x,y,w,h,r){const rr=Math.min(r,Math.abs(w)/2,Math.abs(h)/2);ctx.beginPath();ctx.moveTo(x+rr,y);ctx.arcTo(x+w,y,x+w,y+h,rr);ctx.arcTo(x+w,y+h,x,y+h,rr);ctx.arcTo(x,y+h,x,y,rr);ctx.arcTo(x,y,x+w,y,rr);ctx.closePath();}

/* Ergebnis-Rail */
const rail=$('#resultRail');
function placeStatic(slot,num,gold){ rail.querySelector(`[data-slot="${slot}"]`).innerHTML=`<span class="chip ${gold?'chip--gold':''}">${String(num).padStart(2,'0')}</span>`; }
async function rollTo(fromCanvas, fromXY, slot, num, gold){
  const slotEl=rail.querySelector(`[data-slot="${slot}"]`);
  const s=fromCanvas.getBoundingClientRect(), e=slotEl.getBoundingClientRect();
  const scaleX=fromCanvas.clientWidth/fromCanvas.width, scaleY=fromCanvas.clientHeight/fromCanvas.height;
  const startX=s.left + fromXY.x*scaleX, startY=s.top + fromXY.y*scaleY;
  const endX=e.left+e.width/2, endY=e.top+e.height/2;
  const chip=document.createElement('div'); chip.className='floating-chip'; chip.textContent=String(num).padStart(2,'0');
  chip.style.left=(startX-19)+'px'; chip.style.top=(startY-19)+'px'; document.body.appendChild(chip);
  const dx=endX-startX, dy=endY-startY, dist=Math.hypot(dx,dy), rot=dist/60;
  await chip.animate([{transform:'translate(0,0) rotate(0deg)'},{transform:`translate(${dx}px,${dy}px) rotate(${rot*360}deg)`}],{duration:900,easing:'cubic-bezier(.2,.8,.2,1)'}).finished;
  chip.remove(); placeStatic(slot,num,gold);
}

/* App */
const drumA=new DrumSim(document.getElementById('cvA'),50);
const drumB=new DrumSim(document.getElementById('cvB'),12);
const current={main:[],euro:[],created_at:null};
drumA.onEject = ({num,pos})=>{ rollTo(drumA.canvas,pos,'A'+(current.main.length+1),num,false); current.main.push(num); };
drumB.onEject = ({num,pos})=>{ rollTo(drumB.canvas,pos,'B'+(current.euro.length+1),num,true); current.euro.push(num); };

document.getElementById('btnReset').onclick=()=>location.reload();
document.getElementById('btnStart').onclick=async()=>{
  if(window.__running) return; window.__running=true;
  current.main=[]; current.euro=[]; current.created_at=new Date().toISOString();
  await sleep(600);
  for(let i=0;i<5;i++){ await drumA.drawOne(); await sleep(400); }
  for(let i=0;i<2;i++){ await drumB.drawOne(); await sleep(400); }
  current.main.sort((a,b)=>a-b); current.euro.sort((a,b)=>a-b);
  for(let i=0;i<5;i++) placeStatic('A'+(i+1), current.main[i], false);
  for(let i=0;i<2;i++) placeStatic('B'+(i+1), current.euro[i], true);
  document.getElementById('resultText').innerHTML=`<b>Ergebnis:</b> Haupt: ${current.main.map(n=>String(n).padStart(2,'0')).join(' ')} · Euro: ${current.euro.map(n=>String(n).padStart(2,'0')).join(' ')} <div class="text-xs opacity-80">${current.created_at}</div>`;
  analyze();
  window.__running=false;
};

/* Analyse */
function analyze(){
  const draws=window.__ej.draws; if(!draws.length){ $('#analysisIntro').textContent='Keine Archivdaten geladen.'; return; }
  $('#analysisIntro').textContent=`Archiv berücksichtigt: ${draws.length} Ziehungen (komplette Historie)`;
  const set=new Set(current.main); let m5=0,m4=0,m3=0,e2=0,e1=0;
  for(const d of draws){ const mm=d.main.filter(n=>set.has(n)).length; if(mm===5)m5++; else if(mm===4)m4++; else if(mm===3)m3++; const me=d.euro.filter(n=>current.euro.includes(n)).length; if(me===2)e2++; else if(me===1)e1++; }
  document.getElementById('comboStats').innerHTML=`🎯 5/5: ${m5}× · 4/5: ${m4}× · 3/5: ${m3}×<br>⭐ Euro 2/2: ${e2}× · 1/2: ${e1}×`;
}
</script>
</body>
</html>
